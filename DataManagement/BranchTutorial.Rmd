---
title: "Collaborating with forks and branches"
output:
  bookdown::html_document2:
    highlight: tango
    toc: true
    toc_float: true
    css: ../css/style-chapters.css
--- 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, out.width = '100%')
```

```{r title-pic}
knitr::include_graphics("Pics/fork_branch_tutorial/0_forks_branches.jpg")
```


## What is a fork?

GitHub is useful for developing your own code, but at some point you might want to collaborate with other people on a project. 
Or you might come across a GitHub repository that you want to use as a starting point for your own work. In both cases **forks** are the way to go. 

A fork is making a copy of somebody's GitHub repository. 
You can fork a repo and work independently of the original project. 
Or if you are collaborating with other people you can stay connected with the original repository via **pull requests**.

However, you cannot directly affect (or damage) the original project, which is somewhat less scary, right?

Let's return back to our two GitHub heros Angelina and Kingsley.

```{r github}
knitr::include_graphics("Pics/fork_branch_tutorial/1_workflow3.png")
```
<br/><br/>

### Fork a repo on Github

Go to GitHub, log into your account (see section \@Preparation for how to make an GitHub account) and go to the repository you want to fork.

Angelina wants to fork the magic_dragon repo from biostats.
Click on the **fork** button on the top right of the webpage and wait until the repo is forked.

```{r fork-repo}
knitr::include_graphics("Pics/fork_branch_tutorial/2_fork_repo.png")
```
<br/><br/>
<br/><br/>

### Clone a GitHub repository

On the top is the name of the **forked repository** and the project name it has been forked from.
Click on the green **Code** button on the top right and copy the url link.

```{r clone}
knitr::include_graphics("Pics/fork_branch_tutorial/3_clone.png")
```
<br/><br/>
<br/><br/>
Go to RStudio and click on **File > New Project**.

```{r new-project, out.width = '60%'}
knitr::include_graphics("Pics/gittutorial/12_new_project.png")
```
<br/><br/>
<br/><br/>
Select **Version Control**.

```{r version-control, out.width = '60%'}
knitr::include_graphics("Pics/gittutorial/13_version_control.png")
```
<br/><br/>
<br/><br/>
Select **Git**.

```{r git, out.width = '60%'}
knitr::include_graphics("Pics/gittutorial/14_git.png")
```
<br/><br/>
<br/><br/>
And paste the url link from above.

```{r add-url, out.width = '60%'}
knitr::include_graphics("Pics/fork_branch_tutorial/4_add_url.png")
```

If you want to **work independently** from the original repo, then this is it.

However, if you want to stay connected to the **upstream repo**, then go to terminal and type:

```s
git remote add upstream git@github.com:user_name/repo_name.git

git remote add upstream git@github.com:biostats_r/magic_dragons.git
```

Now you have cloned the project **local** to your computer and you are ready to start working in your fork.


## What is a branch?

You have forked a repository and are ready to start working on the project. 
Let's talk about **branches**.

A **branch** lets you develop code, fix a problem, or test an idea without affecting the original project. 
A **branch** is created from an existing **branch**, usually from the **main branch** of the project.
You can work on a **branch**, bravely develop code that works or does not work and it  does not affect the changes other people make to this repo.
Basically, you can experiment on your own.

If the idea did not work or you have another idea, the **branch** can be deleted and nobody ever needs to know about it. 
Make a new **branch** and start all over again. 
None of this will affect the original project.

If you are working **on your own** project, and happy with the new code, or the idea is tested and working, you can **merge** the branch you are working on with the **main branch**.

If you are **collaborating** with other people an you have forked a repo you do not want to work directly on the **main branch**. When you change the **main branch** and later update your repo from the original repo, it will cause **merge conflicts**. Therefore, when collaborating with others, you always work on **brnaches** and you can make a **pull requests** by **merging** the changes in the **current branch** to the **main branch** (see \@make-pull-request-in-github). 

Let's have a look how to create, use and delete branches.


### Make a new branch in RStudio

In RStudio, click on the **New Branch** button in the Git tab. 
Next to this button it will say on which branch you are.
In this case it is main, which is the default branch.


```{r new-branch}
knitr::include_graphics("Pics/fork_branch_tutorial/5_make_new_branch.png")
```
<br/><br/>
<br/><br/>
Give the branch a short and informative name (no spaces) and click **Create**.

```{r name-branch, out.width = '50%'}
knitr::include_graphics("Pics/fork_branch_tutorial/6_name_branch.png")
```
<br/><br/>
<br/><br/>
You are now in the newly created branch.

```{r new-branch-2}
knitr::include_graphics("Pics/fork_branch_tutorial/7_new_branch.png")
```


### Code, commit and push to origin in Rstudio

Now is the time work in a new or an existing file on the project. 
You can work the way it is described in the \@how-to-work-in-git How to work with GitHub tutorial. Write or edit code, test it, **commit** regularly, add a useful commit message.

Once you are done with the task in this branch, test it and **push** it to your **origin (remote?) repository** on GitHub. This is the workflow, if you are working on your own.

If you are collaborating with others, you will want to send your code **upstream** to the original repo.


### Make pull request on GitHub

Once you have **pushed** your branch back to the **main branch** you can make a **pull request**.
A **pull request** is a request to the maintainer of the **upstream** repository to pull your code.

Go to GitHub, to your forked repository (not the upstream repo).
Click on the green box **Compare & pull request** which has appear at the top of the page. 
<br/><br/>
<br/><br/>
```{r pull-request-1}
knitr::include_graphics("Pics/fork_branch_tutorial/8_pull_request.png")
```
<br/><br/>
<br/><br/>
Add a comment about your pull request and click **Create pull request**.
<br/><br/>
<br/><br/>
```{r pull-request-2}
knitr::include_graphics("Pics/fork_branch_tutorial/9_create_pull_request.png")
```
<br/><br/>
<br/><br/>
Once you have created your **pull request**, github will check if there are any **merge conflict**.
A **merge conflict** can occur when two people are changing the same line in one file differently.
We will explain later how to deal with this.

If no **merge conflict** occurs GitHub will give green light for merging.
If there is a merge conflict, it has to be resolved before the file can be merged (see below).
<br/><br/>
<br/><br/>
```{r pull-request-3}
knitr::include_graphics("Pics/fork_branch_tutorial/10_merge_pull_request.png")
```
<br/><br/>
<br/><br/>
Now it's time for you to relax, have some cake üç∞, you have earned it!
<br/><br/>
<br/><br/>

### Repo maintainer accepts pull request (or not)

The **maintainer** of the original repository will then get notified about your **pull request**.
<br/><br/>
<br/><br/>
```{r maintainer}
knitr::include_graphics("Pics/fork_branch_tutorial/11_maintainer_view.png")
```

The **maintainer** has to evaluate your changes to the project and can make comments to specific parts of the code, or even **start a review**.
You will get a notification if changes are required and this can go forth and back for a while.
<br/><br/>
<br/><br/>
```{r comment}
knitr::include_graphics("Pics/fork_branch_tutorial/12_comment.png")
```
<br/><br/>
<br/><br/>
Eventually, the **maintainer** will **confrim the merge** and you will get a notification.
<br/><br/>
<br/><br/>
```{r merge}
knitr::include_graphics("Pics/fork_branch_tutorial/13_confirm_merge.png")
```
<br/><br/>
<br/><br/>

### Update your fork in the Terminal

Once your **pull request** has been accepted, you have to update your fork to get the latest changes from **upstream**. 
Go to RStudio and the terminal tab.
<br/><br/>
<br/><br/>
```{r terminal-request}
knitr::include_graphics("Pics/gittutorial/16_terminal.png")
```
<br/><br/>
<br/><br/>

And type:

```
git fetch upstream

git checkout main

git merge upstream/main
```
Fetch downloads all the changes from upstream. 
Checkout main makes sure your main branch is active. 
And the last line merges the changes on your local repository.
<br/><br/>
<br/><br/>


### Delete branches

Once you have created a couple of **branches**, it will become difficult to track which **branch** you are still working on and which are old. Generally, you want to delete a **branch** when you are done with it.

To delete a **branch** locally type:

```
git branch -D branch_name
```
To delete the **branch** remotely, type:
```
git push origin --delete branch_Tutorial_name
```
<br/><br/>
<br/><br/>

### When things go wrong

!!! Still needs to be added:
- Need to explain that working on the master branch summons zombies. Maybe explain how to lock master branch (bit advanced - maybe a link is sufficient)
- what is a merge conflict and how to handle it


<br/><br/>
<br/><br/>

### Further reading {.facta .toc-ignore}

- https://happygitwithr.com/


### What's next {.facta .toc-ignore}

Nothing yet. Go and eat more cake üç∞