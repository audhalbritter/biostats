# Getting started with ggplot

### Before you start {.facta}

You need to be 

- familiar with different types of data (continuous, categorical)
- able to handle tibbles
- know how to install a package

## Install the `ggplot2` package

`ggplot2` is part of `tidyverse` so if you have already installed `tidyverse`, you already have `ggplot2` installed.
If not, see the section \@ref(the-tidyverse).

To activate `ggplot2`, you can use

```{r load, eval=TRUE, echo=TRUE}
library(ggplot2)
```

But most of the time you can use `library(tidyverse)`.

## The basics

`ggplot` is based on the **grammar of graphics**, a terminology describing the components of a figure.

Let us have a look at these terms.

To produce a figure or plot, we take data values and use elements like dots, squares, lines, and colour to convert the data into a visual graphic.
There are many different ways to make a figure, but there are some rules that apply in general.
A plot is always built on data, and a number of other components called aesthetics, geometry and scales.
These different components combined make up a figure



## The code

The code for to make a scatterplot with the `penguins` dataset from the [`palmerpenguins` package](getting-started-with-r.html#palmerpenguins) looks something like this:

```{r ggplot2-1, fig.height = 3, fig.width=3.5}
ggplot(data = penguins,
       mapping = aes(x = body_mass_g, y = bill_length_mm, colour = species)) +
  geom_point() +
  labs(x = "Body mass, g", y = "Bill length, mm", colour = "Species") +
  theme_bw()
```


The main function is `ggplot()` and is used to define the data and the aesthetics.
The `data` is a data frame or tibble containing the variables to produce the figure.
The `mapping` uses `aes()` to describe how the variables should be mapped onto the **aes**tetics, such as x and y position or colour.
Every other component of the plot is added with `+`.
It makes the code easier to read if you put a new line after each `+` (the `+` must go at the end of a line, not at the start).
These other elements include the graphical elements that display the data, usually created with a `geom_*()` function, labels created with `labs()`, and [themes](themes-1.html) that change the non-data elements of the plot with `themes()`.

You can think of it as different layers that are put on top of each other see \@ref(fig:ggplot-hierarchy).

```{r ggplot-hierarchy, echo=FALSE, fig.cap="Visualization of how ggplots are built.", out.width = '100%'}
knitr::include_graphics("figures/ggplot_setup.png")
```


## Building a ggplot figure

Now we will describe the different components a ggplot is made of.

### Data

To make a figure we use the function `ggplot()`.
The first argument in this function is for the **data object** containing all the variables that you need to make a figure
Generally, it is advisable to have the data in a long format.

```{r data1, echo = TRUE, eval = TRUE, fig.height = 3, fig.width = 3}
ggplot(data = penguins)

```

The ggplot function will produce an empty plot.

### Aesthetics

The second argument in the `ggplot()` function, `mapping`, is where we define the plot's **aesthetics** with the function `aes()`.
The different elements from the aesthetics are used to display the data.
The most important element is the position which describes the location of the data on the plot, usually by x and y.
Other important elements are shape, fill, size, colour and line type, which describe how the data is presented on the plot.

In the penguin example, if we want to plot the bill length against the bill depth, we choose these two variables as `x` and `y`.
As a second aesthetic we have chosen to map species to colour.

```{r aestetic, eval = TRUE, fig.height = 3, fig.width=3}
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, colour = species))
```

One thing that might be confusing about the argument colour is that it only allows to be a variable, for example `colour = species` or `colour = island`. 
So for example `colour = "red"` does not work.
If you want to choose a specific colour, this has to be done in geom or in scales (see section \@ref(colours-and-fill).

Now the ggplot function has added the x and y axis to the plot.

### Geoms

To plot the actual data, you need a **geom function**.
There are many different geom functions that you can choose.
See chapter \@ref(types-of-vizualization) for an overview.

Here, we will use four different geoms to display aspects of the penguins data in different ways.
The legend is automatically plotted on the right side when needed.

```{r add-geom, eval = TRUE, fig.height=3, fig.width=3}
p1 <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, colour = species)) +
  geom_point()
p2 <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, colour = species)) +
  geom_density2d()
p3 <- ggplot(penguins, aes(x = species, fill = island)) +
  geom_bar()
p4 <- ggplot(penguins, aes(x = species, y = bill_depth_mm, fill = species)) +
  geom_boxplot()

```

```{r four-geoms, echo = FALSE}
library(patchwork)
p1 + labs(title = "geom_point()") + 
  p2 + labs(title = "geom_density2d()") + 
  p3 + labs(title = "geom_bar()") + 
  p4 + labs(title = "geom_boxplot()")
```



### Scales

**Scales** as the name says is for scaling, converting, inverting.
With scales you can manipulate the labels, breaks, transformations and palettes.
In other words you can manually change the axis text, labels, ticks, add breaks, make transformations, and manipulate aesthetics like colour, shape, linetype.

Here is just a small selection to show what is possible.
We can log transform the y axis, change the axis titles, and manipulate the colours.

```{r scales, eval = TRUE, fig.height = 3, fig.width=3.5}
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, colour = species)) +
  geom_point() +
  scale_y_log10(name = "Log bill length in mm") +
  scale_x_continuous(name = "Bill depth in mm") +
  scale_color_viridis_d()
```


### Labs

`labs()` is a useful function to modify the axis labels, titles and legend.

The axis titles can be renamed, and a title and tag can be added.

```{r labs, eval = TRUE, fig.height = 3, fig.width = 3.5}
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, colour = species)) +
  geom_point() +
  labs(x = "Bill depth in mm", y = "Bill length in mm", title = "Bill length vs. depth in penguins", tag = "A")
```

Titles can be useful for presentations, but generally not useful for manuscripts, where you can put the information into the caption. 
Tags are useful when building a multipart figure (see \@ref(combining-plots)).

### Stats

**Stats** are statistical transformations to summarize objects in the data in different ways.
You can add means or confidence intervals on top of your data.

```{r stats, eval = TRUE, fig.height = 3, fig.width=3.5}
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, colour = species)) +
  geom_point() +
  stat_summary(fun = "mean", colour = "red", size = 1)
```


### Facets
**Facets** can be used to divide the data into different subplots, which can enhance readability of a figure.

In the penguin example we can show 3 different panels for each island.
This way of plotting makes it easy to see which penguin species occurs on each island.

```{r facets, eval = TRUE, fig.height = 3, fig.width=5}
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, colour = species)) +
  geom_point() +
  facet_wrap(~ island)
```


### Themes

**Themes** is a powerful element that controls the look of the plot.
In themes you can change, remove and add the background, gridlines, ticks, text, text size and much more.

In our example, we will change the axis tile text size, the colour of the axis text and change the theme to `theme_minimal()`.

```{r theme, eval = TRUE, , fig.height = 3, fig.width=5}
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, colour = species)) +
  geom_point() +
  facet_wrap(~ island) +
  theme_minimal() +
  theme(axis.title = element_text(size = 14),
        axis.text = element_text(colour = "purple"))

```


### A ggplots are built with layers
As you can see, there are almost no limits to what you can do in a ggplot.
The trick is to know which element changes what and to remember all the names (i.e. what is axis.text and axis.ticks etc.).

The order in which you code the different components of a plot often does not matter  (although there are discussions around that topic, see here).
You can imagine the different components (geom, scale, stats) of the plot as different layers that are plotted on top of each other.
Usually, the order is not so important, unless something needs to be plotted on top of something else.
But this is easy to spot once you see the plot.

For example, you want to plot the data below and the mean values on top, and not the other way round.
See below, the red points showing the means have disappeared. 
So, the things you want on top are plotted after.

```{r wrong-order, eval = TRUE, fig.height = 3, fig.width=3.5}
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, colour = species)) +
  stat_summary(fun = "mean", colour = "red", size = 2) +
  geom_boxplot()

```


## Common mistakes {.tabset}

In the beginning you will make mistakes which will result in error messages, warnings or incomplete plots.
These mistakes often occur when one of the layers is missing, because a `+` is forgotten at the end of a line, due to a typo, or the data or other elements are forgotten.
Let us look at some common mistakes and how the ggplot is displayed or not.


### No data
If you forget to specify the data ggplot will not be able to make a plot and you will get the following error message:

```{r no-data, echo=TRUE, error=TRUE, fig.height = 3, fig.width=3.5}
ggplot(aes(x = bill_length_mm, y = bill_depth_mm, colour = species)) +
  geom_point()
```


### Missing aesthetics
If you forget to define the aesthetics `aes()` you will also get an error message and a empty image:
```{r no-aestetics, echo=TRUE, error=TRUE, eval=TRUE, fig.height = 3, fig.width=3.5}
ggplot(data = penguins) +
  geom_point()
```

### Missing geometry
If the geometry is missing `geom_point()`, ggplot will draw a empty plot, with axis labels, but show not data, because you have not defined how to plot the data.

```{r no-geom, fig.height = 3, fig.width=3.5}
ggplot(data = penguins, aes(x = bill_length_mm, y = bill_depth_mm, colour = species))
```



### What's next? {.facta}

Next, we will show the [essential elements]() of a plot (title, axes, legend, ...) and you can learn how to change and adapt each of these elements.
Further you can learn the most common [plots types]() that are commonly used.
