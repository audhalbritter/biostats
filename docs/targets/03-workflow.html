<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Enough targets to Write a Thesis - 3&nbsp; Getting started with targets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04-output.html" rel="next">
<link href="./02-abstraction.html" rel="prev">
<link href="./../figures/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-workflow.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting started with targets</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Enough targets to Write a Thesis</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/biostats-r/biostats" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Before you start</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-abstraction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Functions and abstraction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-workflow.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting started with targets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Output files</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#introduction-to-targets" id="toc-introduction-to-targets" class="nav-link active" data-scroll-target="#introduction-to-targets"><span class="header-section-number">3.1</span> Introduction to targets</a></li>
  <li>
<a href="#the-targets-pipeline" id="toc-the-targets-pipeline" class="nav-link" data-scroll-target="#the-targets-pipeline"><span class="header-section-number">3.2</span> The targets pipeline</a>
  <ul class="collapse">
<li><a href="#the-file-structure" id="toc-the-file-structure" class="nav-link" data-scroll-target="#the-file-structure"><span class="header-section-number">3.2.1</span> The file structure</a></li>
  <li><a href="#the-_target.r-file" id="toc-the-_target.r-file" class="nav-link" data-scroll-target="#the-_target.r-file"><span class="header-section-number">3.2.2</span> The _target.R file</a></li>
  <li><a href="#populate-the-_target.r-file" id="toc-populate-the-_target.r-file" class="nav-link" data-scroll-target="#populate-the-_target.r-file"><span class="header-section-number">3.2.3</span> Populate the _target.R file</a></li>
  <li><a href="#run-the-pipeline" id="toc-run-the-pipeline" class="nav-link" data-scroll-target="#run-the-pipeline"><span class="header-section-number">3.2.4</span> Run the pipeline</a></li>
  <li><a href="#load-targets" id="toc-load-targets" class="nav-link" data-scroll-target="#load-targets"><span class="header-section-number">3.2.5</span> Load targets</a></li>
  </ul>
</li>
  <li>
<a href="#trouble-shooting" id="toc-trouble-shooting" class="nav-link" data-scroll-target="#trouble-shooting"><span class="header-section-number">3.3</span> Trouble shooting</a>
  <ul class="collapse">
<li><a href="#load-targets-1" id="toc-load-targets-1" class="nav-link" data-scroll-target="#load-targets-1"><span class="header-section-number">3.3.1</span> Load targets</a></li>
  <li><a href="#object-not-found" id="toc-object-not-found" class="nav-link" data-scroll-target="#object-not-found"><span class="header-section-number">3.3.2</span> Object not found</a></li>
  <li><a href="#duplicate-target" id="toc-duplicate-target" class="nav-link" data-scroll-target="#duplicate-target"><span class="header-section-number">3.3.3</span> Duplicate target</a></li>
  </ul>
</li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources"><span class="header-section-number">3.4</span> Resources</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting started with targets</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
In this chapter, you will
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>learn the basic targets workflow</li>
<li>build your own targets pipeline</li>
</ul>
</div>
</div>
<section id="introduction-to-targets" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="introduction-to-targets">
<span class="header-section-number">3.1</span> Introduction to targets</h2>
<p>Targets is a <strong>pipeline tool</strong>, which coordinates the different steps in data science in R. It manages the workflow, takes care of dependencies in the code and keeps track of outdated objects. Targets takes care of the cash.</p>
<p>A targets <strong>pipeline</strong> consists of different steps, such as importing data, running an analysis or making a figure (<a href="#fig-targets-pipeline">Figure&nbsp;<span>3.1</span></a>) (1). Each step in the pipeline is a <strong>target</strong> and can for example be a data frame, a model or a figure. A target is basically an R object and is created by a <strong>function</strong>. A pipeline has a main script that puts all the pieces of code together and takes care of dependencies and keeping track of changes.</p>
<p>This concept should sound familiar to you after reading the previous chapter on abstraction.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Definitions
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>
<strong>pipeline tool</strong> - coordinates different steps of data science</li>
<li>
<strong>target</strong> - an R object in memory</li>
<li>
<strong>function</strong> - self contained code that accomplish a specific task</li>
</ul>
</div>
</div>
<p>When updating and rerunning one part of the code, targets will skip parts where the upstream code has not changed and are therefore still up to date (<a href="#fig-targets-pipeline">Figure&nbsp;<span>3.1</span></a>) (2). Targets will only rerun the code that is outdated and ensures that your results always match the underlying code and maintains a <strong>reproducible workflow</strong> (3). It avoids unnecessary repetition and can saves costly running time.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-targets-pipeline" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/reproducible_pipeline.png" class="img-fluid figure-img" alt="Reproducible targets pipeline." width="421"></p>
<figcaption class="figure-caption">Figure&nbsp;3.1: Reproducible targets pipeline.</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
When is targets useful?
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p>When the code has a long runtime because it is slow or complex. Targets avoids running code that up to date and allows for parallel processing.</p></li>
<li><p>When the workflow has interconnected tasks with dependencies</p></li>
</ul>
</div>
</div>
</section><section id="the-targets-pipeline" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="the-targets-pipeline">
<span class="header-section-number">3.2</span> The targets pipeline</h2>
<section id="the-file-structure" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="the-file-structure">
<span class="header-section-number">3.2.1</span> The file structure</h3>
<p>A target workflow has a specific file structure including R code, functions, qmd files, data and a <code>_targets.R</code> file (<a href="#fig-file-structure">Figure&nbsp;<span>3.2</span></a>). The <code>_targets.R</code> file is mandatory and the most important file defining the targets pipeline. This file lives at the root of the R project folder.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-file-structure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/file_structure.png" class="img-fluid figure-img" alt="The file structure of an R Studio project with a target pipeline." width="383"></p>
<figcaption class="figure-caption">Figure&nbsp;3.2: File structure of an R Studio project with a target pipeline.</figcaption></figure>
</div>
</div>
</div>
<p>An R project has many other files and it is recommended to keep code and data files in separate folders to keep the repository tidy. It is common to have one or several scripts that contain custom user-defined functions. These scripts should be stored in one folder. In this example we will call the folder <code>R</code>: <code>R/functions.R</code>.</p>
<p>To set up this file structure in an RStudio project, use the <code><a href="https://docs.ropensci.org/targets/reference/use_targets.html">use_targets()</a></code> function, which creates an initial <code>_targets.R</code> script with comments to help you populate the script. Note that it also creates a couple of other files, one of which is called <code>run.R</code>. This is a helper script to run the pipeline and will be explained later.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Go to the targets-workflow-svalbard Rstudio project and load the targets library <code><a href="https://docs.ropensci.org/targets/">library(targets)</a></code>. Then start to set up a targets pipeline by using the <code><a href="https://docs.ropensci.org/targets/reference/use_targets.html">use_targets()</a></code> function.</p>
</div>
</div>
</section><section id="the-_target.r-file" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="the-_target.r-file">
<span class="header-section-number">3.2.2</span> The _target.R file</h3>
<p>The <code>_targets.R</code> file is the <strong>main script</strong> and configures and defines the pipeline. This file is mandatory and without it the targets pipeline will not work. When using the <code><a href="https://docs.ropensci.org/targets/reference/use_targets.html">use_targets()</a></code> function, it sets up the basic structure and comments to help fill out the rest (see below 👇) .</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Created by use_targets().</span></span>
<span><span class="co"># Follow the comments below to fill in this target script.</span></span>
<span><span class="co"># Then follow the manual to check and run the pipeline:</span></span>
<span><span class="co">#   https://books.ropensci.org/targets/walkthrough.html#inspect-the-pipeline # nolint</span></span>
<span></span>
<span><span class="co"># Load packages required to define the pipeline:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/">targets</a></span><span class="op">)</span></span>
<span><span class="co"># library(tarchetypes) # Load other packages as needed. # nolint</span></span>
<span></span>
<span><span class="co"># Set target options:</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set</a></span><span class="op">(</span></span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tibble"</span><span class="op">)</span>, <span class="co"># packages that your targets need to run</span></span>
<span>  format <span class="op">=</span> <span class="st">"rds"</span> <span class="co"># default storage format</span></span>
<span>  <span class="co"># Set other options as needed.</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tar_make_clustermq() configuration (okay to leave alone):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>clustermq.scheduler <span class="op">=</span> <span class="st">"multicore"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tar_make_future() configuration (okay to leave alone):</span></span>
<span><span class="co"># Install packages {{future}}, {{future.callr}}, and {{future.batchtools}} to allow use_targets() to configure tar_make_future() options.</span></span>
<span></span>
<span><span class="co"># Run the R scripts in the R/ folder with your custom functions:</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_source.html">tar_source</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># source("other_functions.R") # Source other scripts as needed. # nolint</span></span>
<span></span>
<span><span class="co"># Replace the target list below with your own:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">data</span>,</span>
<span>    command <span class="op">=</span> <span class="fu">tibble</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#   format = "feather" # efficient storage of large data frames # nolint</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="va">model</span>,</span>
<span>    command <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coefficients</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Open the <code>_targets.R</code> in your repo and have a look at your <code>_targets.R</code> file.</p>
</div>
</div>
<p>The <code>_targets.R</code> file has three main components. Note that the file also contains other options which are optional. Let’s go through each component step-by-step.</p>
<ol type="1">
<li>
<code><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set()</a></code> <strong>sets all options</strong> such as load necessary packages or defining the output format. The argument <code>package</code> should have a list of all the required packages that are needed to run the pipeline. Note that <code>targets</code> and <code>tarchetypes</code> need to be loaded first and outside this function, otherwise the pipeline will not work. If your pipeline includes a quarto file, the packages that are only used in a quarto file can be loaded directly in there and do not need to be loaded in the <code>_targets.R</code> file. The argument <code>format</code> let’s you define default storage format.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load packages required to define the pipeline:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/">targets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/tarchetypes/">tarchetypes</a></span><span class="op">)</span> <span class="co"># Load other packages as needed.</span></span>
<span></span>
<span><span class="co"># Set target options:</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set</a></span><span class="op">(</span></span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tibble"</span><span class="op">)</span>, <span class="co"># packages that your targets need to run</span></span>
<span>  format <span class="op">=</span> <span class="st">"rds"</span> <span class="co"># default storage format</span></span>
<span>  <span class="co"># Set other options as needed.</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>The function <code><a href="https://docs.ropensci.org/targets/reference/tar_source.html">tar_source()</a></code> will <strong>source all the R scripts</strong> in the <code>R/</code> folder.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Run the R scripts in the R/ folder with your custom functions:</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_source.html">tar_source</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>The last section makes <strong>a list of targets</strong> which is the pipeline. Each target is a step in the pipeline, for example importing data, run an analysis or make a figure and looks like a normal R object (e.g.&nbsp;tibble, vector, figure). Each target is declared by the <code><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target()</a></code> function and separated by a comma. The <code><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target()</a></code> needs two arguments: <code>name</code> defines the target name and <code>command</code> the code to produce the target. Usually the command is calling a custom function.</li>
</ol>
<p>Here is a target that uses the function <code>fit_model()</code> that was created in the previous chapter to run a linear regression.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># fit model for plant height</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">model</span>,</span>
<span>             command <span class="op">=</span> <span class="fu">fit_model</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each target should have a unique name that can be called downstream in the pipeline. The order of the targets does not matter. The pipeline will figure out which targets depends on each other and run them in the right order.</p>
<p>Once the pipeline has run, the targets are stored.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Targets names
</div>
</div>
<div class="callout-body-container callout-body">
<p>Targets names must be unique (no duplicates), should not start with a dot and the name should be meaningful (do not use my_variable).</p>
</div>
</div>
<p><strong>Data files</strong> are special targets, because they also need the argument <code>format</code> to declare that this target is a file. Each time the pipeline is run, targetes will check if the file has been changed and if this is the case automatically import the data again the next time the pipeline is run.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">file</span>,</span>
<span>             command <span class="op">=</span> <span class="st">"data/PFTC4_Svalbard_2018_Gradient_Traits.csv"</span>,</span>
<span>             format <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How many targets should I make?
</div>
</div>
<div class="callout-body-container callout-body">
<p>A target should do one thing only (e.g.&nbsp;make a figure) and if a functions gets too long, it can be split into nested sub-functions to make the code readable and easier to maintain. Keep the number of targets manageable, which means keep a balance between the amount of code that goes in one target and the number of targets.</p>
</div>
</div>
</section><section id="populate-the-_target.r-file" class="level3" data-number="3.2.3"><h3 data-number="3.2.3" class="anchored" data-anchor-id="populate-the-_target.r-file">
<span class="header-section-number">3.2.3</span> Populate the _target.R file</h3>
<p>The next step is to populating the <code>_targets.R</code> file. We need to set the options, source the custom functions, and define the pipeline.</p>
<p>First, we need to add all R packages to the <code><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set()</a></code> function in the <code>_targets.R</code> file that are needed to run the pipeline.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Add all the necessary R packages in <code><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set()</a></code> in the <code>_targets.R</code> file that are needed to run the pipeline.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Set target options:</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html">tar_option_set</a></span><span class="op">(</span></span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tidyverse"</span><span class="op">)</span> <span class="co"># packages that your targets need to run</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>The next step is to source all the functions. The <code><a href="https://docs.ropensci.org/targets/reference/tar_source.html">tar_source()</a></code> function in the <code>_targets.R</code> file already does this.</p>
<p>The last step is to set up the targets pipeline.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Define the data file</strong></p>
<p>Add the dataset as data file in the <code>_targets.R</code> file.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">file</span>,</span>
<span>             command <span class="op">=</span> <span class="va">path</span>,</span>
<span>             format <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Add other targets to the pipeline</strong></p>
<p>Add four more targets to the pipeline that</p>
<ul>
<li><p>import the data</p></li>
<li><p>clean the data</p></li>
<li><p>run a linear regression</p></li>
<li><p>and make a figure</p></li>
</ul>
<p>The last three targets are calling custom functions from the <code>functions.R</code> file. The targets are separated by a comma.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># data file</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">file</span>,</span>
<span>             command <span class="op">=</span> <span class="va">path</span>,</span>
<span>             format <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># import data</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">target1</span>,</span>
<span>             command <span class="op">=</span> <span class="va">function1</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># clean data</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">target2</span>,</span>
<span>             command <span class="op">=</span> <span class="va">function2</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="va">...</span></span>
<span>  </span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Well done, you have just set up your first target pipeline. Have a treat 🥕!</p>
</section><section id="run-the-pipeline" class="level3" data-number="3.2.4"><h3 data-number="3.2.4" class="anchored" data-anchor-id="run-the-pipeline">
<span class="header-section-number">3.2.4</span> Run the pipeline</h3>
<p>Now we are ready to run the pipeline. For this open the <code>run.R</code> script and run the <code><a href="https://docs.ropensci.org/targets/reference/tar_make.html">tar_make()</a></code> function. This function looks for the <code>_targets.R</code> in the working directory and runs the pipeline.</p>
<p>When running the pipeline for the first time you will see a list of all the targets that are built (<a href="#fig-run-pipeline">Figure&nbsp;<span>3.3</span></a>). This is indicated by start target and build target.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-run-pipeline" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/pipeline.png" class="img-fluid figure-img" alt="R output after running the pipeline." width="361"></p>
<figcaption class="figure-caption">Figure&nbsp;3.3: R output after running the pipeline.</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Open the <code>run.R</code> script and run the pipeline. Hopefully, everything will run smoothly 🤞! If not check out the Trouble shooting section below.</p>
</div>
</div>
<p>Well done you have run your first targets pipeline. The <code><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html">tar_visnetwork()</a></code> function shows the dependency graph of the pipeline and is a nice way of vizualizing the pipeline. Circles are targets, triangles functions, and the colour indicates if the targets are up to date or not.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-vizualise" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/viz_workflow.png" class="img-fluid figure-img" alt="Dependency graph that vizualises the target pipeline." width="528"></p>
<figcaption class="figure-caption">Figure&nbsp;3.4: Vizualise the targets pipeline.</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Run <code><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html">tar_visnetwork()</a></code> to visualize your pipeline.</p>
</div>
</div>
<p>Once the pipeline has run, it will always skip the targets that have not changed and are up to date and only run the once that need updating. In the long run this will save a lot of computational time and is one of the big advantages of using targets pipelines.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-run-pipeline2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/pipeline2.png" class="img-fluid figure-img" alt="R output after running the pipeline." width="331"></p>
<figcaption class="figure-caption">Figure&nbsp;3.5: R output after running the pipeline.</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Change something in your pipeline (for example the name of a target), save the script and run <code><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html">tar_visnetwork()</a></code> to visualize which object are out of date.</p>
<p>Rerun the pipeline using tar_make().</p>
</div>
</div>
</section><section id="load-targets" class="level3" data-number="3.2.5"><h3 data-number="3.2.5" class="anchored" data-anchor-id="load-targets">
<span class="header-section-number">3.2.5</span> Load targets</h3>
<p>Each target can be loaded using <code><a href="https://docs.ropensci.org/targets/reference/tar_load.html">tar_load()</a></code> and the pipeline does not need rerunning each time before accessing the targets. This is a huge advantage of the targets pipeline and can save a lot of time.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_load.html">tar_load</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To access all the targets at once use <code><a href="https://docs.ropensci.org/targets/reference/tar_load_everything.html">tar_load_everything()</a></code>. In <code><a href="https://docs.ropensci.org/targets/reference/tar_load.html">tar_load()</a></code> you can also use tidy select commands to load specific targets, e.g.&nbsp;<code>tar_load(starts_with("y"))</code></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code><a href="https://docs.ropensci.org/targets/reference/tar_load.html">tar_load()</a></code> to load one target and use <code><a href="https://docs.ropensci.org/targets/reference/tar_load_everything.html">tar_load_everything()</a></code> to load all the targets in the pipeline.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Do it step by step
</div>
</div>
<div class="callout-body-container callout-body">
<p>Targets plans can become huge and complex. Start small, create a few targets and functions and make the plan running. Then add new code in small steps and check regularly if the plan is still working This will help to understand and solve errors (see trouble shooting section).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-complex-network" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/complex_network.png" class="img-fluid figure-img" alt="Dependency graph that vizualises a complex target pipeline." width="541"></p>
<figcaption class="figure-caption">Figure&nbsp;3.6: Vizualisation of complex target pipeline.</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
</section></section><section id="trouble-shooting" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="trouble-shooting">
<span class="header-section-number">3.3</span> Trouble shooting</h2>
<section id="load-targets-1" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="load-targets-1">
<span class="header-section-number">3.3.1</span> Load targets</h3>
<p>Error messages in targets can be hard to understand. One way to deal with errors is to use <code><a href="https://docs.ropensci.org/targets/reference/tar_load_everything.html">tar_load_everything()</a></code> to load all targets and then running each target separately to see where the problem is.</p>
</section><section id="object-not-found" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="object-not-found">
<span class="header-section-number">3.3.2</span> Object not found</h3>
<p>A common error is to call a target that does not exist. When running the pipeline this error will appear (<a href="#fig-error-not-found">Figure&nbsp;<span>3.7</span></a>). This is usually if the name is spelled wrong or when using an old name.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-error-not-found" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/error_not_found.png" class="img-fluid figure-img" alt="Error message for missing object." width="546"></p>
<figcaption class="figure-caption">Figure&nbsp;3.7: Error message for missing object</figcaption></figure>
</div>
</div>
</div>
</section><section id="duplicate-target" class="level3" data-number="3.3.3"><h3 data-number="3.3.3" class="anchored" data-anchor-id="duplicate-target">
<span class="header-section-number">3.3.3</span> Duplicate target</h3>
<p>Another common mistake is to use the same name for two different targets (<a href="#fig-error-duplicate">Figure&nbsp;<span>3.8</span></a>). This is common when copy pasting code. Rename one of the objects and the problem is solved.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-error-duplicate" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Pics/error_duplicate.png" class="img-fluid figure-img" alt="Error message for duplicate target." width="579"></p>
<figcaption class="figure-caption">Figure&nbsp;3.8: Error message for duplicate target.</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you have problems getting the target pipeline running, here is a working example that you can download or check online. Note that you need to have all the packages that are required for the targets pipeline to run installed.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#install.packages("usethis") # if you don't have it already.</span></span>
<span><span class="co">#usethis::use_course("biostats-r/targets_workflow_svalbard")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section></section><section id="resources" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="resources">
<span class="header-section-number">3.4</span> Resources</h2>
<ul>
<li>The <a href="https://books.ropensci.org/targets/">target manual</a> contains everything you need to know <!-- did not find it on github -->
</li>
<li>Here is a large and working <a href="">target plan</a>
</li>
<li>Here is a short introduction video <div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://player.vimeo.com/video/700982360" frameborder="0" allow="autoplay; title=" fullscreen="" picture-in-picture="" allowfullscreen=""></iframe></div>
</li>
</ul>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./02-abstraction.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Functions and abstraction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04-output.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Output files</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb11" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: sentence</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># Getting started with targets</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">## In this chapter, you will</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>learn the basic targets workflow</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>build your own targets pipeline</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction to targets</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>Targets is a **pipeline tool**, which coordinates the different steps in data science in R.</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>It manages the workflow, takes care of dependencies in the code and keeps track of outdated objects.</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>Targets takes care of the cash.</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>A targets **pipeline** consists of different steps, such as importing data, running an analysis or making a figure (@fig-targets-pipeline) (1).</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>Each step in the pipeline is a **target** and can for example be a data frame, a model or a figure.</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>A target is basically an R object and is created by a **function**.</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>A pipeline has a main script that puts all the pieces of code together and takes care of dependencies and keeping track of changes.</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>This concept should sound familiar to you after reading the previous chapter on abstraction.</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## Definitions</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**pipeline tool** - coordinates different steps of data science</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**target** - an R object in memory</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**function** - self contained code that accomplish a specific task</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>When updating and rerunning one part of the code, targets will skip parts where the upstream code has not changed and are therefore still up to date (@fig-targets-pipeline) (2).</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>Targets will only rerun the code that is outdated and ensures that your results always match the underlying code and maintains a  **reproducible workflow** (3). </span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>It avoids unnecessary repetition and can saves costly running time.</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-targets-pipeline</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Reproducible targets pipeline.</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Reproducible targets pipeline.</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/reproducible_pipeline.png"</span>)</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## When is targets useful?</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When the code has a long runtime because it is slow or complex. Targets avoids running code that up to date and allows for parallel processing.</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When the workflow has interconnected tasks with dependencies</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a><span class="fu">## The targets pipeline</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="fu">### The file structure</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>A target workflow has a specific file structure including R code, functions, qmd files, data and a <span class="in">`_targets.R`</span> file (@fig-file-structure).</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>The <span class="in">`_targets.R`</span> file is mandatory and the most important file defining the targets pipeline.</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>This file lives at the root of the R project folder.</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-file-structure</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: File structure of an R Studio project with a target pipeline.</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: The file structure of an R Studio project with a target pipeline.</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/file_structure.png"</span>)</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>An R project has many other files and it is recommended to keep code and data files in separate folders to keep the repository tidy.</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>It is common to have one or several scripts that contain custom user-defined functions.</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>These scripts should be stored in one folder. </span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>In this example we will call the folder <span class="in">`R`</span>: <span class="in">`R/functions.R`</span>.</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>To set up this file structure in an RStudio project, use the <span class="in">`use_targets()`</span> function, which creates an initial <span class="in">`_targets.R`</span> script with comments to help you populate the script.</span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>Note that it also creates a couple of other files, one of which is called <span class="in">`run.R`</span>.</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>This is a helper script to run the pipeline and will be explained later.</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>Go to the targets-workflow-svalbard Rstudio project and load the targets library <span class="in">`library(targets)`</span>.</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>Then start to set up a targets pipeline by using the <span class="in">`use_targets()`</span> function.</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a><span class="fu">### The _target.R file</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>The <span class="in">`_targets.R`</span> file is the **main script** and configures and defines the pipeline.</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>This file is mandatory and without it the targets pipeline will not work.</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>When using the <span class="in">`use_targets()`</span> function, it sets up the basic structure and comments to help fill out the rest (see below 👇) .</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: target-file</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Created by use_targets().</span></span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a><span class="co"># Follow the comments below to fill in this target script.</span></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a><span class="co"># Then follow the manual to check and run the pipeline:</span></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a><span class="co">#   https://books.ropensci.org/targets/walkthrough.html#inspect-the-pipeline # nolint</span></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages required to define the pipeline:</span></span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tarchetypes) # Load other packages as needed. # nolint</span></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Set target options:</span></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">"tibble"</span>), <span class="co"># packages that your targets need to run</span></span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"rds"</span> <span class="co"># default storage format</span></span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set other options as needed.</span></span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a><span class="co"># tar_make_clustermq() configuration (okay to leave alone):</span></span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">clustermq.scheduler =</span> <span class="st">"multicore"</span>)</span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a><span class="co"># tar_make_future() configuration (okay to leave alone):</span></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages {{future}}, {{future.callr}}, and {{future.batchtools}} to allow use_targets() to configure tar_make_future() options.</span></span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the R scripts in the R/ folder with your custom functions:</span></span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_source</span>()</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a><span class="co"># source("other_functions.R") # Source other scripts as needed. # nolint</span></span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the target list below with your own:</span></span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> data,</span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>    <span class="at">command =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>))</span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a><span class="co">#   format = "feather" # efficient storage of large data frames # nolint</span></span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(</span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> model,</span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">command =</span> <span class="fu">coefficients</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data))</span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>Open the <span class="in">`_targets.R`</span> in your repo and have a look at your <span class="in">`_targets.R`</span> file.</span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>The <span class="in">`_targets.R`</span> file has three main components.</span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>Note that the file also contains other options which are optional.</span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>Let's go through each component step-by-step.</span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="in">`tar_option_set()`</span> **sets all options** such as load necessary packages or defining the output format.</span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>The argument <span class="in">`package`</span> should have a list of all the required packages that are needed to run the pipeline.</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a>Note that <span class="in">`targets`</span> and <span class="in">`tarchetypes`</span> need to be loaded first and outside this function, otherwise the pipeline will not work.</span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a>If your pipeline includes a quarto file, the packages that are only used in a quarto file can be loaded directly in there and do not need to be loaded in the <span class="in">`_targets.R`</span> file.</span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>The argument <span class="in">`format`</span> let's you define default storage format. </span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tar-option</span></span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages required to define the pipeline:</span></span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(targets)</span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tarchetypes) <span class="co"># Load other packages as needed.</span></span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a><span class="co"># Set target options:</span></span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(</span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a>  <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">"tibble"</span>), <span class="co"># packages that your targets need to run</span></span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"rds"</span> <span class="co"># default storage format</span></span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set other options as needed.</span></span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>The function <span class="in">`tar_source()`</span> will **source all the R scripts** in the <span class="in">`R/`</span> folder.</span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tar-ssource</span></span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the R scripts in the R/ folder with your custom functions:</span></span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_source</span>()</span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>The last section makes **a list of targets** which is the pipeline.</span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a>Each target is a step in the pipeline, for example importing data, run an analysis or make a figure and looks like a normal R object (e.g. tibble, vector, figure).</span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a>Each target is declared by the <span class="in">`tar_target()`</span> function and separated by a comma.</span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a>The <span class="in">`tar_target()`</span> needs two arguments:</span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a><span class="in">`name`</span> defines the target name and <span class="in">`command`</span> the code to produce the target.</span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a>Usually the command is calling a custom function.</span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a>Here is a target that uses the function <span class="in">`fit_model()`</span> that was created in the previous chapter to run a linear regression.</span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: regression-target</span></span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model for plant height</span></span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> model,</span>
<span id="cb11-229"><a href="#cb11-229" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> <span class="fu">fit_model</span>(data))</span>
<span id="cb11-230"><a href="#cb11-230" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-231"><a href="#cb11-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-232"><a href="#cb11-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-233"><a href="#cb11-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-234"><a href="#cb11-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-235"><a href="#cb11-235" aria-hidden="true" tabindex="-1"></a>Each target should have a unique name that can be called downstream in the pipeline.</span>
<span id="cb11-236"><a href="#cb11-236" aria-hidden="true" tabindex="-1"></a>The order of the targets does not matter.</span>
<span id="cb11-237"><a href="#cb11-237" aria-hidden="true" tabindex="-1"></a>The pipeline will figure out which targets depends on each other and run them in the right order.</span>
<span id="cb11-238"><a href="#cb11-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-239"><a href="#cb11-239" aria-hidden="true" tabindex="-1"></a>Once the pipeline has run, the targets are stored.</span>
<span id="cb11-240"><a href="#cb11-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-241"><a href="#cb11-241" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb11-242"><a href="#cb11-242" aria-hidden="true" tabindex="-1"></a><span class="fu">## Targets names</span></span>
<span id="cb11-243"><a href="#cb11-243" aria-hidden="true" tabindex="-1"></a>Targets names must be unique (no duplicates), should not start with a dot and the name should be meaningful (do not use my_variable).</span>
<span id="cb11-244"><a href="#cb11-244" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-245"><a href="#cb11-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-246"><a href="#cb11-246" aria-hidden="true" tabindex="-1"></a>**Data files** are special targets, because they also need the argument <span class="in">`format`</span> to declare that this target is a file.</span>
<span id="cb11-247"><a href="#cb11-247" aria-hidden="true" tabindex="-1"></a>Each time the pipeline is run, targetes will check if the file has been changed and if this is the case automatically import the data again the next time the pipeline is run.</span>
<span id="cb11-248"><a href="#cb11-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-251"><a href="#cb11-251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-252"><a href="#cb11-252" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-target</span></span>
<span id="cb11-253"><a href="#cb11-253" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb11-254"><a href="#cb11-254" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb11-255"><a href="#cb11-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-256"><a href="#cb11-256" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb11-257"><a href="#cb11-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> file,</span>
<span id="cb11-258"><a href="#cb11-258" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> <span class="st">"data/PFTC4_Svalbard_2018_Gradient_Traits.csv"</span>,</span>
<span id="cb11-259"><a href="#cb11-259" aria-hidden="true" tabindex="-1"></a>             <span class="at">format =</span> <span class="st">"file"</span>)</span>
<span id="cb11-260"><a href="#cb11-260" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-261"><a href="#cb11-261" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-262"><a href="#cb11-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-263"><a href="#cb11-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-264"><a href="#cb11-264" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb11-265"><a href="#cb11-265" aria-hidden="true" tabindex="-1"></a><span class="fu">## How many targets should I make?</span></span>
<span id="cb11-266"><a href="#cb11-266" aria-hidden="true" tabindex="-1"></a>A target should do one thing only (e.g. make a figure) and if a functions gets too long, it can be split into nested sub-functions to make the code readable and easier to maintain.</span>
<span id="cb11-267"><a href="#cb11-267" aria-hidden="true" tabindex="-1"></a>Keep the number of targets manageable, which means keep a balance between the amount of code that goes in one target and the number of targets.</span>
<span id="cb11-268"><a href="#cb11-268" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-269"><a href="#cb11-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-270"><a href="#cb11-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-271"><a href="#cb11-271" aria-hidden="true" tabindex="-1"></a><span class="fu">### Populate the _target.R file</span></span>
<span id="cb11-272"><a href="#cb11-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-273"><a href="#cb11-273" aria-hidden="true" tabindex="-1"></a>The next step is to populating the <span class="in">`_targets.R`</span> file.</span>
<span id="cb11-274"><a href="#cb11-274" aria-hidden="true" tabindex="-1"></a>We need to set the options, source the custom functions, and define the pipeline.</span>
<span id="cb11-275"><a href="#cb11-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-276"><a href="#cb11-276" aria-hidden="true" tabindex="-1"></a>First, we need to add all R packages to the <span class="in">`tar_option_set()`</span> function in the <span class="in">`_targets.R`</span> file that are needed to run the pipeline.</span>
<span id="cb11-277"><a href="#cb11-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-278"><a href="#cb11-278" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-279"><a href="#cb11-279" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb11-280"><a href="#cb11-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-281"><a href="#cb11-281" aria-hidden="true" tabindex="-1"></a>Add all the necessary R packages in <span class="in">`tar_option_set()`</span> in the <span class="in">`_targets.R`</span> file that are needed to run the pipeline.</span>
<span id="cb11-282"><a href="#cb11-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-285"><a href="#cb11-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-286"><a href="#cb11-286" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tar-option-example</span></span>
<span id="cb11-287"><a href="#cb11-287" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb11-288"><a href="#cb11-288" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb11-289"><a href="#cb11-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-290"><a href="#cb11-290" aria-hidden="true" tabindex="-1"></a><span class="co"># Set target options:</span></span>
<span id="cb11-291"><a href="#cb11-291" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_option_set</span>(</span>
<span id="cb11-292"><a href="#cb11-292" aria-hidden="true" tabindex="-1"></a>  <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>) <span class="co"># packages that your targets need to run</span></span>
<span id="cb11-293"><a href="#cb11-293" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-294"><a href="#cb11-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-295"><a href="#cb11-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-296"><a href="#cb11-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-297"><a href="#cb11-297" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-298"><a href="#cb11-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-299"><a href="#cb11-299" aria-hidden="true" tabindex="-1"></a>The next step is to source all the functions.</span>
<span id="cb11-300"><a href="#cb11-300" aria-hidden="true" tabindex="-1"></a>The <span class="in">`tar_source()`</span> function in the <span class="in">`_targets.R`</span> file already does this.</span>
<span id="cb11-301"><a href="#cb11-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-302"><a href="#cb11-302" aria-hidden="true" tabindex="-1"></a>The last step is to set up the targets pipeline.</span>
<span id="cb11-303"><a href="#cb11-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-304"><a href="#cb11-304" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-305"><a href="#cb11-305" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb11-306"><a href="#cb11-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-307"><a href="#cb11-307" aria-hidden="true" tabindex="-1"></a>**Define the data file**</span>
<span id="cb11-308"><a href="#cb11-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-309"><a href="#cb11-309" aria-hidden="true" tabindex="-1"></a>Add the dataset as data file in the <span class="in">`_targets.R`</span> file.</span>
<span id="cb11-310"><a href="#cb11-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-311"><a href="#cb11-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-314"><a href="#cb11-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-315"><a href="#cb11-315" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-target2</span></span>
<span id="cb11-316"><a href="#cb11-316" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb11-317"><a href="#cb11-317" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb11-318"><a href="#cb11-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-319"><a href="#cb11-319" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb11-320"><a href="#cb11-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> file,</span>
<span id="cb11-321"><a href="#cb11-321" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> path,</span>
<span id="cb11-322"><a href="#cb11-322" aria-hidden="true" tabindex="-1"></a>             <span class="at">format =</span> <span class="st">"file"</span>)</span>
<span id="cb11-323"><a href="#cb11-323" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-324"><a href="#cb11-324" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-325"><a href="#cb11-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-326"><a href="#cb11-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-327"><a href="#cb11-327" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-328"><a href="#cb11-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-329"><a href="#cb11-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-330"><a href="#cb11-330" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-331"><a href="#cb11-331" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb11-332"><a href="#cb11-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-333"><a href="#cb11-333" aria-hidden="true" tabindex="-1"></a>**Add other targets to the pipeline**</span>
<span id="cb11-334"><a href="#cb11-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-335"><a href="#cb11-335" aria-hidden="true" tabindex="-1"></a>Add four more targets to the pipeline that</span>
<span id="cb11-336"><a href="#cb11-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-337"><a href="#cb11-337" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>import the data</span>
<span id="cb11-338"><a href="#cb11-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-339"><a href="#cb11-339" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>clean the data</span>
<span id="cb11-340"><a href="#cb11-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-341"><a href="#cb11-341" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>run a linear regression</span>
<span id="cb11-342"><a href="#cb11-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-343"><a href="#cb11-343" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>and make a figure</span>
<span id="cb11-344"><a href="#cb11-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-345"><a href="#cb11-345" aria-hidden="true" tabindex="-1"></a>The last three targets are calling custom functions from the <span class="in">`functions.R`</span> file.</span>
<span id="cb11-346"><a href="#cb11-346" aria-hidden="true" tabindex="-1"></a>The targets are separated by a comma.</span>
<span id="cb11-347"><a href="#cb11-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-348"><a href="#cb11-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-349"><a href="#cb11-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-352"><a href="#cb11-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-353"><a href="#cb11-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: pipeline</span></span>
<span id="cb11-354"><a href="#cb11-354" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb11-355"><a href="#cb11-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb11-356"><a href="#cb11-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-357"><a href="#cb11-357" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb11-358"><a href="#cb11-358" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data file</span></span>
<span id="cb11-359"><a href="#cb11-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> file,</span>
<span id="cb11-360"><a href="#cb11-360" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> path,</span>
<span id="cb11-361"><a href="#cb11-361" aria-hidden="true" tabindex="-1"></a>             <span class="at">format =</span> <span class="st">"file"</span>),</span>
<span id="cb11-362"><a href="#cb11-362" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-363"><a href="#cb11-363" aria-hidden="true" tabindex="-1"></a>  <span class="co"># import data</span></span>
<span id="cb11-364"><a href="#cb11-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> target1,</span>
<span id="cb11-365"><a href="#cb11-365" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> function1),</span>
<span id="cb11-366"><a href="#cb11-366" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-367"><a href="#cb11-367" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clean data</span></span>
<span id="cb11-368"><a href="#cb11-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tar_target</span>(<span class="at">name =</span> target2,</span>
<span id="cb11-369"><a href="#cb11-369" aria-hidden="true" tabindex="-1"></a>             <span class="at">command =</span> function2),</span>
<span id="cb11-370"><a href="#cb11-370" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-371"><a href="#cb11-371" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb11-372"><a href="#cb11-372" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-373"><a href="#cb11-373" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-374"><a href="#cb11-374" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-375"><a href="#cb11-375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-376"><a href="#cb11-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-377"><a href="#cb11-377" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-378"><a href="#cb11-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-379"><a href="#cb11-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-380"><a href="#cb11-380" aria-hidden="true" tabindex="-1"></a>Well done, you have just set up your first target pipeline.</span>
<span id="cb11-381"><a href="#cb11-381" aria-hidden="true" tabindex="-1"></a>Have a treat 🥕!</span>
<span id="cb11-382"><a href="#cb11-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-383"><a href="#cb11-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-384"><a href="#cb11-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-385"><a href="#cb11-385" aria-hidden="true" tabindex="-1"></a><span class="fu">### Run the pipeline</span></span>
<span id="cb11-386"><a href="#cb11-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-387"><a href="#cb11-387" aria-hidden="true" tabindex="-1"></a>Now we are ready to run the pipeline.</span>
<span id="cb11-388"><a href="#cb11-388" aria-hidden="true" tabindex="-1"></a>For this open the <span class="in">`run.R`</span> script and run the <span class="in">`tar_make()`</span> function.</span>
<span id="cb11-389"><a href="#cb11-389" aria-hidden="true" tabindex="-1"></a>This function looks for the <span class="in">`_targets.R`</span> in the working directory and runs the pipeline.</span>
<span id="cb11-390"><a href="#cb11-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-391"><a href="#cb11-391" aria-hidden="true" tabindex="-1"></a>When running the pipeline for the first time you will see a list of all the targets that are built (@fig-run-pipeline).</span>
<span id="cb11-392"><a href="#cb11-392" aria-hidden="true" tabindex="-1"></a>This is indicated by start target and build target.</span>
<span id="cb11-393"><a href="#cb11-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-396"><a href="#cb11-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-397"><a href="#cb11-397" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-run-pipeline</span></span>
<span id="cb11-398"><a href="#cb11-398" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb11-399"><a href="#cb11-399" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: R output after running the pipeline.</span></span>
<span id="cb11-400"><a href="#cb11-400" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: R output after running the pipeline.</span></span>
<span id="cb11-401"><a href="#cb11-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-402"><a href="#cb11-402" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/pipeline.png"</span>)</span>
<span id="cb11-403"><a href="#cb11-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-404"><a href="#cb11-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-405"><a href="#cb11-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-406"><a href="#cb11-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-407"><a href="#cb11-407" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-408"><a href="#cb11-408" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb11-409"><a href="#cb11-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-410"><a href="#cb11-410" aria-hidden="true" tabindex="-1"></a>Open the <span class="in">`run.R`</span> script and run the pipeline.</span>
<span id="cb11-411"><a href="#cb11-411" aria-hidden="true" tabindex="-1"></a>Hopefully, everything will run smoothly 🤞!</span>
<span id="cb11-412"><a href="#cb11-412" aria-hidden="true" tabindex="-1"></a>If not check out the Trouble shooting section below.</span>
<span id="cb11-413"><a href="#cb11-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-414"><a href="#cb11-414" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-415"><a href="#cb11-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-416"><a href="#cb11-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-417"><a href="#cb11-417" aria-hidden="true" tabindex="-1"></a>Well done you have run your first targets pipeline.</span>
<span id="cb11-418"><a href="#cb11-418" aria-hidden="true" tabindex="-1"></a>The <span class="in">`tar_visnetwork()`</span> function shows the dependency graph of the pipeline and is a nice way of vizualizing the pipeline.</span>
<span id="cb11-419"><a href="#cb11-419" aria-hidden="true" tabindex="-1"></a>Circles are targets, triangles functions, and the colour indicates if the targets are up to date or not.</span>
<span id="cb11-420"><a href="#cb11-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-423"><a href="#cb11-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-424"><a href="#cb11-424" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-vizualise</span></span>
<span id="cb11-425"><a href="#cb11-425" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb11-426"><a href="#cb11-426" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Vizualise the targets pipeline.</span></span>
<span id="cb11-427"><a href="#cb11-427" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Dependency graph that vizualises the target pipeline.</span></span>
<span id="cb11-428"><a href="#cb11-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-429"><a href="#cb11-429" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/viz_workflow.png"</span>)</span>
<span id="cb11-430"><a href="#cb11-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-431"><a href="#cb11-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-432"><a href="#cb11-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-433"><a href="#cb11-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-434"><a href="#cb11-434" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-435"><a href="#cb11-435" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb11-436"><a href="#cb11-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-437"><a href="#cb11-437" aria-hidden="true" tabindex="-1"></a>Run <span class="in">`tar_visnetwork()`</span> to visualize your pipeline.</span>
<span id="cb11-438"><a href="#cb11-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-439"><a href="#cb11-439" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-440"><a href="#cb11-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-441"><a href="#cb11-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-442"><a href="#cb11-442" aria-hidden="true" tabindex="-1"></a>Once the pipeline has run, it will always skip the targets that have not changed and are up to date and only run the once that need updating.</span>
<span id="cb11-443"><a href="#cb11-443" aria-hidden="true" tabindex="-1"></a>In the long run this will save a lot of computational time and is one of the big advantages of using targets pipelines.</span>
<span id="cb11-444"><a href="#cb11-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-445"><a href="#cb11-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-448"><a href="#cb11-448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-449"><a href="#cb11-449" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-run-pipeline2</span></span>
<span id="cb11-450"><a href="#cb11-450" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb11-451"><a href="#cb11-451" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: R output after running the pipeline.</span></span>
<span id="cb11-452"><a href="#cb11-452" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: R output after running the pipeline.</span></span>
<span id="cb11-453"><a href="#cb11-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-454"><a href="#cb11-454" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/pipeline2.png"</span>)</span>
<span id="cb11-455"><a href="#cb11-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-456"><a href="#cb11-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-457"><a href="#cb11-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-458"><a href="#cb11-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-459"><a href="#cb11-459" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-460"><a href="#cb11-460" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb11-461"><a href="#cb11-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-462"><a href="#cb11-462" aria-hidden="true" tabindex="-1"></a>Change something in your pipeline (for example the name of a target), save the script and run <span class="in">`tar_visnetwork()`</span> to visualize which object are out of date.</span>
<span id="cb11-463"><a href="#cb11-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-464"><a href="#cb11-464" aria-hidden="true" tabindex="-1"></a>Rerun the pipeline using tar_make().</span>
<span id="cb11-465"><a href="#cb11-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-466"><a href="#cb11-466" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-467"><a href="#cb11-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-468"><a href="#cb11-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-469"><a href="#cb11-469" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load targets</span></span>
<span id="cb11-470"><a href="#cb11-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-471"><a href="#cb11-471" aria-hidden="true" tabindex="-1"></a>Each target can be loaded using <span class="in">`tar_load()`</span> and the pipeline does not need rerunning each time before accessing the targets.</span>
<span id="cb11-472"><a href="#cb11-472" aria-hidden="true" tabindex="-1"></a>This is a huge advantage of the targets pipeline and can save a lot of time. </span>
<span id="cb11-473"><a href="#cb11-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-476"><a href="#cb11-476" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-477"><a href="#cb11-477" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-target</span></span>
<span id="cb11-478"><a href="#cb11-478" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb11-479"><a href="#cb11-479" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb11-480"><a href="#cb11-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-481"><a href="#cb11-481" aria-hidden="true" tabindex="-1"></a><span class="fu">tar_load</span>(model)</span>
<span id="cb11-482"><a href="#cb11-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-483"><a href="#cb11-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-484"><a href="#cb11-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-485"><a href="#cb11-485" aria-hidden="true" tabindex="-1"></a>To access all the targets at once use <span class="in">`tar_load_everything()`</span>.</span>
<span id="cb11-486"><a href="#cb11-486" aria-hidden="true" tabindex="-1"></a>In <span class="in">`tar_load()`</span> you can also use tidy select commands to load specific targets, e.g. <span class="in">`tar_load(starts_with("y"))`</span></span>
<span id="cb11-487"><a href="#cb11-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-488"><a href="#cb11-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-489"><a href="#cb11-489" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-490"><a href="#cb11-490" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb11-491"><a href="#cb11-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-492"><a href="#cb11-492" aria-hidden="true" tabindex="-1"></a>Use <span class="in">`tar_load()`</span> to load one target and use <span class="in">`tar_load_everything()`</span> to load all the targets in the pipeline.</span>
<span id="cb11-493"><a href="#cb11-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-494"><a href="#cb11-494" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-495"><a href="#cb11-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-496"><a href="#cb11-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-497"><a href="#cb11-497" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb11-498"><a href="#cb11-498" aria-hidden="true" tabindex="-1"></a><span class="fu">## Do it step by step</span></span>
<span id="cb11-499"><a href="#cb11-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-500"><a href="#cb11-500" aria-hidden="true" tabindex="-1"></a>Targets plans can become huge and complex.</span>
<span id="cb11-501"><a href="#cb11-501" aria-hidden="true" tabindex="-1"></a>Start small, create a few targets and functions and make the plan running.</span>
<span id="cb11-502"><a href="#cb11-502" aria-hidden="true" tabindex="-1"></a>Then add new code in small steps and check regularly if the plan is still working</span>
<span id="cb11-503"><a href="#cb11-503" aria-hidden="true" tabindex="-1"></a>This will help to understand and solve errors (see trouble shooting section).</span>
<span id="cb11-504"><a href="#cb11-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-507"><a href="#cb11-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-508"><a href="#cb11-508" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-complex-network</span></span>
<span id="cb11-509"><a href="#cb11-509" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb11-510"><a href="#cb11-510" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Vizualisation of complex target pipeline.</span></span>
<span id="cb11-511"><a href="#cb11-511" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Dependency graph that vizualises a complex target pipeline.</span></span>
<span id="cb11-512"><a href="#cb11-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-513"><a href="#cb11-513" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/complex_network.png"</span>)</span>
<span id="cb11-514"><a href="#cb11-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-515"><a href="#cb11-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-516"><a href="#cb11-516" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-517"><a href="#cb11-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-518"><a href="#cb11-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-519"><a href="#cb11-519" aria-hidden="true" tabindex="-1"></a><span class="fu">## Trouble shooting</span></span>
<span id="cb11-520"><a href="#cb11-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-521"><a href="#cb11-521" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load targets</span></span>
<span id="cb11-522"><a href="#cb11-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-523"><a href="#cb11-523" aria-hidden="true" tabindex="-1"></a>Error messages in targets can be hard to understand.</span>
<span id="cb11-524"><a href="#cb11-524" aria-hidden="true" tabindex="-1"></a>One way to deal with errors is to use <span class="in">`tar_load_everything()`</span> to load all targets and then running each target separately to see where the problem is.</span>
<span id="cb11-525"><a href="#cb11-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-526"><a href="#cb11-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-527"><a href="#cb11-527" aria-hidden="true" tabindex="-1"></a><span class="fu">### Object not found</span></span>
<span id="cb11-528"><a href="#cb11-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-529"><a href="#cb11-529" aria-hidden="true" tabindex="-1"></a>A common error is to call a target that does not exist.</span>
<span id="cb11-530"><a href="#cb11-530" aria-hidden="true" tabindex="-1"></a>When running the pipeline this error will appear (@fig-error-not-found).</span>
<span id="cb11-531"><a href="#cb11-531" aria-hidden="true" tabindex="-1"></a>This is usually if the name is spelled wrong or when using an old name.</span>
<span id="cb11-532"><a href="#cb11-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-535"><a href="#cb11-535" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-536"><a href="#cb11-536" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-error-not-found</span></span>
<span id="cb11-537"><a href="#cb11-537" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb11-538"><a href="#cb11-538" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Error message for missing object</span></span>
<span id="cb11-539"><a href="#cb11-539" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Error message for missing object.</span></span>
<span id="cb11-540"><a href="#cb11-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-541"><a href="#cb11-541" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/error_not_found.png"</span>)</span>
<span id="cb11-542"><a href="#cb11-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-543"><a href="#cb11-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-544"><a href="#cb11-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-545"><a href="#cb11-545" aria-hidden="true" tabindex="-1"></a><span class="fu">### Duplicate target</span></span>
<span id="cb11-546"><a href="#cb11-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-547"><a href="#cb11-547" aria-hidden="true" tabindex="-1"></a>Another common mistake is to use the same name for two different targets (@fig-error-duplicate).</span>
<span id="cb11-548"><a href="#cb11-548" aria-hidden="true" tabindex="-1"></a>This is common when copy pasting code.</span>
<span id="cb11-549"><a href="#cb11-549" aria-hidden="true" tabindex="-1"></a>Rename one of the objects and the problem is solved.</span>
<span id="cb11-550"><a href="#cb11-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-553"><a href="#cb11-553" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-554"><a href="#cb11-554" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-error-duplicate</span></span>
<span id="cb11-555"><a href="#cb11-555" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb11-556"><a href="#cb11-556" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Error message for duplicate target.</span></span>
<span id="cb11-557"><a href="#cb11-557" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-alt: Error message for duplicate target.</span></span>
<span id="cb11-558"><a href="#cb11-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-559"><a href="#cb11-559" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"Pics/error_duplicate.png"</span>)</span>
<span id="cb11-560"><a href="#cb11-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-561"><a href="#cb11-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-562"><a href="#cb11-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-563"><a href="#cb11-563" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb11-564"><a href="#cb11-564" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb11-565"><a href="#cb11-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-566"><a href="#cb11-566" aria-hidden="true" tabindex="-1"></a>If you have problems getting the target pipeline running, here is a working example that you can download or check online.</span>
<span id="cb11-567"><a href="#cb11-567" aria-hidden="true" tabindex="-1"></a>Note that you need to have all the packages that are required for the targets pipeline to run installed.</span>
<span id="cb11-568"><a href="#cb11-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-571"><a href="#cb11-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb11-572"><a href="#cb11-572" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: working-pipeline</span></span>
<span id="cb11-573"><a href="#cb11-573" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb11-574"><a href="#cb11-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-575"><a href="#cb11-575" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("usethis") # if you don't have it already.</span></span>
<span id="cb11-576"><a href="#cb11-576" aria-hidden="true" tabindex="-1"></a><span class="co">#usethis::use_course("biostats-r/targets_workflow_svalbard")</span></span>
<span id="cb11-577"><a href="#cb11-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-578"><a href="#cb11-578" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb11-579"><a href="#cb11-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-580"><a href="#cb11-580" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb11-581"><a href="#cb11-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-582"><a href="#cb11-582" aria-hidden="true" tabindex="-1"></a><span class="fu">## Resources</span></span>
<span id="cb11-583"><a href="#cb11-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-584"><a href="#cb11-584" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The <span class="co">[</span><span class="ot">target manual</span><span class="co">](https://books.ropensci.org/targets/)</span> contains everything you need to know</span>
<span id="cb11-585"><a href="#cb11-585" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- did not find it on github --&gt;</span></span>
<span id="cb11-586"><a href="#cb11-586" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here is a large and working <span class="co">[</span><span class="ot">target plan</span><span class="co">]()</span></span>
<span id="cb11-587"><a href="#cb11-587" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here is a short introduction video {{&lt; video https://vimeo.com/700982360 &gt;}}</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>