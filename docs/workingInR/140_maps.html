<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Working in R - 20&nbsp; Making maps in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./050_missing_values.html" rel="next">
<link href="./130_patchwork.html" rel="prev">
<link href="./../figures/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
</head>
<body class="nav-sidebar floating slimcontent">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./100_why_data_visualisation.html">Data Visualisation</a></li><li class="breadcrumb-item"><a href="./140_maps.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Making maps in R</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Working in R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/biostats-r/biostats" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Setting up R and RStudio</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0010_Getting_Started_with_RStudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Installing and configuring R and RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0011_projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RStudio projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0012_scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Working with a script</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0013_packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Installing packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0014-quiz-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Set-up quiz</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">First steps in R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./002_First_Steps_in_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">First steps in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./005_Importing_Data_in_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Importing data in R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Data manipulation with the tidyverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-pipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Pipes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./011-tidyr-pivot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Tidying data with <code>tidyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./012-dplyr-single-table.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Working with single tables in <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./013-dplyr-multiple-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Working with multiple tables in <code>dplyr</code></span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Data Visualisation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./100_why_data_visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Why is data visualization important?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./101_getting_started_with_ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Getting started with ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./103_different_types_of_vizualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Choosing your visualisation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./118_themes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Themes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./120_colour_shape_linetypes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Colours, shapes and linetypes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./125_ggplot_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Regression and ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./130_patchwork.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Combining plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./140_maps.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Making maps in R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Other Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./050_missing_values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Handling missing values</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./060_bestiary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Bestiary of Brackets and other R notation</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<style>
               img.site-logo {
  height: auto;
  width: 95%;
}
      </style>
<p><a  href="https://biostats.w.uib.no/" aria-label="bioST@TS | When biology adds up, at last&#8230;"><img class="site-logo" src="https://biostats.w.uib.no/files/2020/01/biostats-button-res2.png" alt="BioST@TS homepage" width="250" height="101"  data-no-retina class=" attachment-11864" title = "BioST@TS homepage"/></a>  
<br><a  href="../index.html" aria-label="bioST@TS | When biology adds up, at last&#8230;"><img class="site-logo" src="../figures/icons_all.png" alt= "BioST@TS books" width="250" height="101"  data-no-retina class=" attachment-11864", title = "BioST@TS books"/></a>   </p>
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#vector-base-maps" id="toc-vector-base-maps" class="nav-link active" data-scroll-target="#vector-base-maps"><span class="header-section-number">20.1</span> Vector base maps</a>
  <ul class="collapse">
<li><a href="#rnaturalearth" id="toc-rnaturalearth" class="nav-link" data-scroll-target="#rnaturalearth"><span class="header-section-number">20.1.1</span> <code>rnaturalearth</code></a></li>
  <li><a href="#ggoceanmaps" id="toc-ggoceanmaps" class="nav-link" data-scroll-target="#ggoceanmaps"><span class="header-section-number">20.1.2</span> <code>ggOceanMaps</code></a></li>
  <li><a href="#other-vector-files" id="toc-other-vector-files" class="nav-link" data-scroll-target="#other-vector-files"><span class="header-section-number">20.1.3</span> Other vector files</a></li>
  </ul>
</li>
  <li>
<a href="#tiled-basemaps" id="toc-tiled-basemaps" class="nav-link" data-scroll-target="#tiled-basemaps"><span class="header-section-number">20.2</span> Tiled basemaps</a>
  <ul class="collapse">
<li><a href="#ggspatial" id="toc-ggspatial" class="nav-link" data-scroll-target="#ggspatial"><span class="header-section-number">20.2.1</span> <code>ggspatial</code></a></li>
  <li><a href="#ggmap" id="toc-ggmap" class="nav-link" data-scroll-target="#ggmap"><span class="header-section-number">20.2.2</span> <code>ggmap</code></a></li>
  </ul>
</li>
  <li>
<a href="#raster-basemaps" id="toc-raster-basemaps" class="nav-link" data-scroll-target="#raster-basemaps"><span class="header-section-number">20.3</span> Raster basemaps</a>
  <ul class="collapse">
<li><a href="#terra" id="toc-terra" class="nav-link" data-scroll-target="#terra"><span class="header-section-number">20.3.1</span> <code>terra</code></a></li>
  </ul>
</li>
  <li>
<a href="#adding-data-to-the-basemap" id="toc-adding-data-to-the-basemap" class="nav-link" data-scroll-target="#adding-data-to-the-basemap"><span class="header-section-number">20.4</span> Adding data to the basemap</a>
  <ul class="collapse">
<li><a href="#pointslinespolygons" id="toc-pointslinespolygons" class="nav-link" data-scroll-target="#pointslinespolygons"><span class="header-section-number">20.4.1</span> points/lines/polygons</a></li>
  <li><a href="#cloropleth-maps" id="toc-cloropleth-maps" class="nav-link" data-scroll-target="#cloropleth-maps"><span class="header-section-number">20.4.2</span> Cloropleth maps</a></li>
  <li><a href="#raster" id="toc-raster" class="nav-link" data-scroll-target="#raster"><span class="header-section-number">20.4.3</span> raster</a></li>
  </ul>
</li>
  <li><a href="#scalebars-north-pointer-etc" id="toc-scalebars-north-pointer-etc" class="nav-link" data-scroll-target="#scalebars-north-pointer-etc"><span class="header-section-number">20.5</span> Scalebars, north pointer etc</a></li>
  <li>
<a href="#hints-for-maps" id="toc-hints-for-maps" class="nav-link" data-scroll-target="#hints-for-maps"><span class="header-section-number">20.6</span> Hints for maps</a>
  <ul class="collapse">
<li><a href="#projections" id="toc-projections" class="nav-link" data-scroll-target="#projections"><span class="header-section-number">20.6.1</span> Projections</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Making maps in R</span>
</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>Biologists need almost as many maps as geographers, perhaps to show where our field sites are, the range of a species, or the migration path of a bird.</p>
<p>Typically, the data we want to show is added to a base map. These can be added to different types of base map</p>
<ul>
<li><p>vector map showing the coastline, and perhaps political borders, rivers and other features</p></li>
<li><p>A map made of downloaded tiles (similar to how Google maps works)</p></li>
<li><p>A raster (made of pixels)</p></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Terminology
</div>
</div>
<div class="callout-body-container callout-body">
<p>Small scale vs large scale? The terminology is confusing!</p>
<p>Map scales are given as a ratio. A world map might have a scale of 1:100000000. 1 cm on the map represents 100000000 cm on the ground - a ratio of 1/100000000. A small number hence a small-scale map.</p>
<p>Conversely, a map of a city might have a scale of 1:25000. 1 cm on the map represents 25000 cm on the ground - a ratio of 1/25000. A large number hence a large-scale map.</p>
<p>Large-scale maps are usually high resolution and cover a small spatial extent.</p>
</div>
</div>
<section id="vector-base-maps" class="level2" data-number="20.1"><h2 data-number="20.1" class="anchored" data-anchor-id="vector-base-maps">
<span class="header-section-number">20.1</span> Vector base maps</h2>
<section id="rnaturalearth" class="level3" data-number="20.1.1"><h3 data-number="20.1.1" class="anchored" data-anchor-id="rnaturalearth">
<span class="header-section-number">20.1.1</span> <code>rnaturalearth</code>
</h3>
<p>The <code>rnaturalearth</code> package makes <a href="http://www.naturalearthdata.com/">Natural Earth</a> data available. Natural Earth <a href="https://www.naturalearthdata.com/features/">features include</a> coastlines, rivers, bathymetry, political borders, roads and railways at scales 1:10m, 1:50m, and 1:110 million. The <code>rnaturalearth</code> package includes coastline and country data at the small and medium scale. A companion package <code>rnaturalearthhires</code> has the large scale (1:10 million) data. Other datasets from Natural Earth can be downloaded directly from the <a href="https://www.naturalearthdata.com/downloads/">website</a> or with <code><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_download.html">ne_download()</a></code></p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="co"># install.packages("rnaturalearthhires", repos = "https://ropensci.r-universe.dev")</span></span>
<span><span class="va">world</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">110</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span> </span>
<span><span class="va">small_scale_map</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">world</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">50</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">33</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Europe"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">50</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span>, continent <span class="op">=</span> <span class="st">"Europe"</span><span class="op">)</span> </span>
<span><span class="va">medium_scale_map</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">europe</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">30</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">71</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Norden"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">norway</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">10</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span>, country <span class="op">=</span> <span class="st">"Norway"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">large_scale_map</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">norway</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">9</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">59</span>, <span class="fl">62</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Vestland"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine maps with patchwork</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">small_scale_map</span> <span class="op">+</span> <span class="va">medium_scale_map</span> <span class="op">+</span> <span class="va">large_scale_map</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/rnaturalearth-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf()</a></code> is used to show only part of the map.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>sf</code> and <code>sp</code> packages
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>sf</code> and <code>sp</code> are both packages for geospatial data. <code>sf</code> is the newer package that supports the “simple features” standard and is what I strongly recommend.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rivers and lakes
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sometimes the coastline and national borders are sufficient. Sometimes they aren’t very informative and you want to add more features, such as rivers, lakes and cities. This can be done with data from <a href="http://www.naturalearthdata.com/">Natural Earth</a> (or other sources).</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># download if needed</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"maps/ne_10m_rivers_europe.shp"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_download.html">ne_download</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">10</span>, type <span class="op">=</span> <span class="st">"rivers_lake_centerlines"</span>, category <span class="op">=</span> <span class="st">"physical"</span>, </span>
<span>            destdir <span class="op">=</span> <span class="st">"maps/"</span>, load <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># major rivers</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_download.html">ne_download</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">10</span>, type <span class="op">=</span> <span class="st">"lakes"</span>, category <span class="op">=</span> <span class="st">"physical"</span>, </span>
<span>            destdir <span class="op">=</span> <span class="st">"maps/"</span>, load <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># major lakes</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rivers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_load.html">ne_load</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">10</span>, type <span class="op">=</span> <span class="st">"rivers_lake_centerlines"</span>, destdir <span class="op">=</span> <span class="st">"maps"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span><span class="va">lakes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_load.html">ne_load</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">10</span>, type <span class="op">=</span> <span class="st">"lakes"</span>, destdir <span class="op">=</span> <span class="st">"maps"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">europe</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">rivers</span>, colour <span class="op">=</span> <span class="st">"blue"</span>, linewidth <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lakes</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">30</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">71</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-lakes-rivers" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="140_maps_files/figure-html/fig-lakes-rivers-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;20.1: Lakes and rivers</figcaption></figure>
</div>
</div>
</div>
<p>Extra rivers and lakes for Europe and N. America are available from Natural Earth, but for a large-scale map, other data sets may be better, for example from <a href="http://nedlasting.nve.no/gis/">Noregs vassdrags- og energidirektorat</a>.</p>
</div>
</div>
</section><section id="ggoceanmaps" class="level3" data-number="20.1.2"><h3 data-number="20.1.2" class="anchored" data-anchor-id="ggoceanmaps">
<span class="header-section-number">20.1.2</span> <code>ggOceanMaps</code>
</h3>
<p><code>ggOceanMaps</code> is, as the name suggests, focused on ocean map, with coastlines, bathymetry and also glaciers. <code>ggOceanMaps</code> requires <code>ggOceanMapsData</code>, which needs to be installed separately</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"MikkoVihtakari/ggOceanMapsData"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now <code>ggOceanMaps</code> is ready to use.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mikkovihtakari.github.io/ggOceanMaps/">ggOceanMaps</a></span><span class="op">)</span></span>
<span><span class="co">#limits are given longitude min/max, latitude min/max</span></span>
<span><span class="fu"><a href="https://mikkovihtakari.github.io/ggOceanMaps/reference/basemap.html">basemap</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>        bathymetry <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        glaciers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/ggOceanMaps-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make a map of the Nordic Seas using either <code>rnaturalearth</code> or <code>ggOceanMaps</code>.</p>
</div>
</div>
</section><section id="other-vector-files" class="level3" data-number="20.1.3"><h3 data-number="20.1.3" class="anchored" data-anchor-id="other-vector-files">
<span class="header-section-number">20.1.3</span> Other vector files</h3>
<p>The maps in <code>rnaturalearth</code> and <code>ggOceanMaps</code> are good and the global and regional scale, but lack resolution for local scale maps, and may lack features we are interested in.</p>
<p>For such maps we need to find alternative resources. These could be a shapefile, GeoJSON or GeoPackage file, all of which can be imported with <code><a href="https://r-spatial.github.io/sf/reference/st_read.html">sf::st_read()</a></code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Shapefiles
</div>
</div>
<div class="callout-body-container callout-body">
<p>A “shapefile” is not one file but collection of several files in the same directory, only of which has the extension “.shp”.</p>
</div>
</div>
<p>Good sources of data for Norway include:</p>
<ul>
<li><a href="https://www.geonorge.no/">GeoNorge</a></li>
<li><a href="https://kartkatalog.miljodirektoratet.no/">Miljødirektoratet</a></li>
</ul>
<p>This is a map of the fylke of Norway.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.6.2, GDAL 2.2.3, PROJ 4.9.3; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># https://kartkatalog.geonorge.no/metadata/norske-fylker-og-kommuner-illustrasjonsdata-2021-klippet-etter-kyst/f08fca3c-33ee-49b9-be9f-028ebba5e460)</span></span>
<span><span class="co"># This map will be out of date when fylker are reorganised</span></span>
<span><span class="va">fylker</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/fylker2021.json"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `fylker2021' from data source 
  `/home/gbsrt/Documents/teaching/biostats-1/WorkingInR/data/fylker2021.json' 
  using driver `GeoJSON'
Simple feature collection with 11 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -77298.97 ymin: 6448400 xmax: 1115097 ymax: 7939977
Projected CRS: 25833</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">fylker</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/fylker-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Coordinate reference systems
</div>
</div>
<div class="callout-body-container callout-body">
<p>Most geographic data are given with latitude and longitude, but sometimes, especially for local-regional maps, the data are given as <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system">Universal Transverse Mercator (UTM)</a> coordinates instead.</p>
<p>UTM coordinates are a projection of the spherical Earth onto one of 60 flat surfaces.</p>
<p>Most modern latitude-longitude data will use the WGS84 geodetic standard. Older data might use other standards.</p>
<p>You can find the coordinate system of a <code>sf</code> class object with <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">sf::st_crs()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">fylker</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: 25833 
  wkt:
PROJCS["ETRS89 / UTM zone 33N",
    GEOGCS["ETRS89",
        DATUM["European_Terrestrial_Reference_System_1989",
            SPHEROID["GRS 1980",6378137,298.257222101,
                AUTHORITY["EPSG","7019"]],
            TOWGS84[0,0,0,0,0,0,0],
            AUTHORITY["EPSG","6258"]],
        PRIMEM["Greenwich",0,
            AUTHORITY["EPSG","8901"]],
        UNIT["degree",0.0174532925199433,
            AUTHORITY["EPSG","9122"]],
        AUTHORITY["EPSG","4258"]],
    PROJECTION["Transverse_Mercator"],
    PARAMETER["latitude_of_origin",0],
    PARAMETER["central_meridian",15],
    PARAMETER["scale_factor",0.9996],
    PARAMETER["false_easting",500000],
    PARAMETER["false_northing",0],
    UNIT["metre",1,
        AUTHORITY["EPSG","9001"]],
    AXIS["Easting",EAST],
    AXIS["Northing",NORTH],
    AUTHORITY["EPSG","25833"]]</code></pre>
</div>
</div>
<p>This gives a lot of information, the most important is that the coordinate reference systems is UTM zone 33N.</p>
<p>If we need to change a coordinate reference systems, we can do that with <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">sf::st_transform()</a></code>. You need to know the <a href="https://epsg.io/">EPSG</a> code of the target reference system, or the wkt. The code for WGS84 is 4326.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fylker2</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">fylker</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code> will automatically transform coordinate systems (if they are specified).</p>
</div>
</div>
</section></section><section id="tiled-basemaps" class="level2" data-number="20.2"><h2 data-number="20.2" class="anchored" data-anchor-id="tiled-basemaps">
<span class="header-section-number">20.2</span> Tiled basemaps</h2>
<p>Tiled basemaps can be used with either <code>ggspatial</code> or <code>ggmap</code> packages. I recommend using <code>ggspatial</code> as it is consistent with the other mapping tools used here.</p>
<p>If you use a tiled map background, you should attribute the source (e.g., “Copyright OpenStreetMap contributors” when using an OpenStreetMap-based tiles).</p>
<section id="ggspatial" class="level3" data-number="20.2.1"><h3 data-number="20.2.1" class="anchored" data-anchor-id="ggspatial">
<span class="header-section-number">20.2.1</span> <code>ggspatial</code>
</h3>
<p>We can add a tiled-basemap to a plot with <code><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_map_tile.html">annotation_map_tile()</a></code>. Here, we need to use <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf()</a></code> to set the map extent and coordinate reference system as we have not added any <code>sf</code> layers with <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code>. Downloaded tiles will be stored in the maps directory (which you may need to make first).</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_map_tile.html">annotation_map_tile</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"osm"</span>, </span>
<span>    cachedir <span class="op">=</span> <span class="st">"maps/"</span>, </span>
<span>    zoomin <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="co"># sets the zoom level relative to the default</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span></span>
<span>    xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4.5</span>, <span class="fl">6</span><span class="op">)</span>, </span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">60.5</span>, <span class="fl">61</span><span class="op">)</span>,</span>
<span>    crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="co"># EPSG code for WGS84</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/anotation-map-tile-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Several different types of maps are available (see <code><a href="https://rdrr.io/pkg/rosm/man/osm.types.html">rosm::osm.types()</a></code>) and more can be added.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/map-providers-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section><section id="ggmap" class="level3" data-number="20.2.2"><h3 data-number="20.2.2" class="anchored" data-anchor-id="ggmap">
<span class="header-section-number">20.2.2</span> <code>ggmap</code>
</h3>
<p>The <code>ggmap</code> package lets you use Google Maps and other similar maps as a basemap.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
googlemaps
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>ggmap</code> can use maps and satellite image from Google, but you need to <a href="https://mapsplatform.google.com/">register</a> for an API key. You shouldn’t be charged unless you make a lot of maps (more than 20000 per month).</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dkahle/ggmap">ggmap</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">bergen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_map.html">get_map</a></span><span class="op">(</span></span>
<span>  location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5.24</span>, <span class="fl">60.37</span>, <span class="fl">5.36</span>, <span class="fl">60.41</span><span class="op">)</span>, <span class="co">#  left/bottom/right/top</span></span>
<span>  source <span class="op">=</span> <span class="st">"stamen"</span>           </span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">bergen</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/ggmap-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Maps made with a tiled background can appear cluttered with unnecessary information. They are probably best for small areas.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make a tiled map that shows your favourite holiday destination.</p>
</div>
</div>
</section></section><section id="raster-basemaps" class="level2" data-number="20.3"><h2 data-number="20.3" class="anchored" data-anchor-id="raster-basemaps">
<span class="header-section-number">20.3</span> Raster basemaps</h2>
<p>Rasters can be used to show maps of continuous data, for example, elevation or sea surface temperature.</p>
<section id="terra" class="level3" data-number="20.3.1"><h3 data-number="20.3.1" class="anchored" data-anchor-id="terra">
<span class="header-section-number">20.3.1</span> <code>terra</code>
</h3>
<p>The <code>terra</code> package can import raster images in several formats, including GeoTIFF.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>terra</code> vs <code>raster</code> vs <code>stars</code> packages
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>terra</code> package is an update to the widely-used <code>raster</code> package. It should be faster and easier to use.</p>
<p><code>stars</code> is designed for spatio-temporal arrays. There are some things it cannot do that <code>terra</code> can (and vice versa) but has better integration with <code>sf</code> and <code>ggplot2</code>.</p>
</div>
</div>
<p>Rasters imported with <code>terra</code> are easy to plot with the base R <code><a href="https://rdrr.io/pkg/terra/man/plot.html">plot()</a></code> function, but if we want to use <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>, we have to first convert to an <code>sf</code> object.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/">terra</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># import digital elevation model</span></span>
<span><span class="co"># data from https://topotools.cr.usgs.gov/gmted_viewer/viewer.htm</span></span>
<span><span class="va">norway_dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html">rast</a></span><span class="op">(</span><span class="st">"data/50N000E_20101117_gmted_med300.tif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># crop to vestland and convert to sf object</span></span>
<span><span class="va">vestland_extent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html">ext</a></span><span class="op">(</span><span class="fl">4.5</span>, <span class="fl">9</span>, <span class="fl">59</span>, <span class="fl">62</span><span class="op">)</span></span>
<span><span class="va">vestland_dem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html">crop</a></span><span class="op">(</span><span class="va">norway_dem</span>, <span class="va">vestland_extent</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.spatvector.html">as.points</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#rename the data layer</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">vestland_dem</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Elevation"</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">vestland_dem</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">Elevation</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/terra-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If the raster is in UTM coordinates, it is possible to convert to a data.frame and then plot with <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster()</a></code>. Then <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> just treats it as regular plot and does not know that it is a map.</p>
<!-- ```{r} -->
<!-- library(stars) -->
<!-- dem <- read_stars("data/50N000E_20101117_gmted_med300.tif") -->
<!-- #crop dem -->
<!-- bbox <- st_bbox(c(xmin = 4.5, xmax = 9, ymax = 62, ymin = 59), crs = st_crs(4326)) -->
<!-- dem_cropped <- st_crop(x = dem, y = bbox) -->
<!-- ggplot() + -->
<!--   geom_stars(data = dem_cropped) + -->
<!--   # geom_sf(data = st_crop(norway, bbox), fill = NA, colour = "white") + -->
<!--   labs(fill = "Elevation m")  -->
<!-- ``` -->
</section></section><section id="adding-data-to-the-basemap" class="level2" data-number="20.4"><h2 data-number="20.4" class="anchored" data-anchor-id="adding-data-to-the-basemap">
<span class="header-section-number">20.4</span> Adding data to the basemap</h2>
<p>After deciding what type of base map to draw, we can add the data we want to show with the map. This can be</p>
<ul>
<li><p>points, line, and polygons</p></li>
<li><p>Shaded political units (a cloropleth map)</p></li>
<li><p>A grid of values (raster)</p></li>
</ul>
<section id="pointslinespolygons" class="level3" data-number="20.4.1"><h3 data-number="20.4.1" class="anchored" data-anchor-id="pointslinespolygons">
<span class="header-section-number">20.4.1</span> points/lines/polygons</h3>
<p>Points lines and polygons can be added to the base map. If the data are already a <code>sf</code> object they can be plotted with <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># aquaculture sites downloaded from Barentswatch.no/fiskinfo</span></span>
<span><span class="va">aquaculture</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"data/flate-ihht-akvakulturregisteret20220928.geojson"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `flate-ihht-akvakulturregisteret20220928' from data source 
  `/home/gbsrt/Documents/teaching/biostats-1/WorkingInR/data/flate-ihht-akvakulturregisteret20220928.geojson' 
  using driver `GeoJSON'
Simple feature collection with 1330 features and 4 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 4.660283 ymin: 58.01472 xmax: 30.41932 ymax: 71.02117
Geodetic CRS:  4326</code></pre>
</div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># with rnaturalearth</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">europe</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aquaculture</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">30</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">71</span><span class="op">)</span><span class="op">)</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/second-sf-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># with ggOceanMaps</span></span>
<span></span>
<span><span class="fu"><a href="https://mikkovihtakari.github.io/ggOceanMaps/reference/basemap.html">basemap</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">80</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aquaculture</span>, colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/second-sf-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># with ggmap</span></span>
<span><span class="va">vestland</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_map.html">get_map</a></span><span class="op">(</span></span>
<span>  location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>,  <span class="fl">59</span>, <span class="fl">8</span>, <span class="fl">62</span><span class="op">)</span>,</span>
<span>  source <span class="op">=</span> <span class="st">"stamen"</span>           </span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># needs inherit.aes = FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="va">vestland</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">aquaculture</span>, colour <span class="op">=</span> <span class="st">"red"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/second-sf-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Alternatively, you can make/import a tibble with the geographic data and add them to the basemap with the relevant spatially aware geom. So <code><a href="https://paleolimbot.github.io/ggspatial/reference/stat_spatial_identity.html">geom_spatial_point()</a></code> rather than <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> and <code><a href="https://paleolimbot.github.io/ggspatial/reference/stat_spatial_identity.html">geom_spatial_path()</a></code> rather than <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path()</a></code></p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://paleolimbot.github.io/ggspatial/">ggspatial</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># GPS tracking data of osprey. Data from https://datadryad.org/stash/dataset/doi:10.5061%2Fdryad.w6m905qt2</span></span>
<span><span class="va">osprey</span> <span class="op">&lt;-</span> <span class="fu">read_delim</span><span class="op">(</span><span class="st">"maps/osprey/06982.txt"</span>, </span>
<span>                     locale <span class="op">=</span> <span class="fu">locale</span><span class="op">(</span>decimal_mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ggOceanMaps</span></span>
<span></span>
<span><span class="fu"><a href="https://mikkovihtakari.github.io/ggOceanMaps/reference/basemap.html">basemap</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">osprey</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/stat_spatial_identity.html">geom_spatial_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude_e</span>, y <span class="op">=</span> <span class="va">latitude_n</span>, colour <span class="op">=</span> <span class="va">speed</span><span class="op">)</span>,</span>
<span>            data <span class="op">=</span> <span class="va">osprey</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">Speed</span><span class="op">~</span><span class="va">km</span><span class="op">~</span><span class="va">h</span><span class="op">^</span><span class="op">{</span><span class="op">-</span><span class="fl">1</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/geom-spatial-points-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><code><a href="https://paleolimbot.github.io/ggspatial/reference/stat_spatial_identity.html">geom_spatial_point()</a></code> assumes that the data are latitude-longitude coordinates. It they are UTM, you will need to use the <code>crs</code> argument with the correct <a href="https://epsg.io/?q=UTM">EPSG code</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
geom_path() vs geom_line()
</div>
</div>
<div class="callout-body-container callout-body">
<p><code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path()</a></code> draws a line from the first point in the dataset to the second and so on. This is useful for plotting on maps with <code><a href="https://paleolimbot.github.io/ggspatial/reference/stat_spatial_identity.html">geom_spatial_path()</a></code> (and ordinations).</p>
<p><code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code> draws a line from the left-most point to the next left-most point in the dataset. This is useful for plotting timeseries.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Degrees minutes and seconds
</div>
</div>
<div class="callout-body-container callout-body">
<p>For latitude-longitude data, we recommend using decimal degrees (Bergen is at 60.3807°N, 5.3323°E). But archived data can be in all sorts of unhelpful formats, such as degrees minutes and seconds (Bergen is at 60° 22’ 50.52” N 5° 19’ 56.28” E). If you get data like this, you need to convert it to decimal degrees. The <code>parzer</code> package can help (it is like <code>lubridate</code> for latitude-longitude data). For example:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">parzer</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/parzer/reference/parse_lat.html">parse_lat</a></span><span class="op">(</span><span class="st">"60° 22' 50.52''N"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60.3807</code></pre>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Download and import the <a href="https://setac.onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1002%2Fetc.5064&amp;file=etc5064-sup-0002-Supplementary_dataset.xlsx">data</a> for <a href="https://doi.org/10.1002/etc.5064">Andvik et al (2021)</a> on contaminants in orca.</p>
<p>Make a map to show the hexabromobenzene (HBB) concentrations in the blubber.</p>
</div>
</div>
</section><section id="cloropleth-maps" class="level3" data-number="20.4.2"><h3 data-number="20.4.2" class="anchored" data-anchor-id="cloropleth-maps">
<span class="header-section-number">20.4.2</span> Cloropleth maps</h3>
<p>Cloropleth maps are useful for plotting data that have been aggregated to a geographic unit (kommune, fylke, country etc). A <code>sf</code> object is a special type of data frame that we can <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>, <code>mutate()</code> or <code>left_join()</code> to other data frames. We need a tibble with the data that we can join to the <code>sf</code> object with the geographic units. Here, I use data on 2021 phosphorous discharge in municipal wastewater from <a href="https://www.ssb.no/en/statbank/table/05280/">SSB</a> and join it by Fylkesnummer, and plot it by setting <code>fill</code> in the <code>aes</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_discharge</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"data/05280_20230421-012359.xlsx"</span>,</span>
<span>                                  skip <span class="op">=</span> <span class="fl">4</span>, n_max <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">separate_wider_regex</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">x1</span>, <span class="co"># split fist column</span></span>
<span>    patterns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Fylkesnummer <span class="op">=</span> <span class="st">"\\d{2}"</span>, <span class="st">" "</span>, Fylkesnavn <span class="op">=</span> <span class="st">".*"</span><span class="op">)</span><span class="op">)</span><span class="co"># using regular expressions</span></span>
<span><span class="co"># \\d{2} = 2 numbers, " " = space, ".*" = any number of any character, ie everything else</span></span>
<span></span>
<span><span class="co"># join to fylker</span></span>
<span><span class="va">fylker_discharge</span> <span class="op">&lt;-</span> <span class="va">fylker</span> <span class="op">|&gt;</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">p_discharge</span>, by <span class="op">=</span> <span class="st">"Fylkesnummer"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">fylker_discharge</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">total_discharge</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Wastewater\nP discharge\n(tonnes)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cloropleth" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="140_maps_files/figure-html/fig-cloropleth-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;20.2: Total phosphate discharge in municipal wastewater by fylke.</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Cartograms
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sometimes cloropleth maps can be misleading. An alternative is to warp space so that the area of each region is proportional to the value. This is a cartogram, which can be made with the <code>cartogram</code> package.</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sjewo/cartogram">cartogram</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># simplify sf object for speed</span></span>
<span><span class="va">fylker_discharge_sim</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_simplify</a></span><span class="op">(</span><span class="va">fylker_discharge</span>, dTolerance <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make cartogram</span></span>
<span><span class="va">kart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cartogram/man/cartogram_cont.html">cartogram_cont</a></span><span class="op">(</span><span class="va">fylker_discharge_sim</span>, weight <span class="op">=</span> <span class="st">"total_discharge"</span>, itermax <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot cartogram</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">kart</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">total_discharge</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Wastewater\nP discharge\ntonnes"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.99</span>, <span class="fl">.01</span><span class="op">)</span>, </span>
<span>        legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-cartogram" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="140_maps_files/figure-html/fig-cartogram-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;20.3: Cartogram showing total phosphate discharge in municipal wastewater by fylke.</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>With <code>rnaturalearth</code> data, make a world map that shows the population (column pop_est) of each country.</p>
</div>
</div>
</section><section id="raster" class="level3" data-number="20.4.3"><h3 data-number="20.4.3" class="anchored" data-anchor-id="raster">
<span class="header-section-number">20.4.3</span> raster</h3>
<p>Raster data, perhaps the output of a model, can also be added to maps, using code similar to that for plotting a raster basemap.</p>
</section></section><section id="scalebars-north-pointer-etc" class="level2" data-number="20.5"><h2 data-number="20.5" class="anchored" data-anchor-id="scalebars-north-pointer-etc">
<span class="header-section-number">20.5</span> Scalebars, north pointer etc</h2>
<p>Scalebars and north pointers can be added with the <code>ggspatial</code> package or the <code>ggsn</code> package. North points are not very useful if the map has gridlines as these already indicate north. A scalebar can be useful, especially for large scale map. On small scale maps, they can be inaccurate as the scale varies.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># with rnaturalearth</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">norway</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">9</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">59</span>, <span class="fl">62</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://paleolimbot.github.io/ggspatial/reference/annotation_scale.html">annotation_scale</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"br"</span><span class="op">)</span> <span class="co"># br = bottom right</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale on map varies by more than 10%, scale bar may be inaccurate</code></pre>
</div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/annotations-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="hints-for-maps" class="level2 page-columns page-full" data-number="20.6"><h2 data-number="20.6" class="anchored" data-anchor-id="hints-for-maps">
<span class="header-section-number">20.6</span> Hints for maps</h2>
<p>Keep it simple. Remove unnecessary features (do you really need to show the bathymetry?) and use appropriate scale data for the base map (too high resolution takes a long time to plot and can look worse).</p>
<p>Use facets as necessary (different species, different years etc).</p>
<p>If you need multiple colour scales, the <code>ggnewscale</code> package can help. Use inset maps (<a href="130_patchwork.html"><span>Chapter&nbsp;19</span></a>) to show your location in context.</p>
<section id="projections" class="level3" data-number="20.6.1"><h3 data-number="20.6.1" class="anchored" data-anchor-id="projections">
<span class="header-section-number">20.6.1</span> Projections</h3>
<p>The Earth is an oblate sphere and needs projecting to plot in two dimensions. This inevitably leads to distortions, especially for maps with a large extent. <a href="https://proj.org/operations/projections/index.html">Different projections</a> have different properties and may be suitable for different purposes or regions. <code>ggOceanMaps</code> can automatically select a projection based on the location, otherwise the map projection can be set using <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf()</a></code>.</p>
<p>The <a href="https://projectionwizard.org/#">projection wizard</a> can help choose a projection for a given area (copy the PROJ string).</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">world</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"medium"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">default</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mollweide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Equal-area world map projection</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=moll"</span><span class="op">)</span> <span class="co"># projection specified with a 'proj' string</span></span>
<span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co"># might need to turn spherical geometry for some projections</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Spherical geometry (s2) switched off</code></pre>
</div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">polar_lambert</span> <span class="op">&lt;-</span>  <span class="va">world</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># !important - don't crop to tightly or crop lines will show in plot</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html">st_crop</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">180</span>, ymin <span class="op">=</span> <span class="fl">50</span>, xmax <span class="op">=</span> <span class="fl">180</span>, ymax <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Transverse cylindrical equal-area</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span><span class="co">#   coord_sf(crs = "+proj=moll")</span></span>
<span>  <span class="co"># projection specified with a proj string</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">'+proj=laea +lon_0=14.4140625 +lat_0=90 +datum=WGS84 +units=m +no_defs'</span>, </span>
<span>           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100000</span>, <span class="op">-</span><span class="fl">3500000</span><span class="op">)</span>, <span class="co"># xlim/ylim in units of projection</span></span>
<span>           xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2000000</span>, <span class="fl">2000000</span><span class="op">)</span><span class="op">)</span> <span class="co"># here in metres</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>although coordinates are longitude/latitude, st_intersection assumes that they
are planar</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">default</span><span class="op">/</span><span class="va">mollweide</span><span class="op">/</span><span class="va">polar_lambert</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="140_maps_files/figure-html/projections-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Change the projection of one of the small-scale maps you made previously.</p>
</div>
</div>
<!-- ### Interactive maps -->
<!-- ### leaflets -->
<!-- ### coords on projected maps -->
<!-- better geom_path map -->
<!-- new example exercise -->
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Further reading
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://r-spatial.org/book/">Spatial Data Science</a></li>
<li><a href="https://clauswilke.com/dataviz/geospatial-data.html">Visualizing geospatial data</a></li>
</ul>
</div>
</div>
</section>

<!-- -->

<div class="no-row-height column-margin column-container"><section id="contributors" class="level3 unlisted unnumbered"><h3 class="unlisted unnumbered anchored" data-anchor-id="contributors">Contributors</h3>
<ul>
<li>Richard Telford</li>
</ul></section></div></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./130_patchwork.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Combining plots</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./050_missing_values.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Handling missing values</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb34" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># Making maps in R</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tidyverse</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/setup.R"</span>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>Biologists need almost as many maps as geographers, perhaps to show where our field sites are, the range of a species, or the migration path of a bird.</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>Typically, the data we want to show is added to a base map.</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>These can be added to different types of base map</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>vector map showing the coastline, and perhaps political borders, rivers and other features</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A map made of downloaded tiles (similar to how Google maps works)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A raster (made of pixels)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## Terminology</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>Small scale vs large scale?</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>The terminology is confusing!</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>Map scales are given as a ratio.</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>A world map might have a scale of 1:100000000.</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>1 cm on the map represents 100000000 cm on the ground - a ratio of 1/100000000.</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>A small number hence a small-scale map.</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>Conversely, a map of a city might have a scale of 1:25000.</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>1 cm on the map represents 25000 cm on the ground - a ratio of 1/25000.</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>A large number hence a large-scale map.</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>Large-scale maps are usually high resolution and cover a small spatial extent.</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a><span class="fu">## Vector base maps</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a><span class="fu">### `rnaturalearth`</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>The <span class="in">`rnaturalearth`</span> package makes <span class="co">[</span><span class="ot">Natural Earth</span><span class="co">](http://www.naturalearthdata.com/)</span> data available.</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>Natural Earth <span class="co">[</span><span class="ot">features include</span><span class="co">](https://www.naturalearthdata.com/features/)</span> coastlines, rivers, bathymetry, political borders, roads and railways at scales 1:10m, 1:50m, and 1:110 million.</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>The <span class="in">`rnaturalearth`</span> package includes coastline and country data at the small and medium scale.</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>A companion package <span class="in">`rnaturalearthhires`</span> has the large scale (1:10 million) data.</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>Other datasets from Natural Earth can be downloaded directly from the <span class="co">[</span><span class="ot">website</span><span class="co">](https://www.naturalearthdata.com/downloads/)</span> or with <span class="in">`ne_download()`</span></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: rnaturalearth</span></span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("rnaturalearthhires", repos = "https://ropensci.r-universe.dev")</span></span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="dv">110</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>) </span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>small_scale_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world) <span class="sc">+</span></span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">50</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">33</span>, <span class="dv">80</span>)) <span class="sc">+</span></span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Europe"</span>)</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>europe <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="dv">50</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>, <span class="at">continent =</span> <span class="st">"Europe"</span>) </span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>medium_scale_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> europe) <span class="sc">+</span></span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">30</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">71</span>)) <span class="sc">+</span></span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Norden"</span>)</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a>norway <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="dv">10</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>, <span class="at">country =</span> <span class="st">"Norway"</span>) </span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a>large_scale_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> norway) <span class="sc">+</span></span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">9</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">59</span>, <span class="dv">62</span>)) <span class="sc">+</span></span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Vestland"</span>)</span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a><span class="co"># combine maps with patchwork</span></span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a>small_scale_map <span class="sc">+</span> medium_scale_map <span class="sc">+</span> large_scale_map</span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a><span class="in">`coord_sf()`</span> is used to show only part of the map.</span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a><span class="fu">## `sf` and `sp` packages</span></span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a><span class="in">`sf`</span> and <span class="in">`sp`</span> are both packages for geospatial data.</span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a><span class="in">`sf`</span> is the newer package that supports the "simple features" standard and is what I strongly recommend.</span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rivers and lakes</span></span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a>Sometimes the coastline and national borders are sufficient.</span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a>Sometimes they aren't very informative and you want to add more features, such as rivers, lakes  and cities.</span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a>This can be done with data from <span class="co">[</span><span class="ot">Natural Earth</span><span class="co">](http://www.naturalearthdata.com/)</span> (or other sources).</span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-lakes-rivers</span></span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Lakes and rivers</span></span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a><span class="co"># download if needed</span></span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"maps/ne_10m_rivers_europe.shp"</span>)){</span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ne_download</span>(<span class="at">scale =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">"rivers_lake_centerlines"</span>, <span class="at">category =</span> <span class="st">"physical"</span>, </span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a>            <span class="at">destdir =</span> <span class="st">"maps/"</span>, <span class="at">load =</span> <span class="cn">FALSE</span>) <span class="co"># major rivers</span></span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ne_download</span>(<span class="at">scale =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">"lakes"</span>, <span class="at">category =</span> <span class="st">"physical"</span>, </span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a>            <span class="at">destdir =</span> <span class="st">"maps/"</span>, <span class="at">load =</span> <span class="cn">FALSE</span>) <span class="co"># major lakes</span></span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a>rivers <span class="ot">&lt;-</span> <span class="fu">ne_load</span>(<span class="at">scale =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">"rivers_lake_centerlines"</span>, <span class="at">destdir =</span> <span class="st">"maps"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a>lakes <span class="ot">&lt;-</span> <span class="fu">ne_load</span>(<span class="at">scale =</span> <span class="dv">10</span>, <span class="at">type =</span> <span class="st">"lakes"</span>, <span class="at">destdir =</span> <span class="st">"maps"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-124"><a href="#cb34-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> europe) <span class="sc">+</span></span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> rivers, <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> lakes, <span class="at">fill =</span> <span class="st">"lightblue"</span>) <span class="sc">+</span> </span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">30</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">71</span>))</span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a>Extra rivers and lakes for Europe and N. America are available from Natural Earth, but for a large-scale map, other data sets may be better, for example from <span class="co">[</span><span class="ot">Noregs vassdrags- og energidirektorat</span><span class="co">](http://nedlasting.nve.no/gis/)</span>.</span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true" tabindex="-1"></a><span class="fu">### `ggOceanMaps`</span></span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true" tabindex="-1"></a><span class="in">`ggOceanMaps`</span> is, as the name suggests, focused on ocean map, with coastlines, bathymetry and also glaciers.</span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true" tabindex="-1"></a><span class="in">`ggOceanMaps`</span> requires <span class="in">`ggOceanMapsData`</span>, which needs to be installed separately</span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: install-ggOceanMapsData</span></span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"MikkoVihtakari/ggOceanMapsData"</span>)</span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-146"><a href="#cb34-146" aria-hidden="true" tabindex="-1"></a>Now <span class="in">`ggOceanMaps`</span> is ready to use.</span>
<span id="cb34-147"><a href="#cb34-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-150"><a href="#cb34-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-151"><a href="#cb34-151" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ggOceanMaps</span></span>
<span id="cb34-152"><a href="#cb34-152" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-153"><a href="#cb34-153" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggOceanMaps)</span>
<span id="cb34-154"><a href="#cb34-154" aria-hidden="true" tabindex="-1"></a><span class="co">#limits are given longitude min/max, latitude min/max</span></span>
<span id="cb34-155"><a href="#cb34-155" aria-hidden="true" tabindex="-1"></a><span class="fu">basemap</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">80</span>),</span>
<span id="cb34-156"><a href="#cb34-156" aria-hidden="true" tabindex="-1"></a>        <span class="at">bathymetry =</span> <span class="cn">TRUE</span>,</span>
<span id="cb34-157"><a href="#cb34-157" aria-hidden="true" tabindex="-1"></a>        <span class="at">glaciers =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-158"><a href="#cb34-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-159"><a href="#cb34-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-160"><a href="#cb34-160" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb34-161"><a href="#cb34-161" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb34-162"><a href="#cb34-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-163"><a href="#cb34-163" aria-hidden="true" tabindex="-1"></a>Make a map of the Nordic Seas using either <span class="in">`rnaturalearth`</span> or <span class="in">`ggOceanMaps`</span>.</span>
<span id="cb34-164"><a href="#cb34-164" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-165"><a href="#cb34-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-166"><a href="#cb34-166" aria-hidden="true" tabindex="-1"></a><span class="fu">### Other vector files</span></span>
<span id="cb34-167"><a href="#cb34-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-168"><a href="#cb34-168" aria-hidden="true" tabindex="-1"></a>The maps in <span class="in">`rnaturalearth`</span> and <span class="in">`ggOceanMaps`</span> are good and the global and regional scale, but lack resolution for local scale maps, and may lack features we are interested in.</span>
<span id="cb34-169"><a href="#cb34-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-170"><a href="#cb34-170" aria-hidden="true" tabindex="-1"></a>For such maps we need to find alternative resources.</span>
<span id="cb34-171"><a href="#cb34-171" aria-hidden="true" tabindex="-1"></a>These could be a shapefile, GeoJSON or GeoPackage file, all of which can be imported with <span class="in">`sf::st_read()`</span>.</span>
<span id="cb34-172"><a href="#cb34-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-173"><a href="#cb34-173" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb34-174"><a href="#cb34-174" aria-hidden="true" tabindex="-1"></a><span class="fu">## Shapefiles</span></span>
<span id="cb34-175"><a href="#cb34-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-176"><a href="#cb34-176" aria-hidden="true" tabindex="-1"></a>A "shapefile" is not one file but collection of several files in the same directory, only of which has the extension ".shp".</span>
<span id="cb34-177"><a href="#cb34-177" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-178"><a href="#cb34-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-179"><a href="#cb34-179" aria-hidden="true" tabindex="-1"></a>Good sources of data for Norway include:</span>
<span id="cb34-180"><a href="#cb34-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-181"><a href="#cb34-181" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">GeoNorge</span><span class="co">](https://www.geonorge.no/)</span></span>
<span id="cb34-182"><a href="#cb34-182" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Miljødirektoratet</span><span class="co">](https://kartkatalog.miljodirektoratet.no/)</span></span>
<span id="cb34-183"><a href="#cb34-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-184"><a href="#cb34-184" aria-hidden="true" tabindex="-1"></a>This is a map of the fylke of Norway.</span>
<span id="cb34-185"><a href="#cb34-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-188"><a href="#cb34-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-189"><a href="#cb34-189" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fylker</span></span>
<span id="cb34-190"><a href="#cb34-190" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb34-191"><a href="#cb34-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-192"><a href="#cb34-192" aria-hidden="true" tabindex="-1"></a><span class="co"># https://kartkatalog.geonorge.no/metadata/norske-fylker-og-kommuner-illustrasjonsdata-2021-klippet-etter-kyst/f08fca3c-33ee-49b9-be9f-028ebba5e460)</span></span>
<span id="cb34-193"><a href="#cb34-193" aria-hidden="true" tabindex="-1"></a><span class="co"># This map will be out of date when fylker are reorganised</span></span>
<span id="cb34-194"><a href="#cb34-194" aria-hidden="true" tabindex="-1"></a>fylker <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/fylker2021.json"</span>)</span>
<span id="cb34-195"><a href="#cb34-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-196"><a href="#cb34-196" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fylker) <span class="sc">+</span> </span>
<span id="cb34-197"><a href="#cb34-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span>
<span id="cb34-198"><a href="#cb34-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-199"><a href="#cb34-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-200"><a href="#cb34-200" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb34-201"><a href="#cb34-201" aria-hidden="true" tabindex="-1"></a><span class="fu">## Coordinate reference systems</span></span>
<span id="cb34-202"><a href="#cb34-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-203"><a href="#cb34-203" aria-hidden="true" tabindex="-1"></a>Most geographic data are given with latitude and longitude, but sometimes, especially for local-regional maps, the data are given as <span class="co">[</span><span class="ot">Universal Transverse Mercator (UTM)</span><span class="co">](https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system)</span> coordinates instead.</span>
<span id="cb34-204"><a href="#cb34-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-205"><a href="#cb34-205" aria-hidden="true" tabindex="-1"></a>UTM coordinates are a projection of the spherical Earth onto one of 60 flat surfaces.</span>
<span id="cb34-206"><a href="#cb34-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-207"><a href="#cb34-207" aria-hidden="true" tabindex="-1"></a>Most modern latitude-longitude data will use the WGS84 geodetic standard.</span>
<span id="cb34-208"><a href="#cb34-208" aria-hidden="true" tabindex="-1"></a>Older data might use other standards.</span>
<span id="cb34-209"><a href="#cb34-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-210"><a href="#cb34-210" aria-hidden="true" tabindex="-1"></a>You can find the coordinate system of a <span class="in">`sf`</span> class object with <span class="in">`sf::st_crs()`</span>.</span>
<span id="cb34-211"><a href="#cb34-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-214"><a href="#cb34-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-215"><a href="#cb34-215" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_crs</span>(fylker)</span>
<span id="cb34-216"><a href="#cb34-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-217"><a href="#cb34-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-218"><a href="#cb34-218" aria-hidden="true" tabindex="-1"></a>This gives a lot of information, the most important is that the coordinate reference systems is UTM zone 33N.</span>
<span id="cb34-219"><a href="#cb34-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-220"><a href="#cb34-220" aria-hidden="true" tabindex="-1"></a>If we need to change a coordinate reference systems, we can do that with <span class="in">`sf::st_transform()`</span>.</span>
<span id="cb34-221"><a href="#cb34-221" aria-hidden="true" tabindex="-1"></a>You need to know the <span class="co">[</span><span class="ot">EPSG</span><span class="co">](https://epsg.io/)</span> code of the target reference system, or the wkt.</span>
<span id="cb34-222"><a href="#cb34-222" aria-hidden="true" tabindex="-1"></a>The code for WGS84 is 4326.</span>
<span id="cb34-223"><a href="#cb34-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-226"><a href="#cb34-226" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-227"><a href="#cb34-227" aria-hidden="true" tabindex="-1"></a>fylker2 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(fylker, <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb34-228"><a href="#cb34-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-229"><a href="#cb34-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-230"><a href="#cb34-230" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_sf()`</span> will automatically transform coordinate systems (if they are specified).</span>
<span id="cb34-231"><a href="#cb34-231" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-232"><a href="#cb34-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-233"><a href="#cb34-233" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tiled basemaps</span></span>
<span id="cb34-234"><a href="#cb34-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-235"><a href="#cb34-235" aria-hidden="true" tabindex="-1"></a>Tiled basemaps can be used with either <span class="in">`ggspatial`</span> or <span class="in">`ggmap`</span> packages.</span>
<span id="cb34-236"><a href="#cb34-236" aria-hidden="true" tabindex="-1"></a>I recommend using <span class="in">`ggspatial`</span> as it is consistent with the other mapping tools used here.</span>
<span id="cb34-237"><a href="#cb34-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-238"><a href="#cb34-238" aria-hidden="true" tabindex="-1"></a>If you use a tiled map background, you should attribute the source (e.g., "Copyright OpenStreetMap contributors" when using an OpenStreetMap-based tiles).</span>
<span id="cb34-239"><a href="#cb34-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-240"><a href="#cb34-240" aria-hidden="true" tabindex="-1"></a><span class="fu">### `ggspatial`</span></span>
<span id="cb34-241"><a href="#cb34-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-242"><a href="#cb34-242" aria-hidden="true" tabindex="-1"></a>We can add a tiled-basemap to a plot with <span class="in">`annotation_map_tile()`</span>.</span>
<span id="cb34-243"><a href="#cb34-243" aria-hidden="true" tabindex="-1"></a>Here, we need to use <span class="in">`coord_sf()`</span> to set the map extent and coordinate reference system as we have not added any <span class="in">`sf`</span> layers with <span class="in">`geom_sf()`</span>.</span>
<span id="cb34-244"><a href="#cb34-244" aria-hidden="true" tabindex="-1"></a>Downloaded tiles will be stored in the maps directory (which you may need to make first).</span>
<span id="cb34-245"><a href="#cb34-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-248"><a href="#cb34-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-249"><a href="#cb34-249" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: anotation-map-tile</span></span>
<span id="cb34-250"><a href="#cb34-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb34-251"><a href="#cb34-251" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-252"><a href="#cb34-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-253"><a href="#cb34-253" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-254"><a href="#cb34-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_map_tile</span>(</span>
<span id="cb34-255"><a href="#cb34-255" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"osm"</span>, </span>
<span id="cb34-256"><a href="#cb34-256" aria-hidden="true" tabindex="-1"></a>    <span class="at">cachedir =</span> <span class="st">"maps/"</span>, </span>
<span id="cb34-257"><a href="#cb34-257" aria-hidden="true" tabindex="-1"></a>    <span class="at">zoomin =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span> <span class="co"># sets the zoom level relative to the default</span></span>
<span id="cb34-258"><a href="#cb34-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb34-259"><a href="#cb34-259" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="dv">6</span>), </span>
<span id="cb34-260"><a href="#cb34-260" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">60.5</span>, <span class="dv">61</span>),</span>
<span id="cb34-261"><a href="#cb34-261" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">4326</span>) <span class="co"># EPSG code for WGS84</span></span>
<span id="cb34-262"><a href="#cb34-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-263"><a href="#cb34-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-264"><a href="#cb34-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-265"><a href="#cb34-265" aria-hidden="true" tabindex="-1"></a>Several different types of maps are available (see <span class="in">`rosm::osm.types()`</span>) and more can be added.</span>
<span id="cb34-266"><a href="#cb34-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-269"><a href="#cb34-269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-270"><a href="#cb34-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: map-providers</span></span>
<span id="cb34-271"><a href="#cb34-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb34-272"><a href="#cb34-272" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb34-273"><a href="#cb34-273" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-274"><a href="#cb34-274" aria-hidden="true" tabindex="-1"></a><span class="co"># rosm::osm.types()</span></span>
<span id="cb34-275"><a href="#cb34-275" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"osm"</span>, <span class="st">"stamenwatercolor"</span>, <span class="st">"cartodark"</span>, <span class="st">"cartolight"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-276"><a href="#cb34-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span>{</span>
<span id="cb34-277"><a href="#cb34-277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-278"><a href="#cb34-278" aria-hidden="true" tabindex="-1"></a>      <span class="fu">annotation_map_tile</span>(</span>
<span id="cb34-279"><a href="#cb34-279" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> .x, </span>
<span id="cb34-280"><a href="#cb34-280" aria-hidden="true" tabindex="-1"></a>        <span class="at">cachedir =</span> <span class="st">"maps/"</span>, </span>
<span id="cb34-281"><a href="#cb34-281" aria-hidden="true" tabindex="-1"></a>        <span class="at">zoomin =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-282"><a href="#cb34-282" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_sf</span>(</span>
<span id="cb34-283"><a href="#cb34-283" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">5.24</span>, <span class="fl">5.36</span>), </span>
<span id="cb34-284"><a href="#cb34-284" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">60.37</span>, <span class="fl">60.41</span>),</span>
<span id="cb34-285"><a href="#cb34-285" aria-hidden="true" tabindex="-1"></a>        <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">+</span></span>
<span id="cb34-286"><a href="#cb34-286" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(.x) <span class="sc">+</span></span>
<span id="cb34-287"><a href="#cb34-287" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb34-288"><a href="#cb34-288" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb34-289"><a href="#cb34-289" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>), </span>
<span id="cb34-290"><a href="#cb34-290" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb34-291"><a href="#cb34-291" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> </span>
<span id="cb34-292"><a href="#cb34-292" aria-hidden="true" tabindex="-1"></a>  patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>()</span>
<span id="cb34-293"><a href="#cb34-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-294"><a href="#cb34-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-295"><a href="#cb34-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-296"><a href="#cb34-296" aria-hidden="true" tabindex="-1"></a><span class="fu">### `ggmap`</span></span>
<span id="cb34-297"><a href="#cb34-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-298"><a href="#cb34-298" aria-hidden="true" tabindex="-1"></a>The <span class="in">`ggmap`</span> package lets you use Google Maps and other similar maps as a basemap.</span>
<span id="cb34-299"><a href="#cb34-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-300"><a href="#cb34-300" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb34-301"><a href="#cb34-301" aria-hidden="true" tabindex="-1"></a><span class="fu">## googlemaps</span></span>
<span id="cb34-302"><a href="#cb34-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-303"><a href="#cb34-303" aria-hidden="true" tabindex="-1"></a><span class="in">`ggmap`</span> can use maps and satellite image from Google, but you need to <span class="co">[</span><span class="ot">register</span><span class="co">](https://mapsplatform.google.com/)</span> for an API key.</span>
<span id="cb34-304"><a href="#cb34-304" aria-hidden="true" tabindex="-1"></a>You shouldn't be charged unless you make a lot of maps (more than 20000 per month).</span>
<span id="cb34-305"><a href="#cb34-305" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-306"><a href="#cb34-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-309"><a href="#cb34-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-310"><a href="#cb34-310" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ggmap</span></span>
<span id="cb34-311"><a href="#cb34-311" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-312"><a href="#cb34-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-313"><a href="#cb34-313" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb34-314"><a href="#cb34-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-315"><a href="#cb34-315" aria-hidden="true" tabindex="-1"></a>bergen <span class="ot">&lt;-</span> <span class="fu">get_map</span>(</span>
<span id="cb34-316"><a href="#cb34-316" aria-hidden="true" tabindex="-1"></a>  <span class="at">location =</span> <span class="fu">c</span>(<span class="fl">5.24</span>, <span class="fl">60.37</span>, <span class="fl">5.36</span>, <span class="fl">60.41</span>), <span class="co">#  left/bottom/right/top</span></span>
<span id="cb34-317"><a href="#cb34-317" aria-hidden="true" tabindex="-1"></a>  <span class="at">source =</span> <span class="st">"stamen"</span>           </span>
<span id="cb34-318"><a href="#cb34-318" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-319"><a href="#cb34-319" aria-hidden="true" tabindex="-1"></a><span class="fu">ggmap</span>(bergen)</span>
<span id="cb34-320"><a href="#cb34-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-321"><a href="#cb34-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-322"><a href="#cb34-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-323"><a href="#cb34-323" aria-hidden="true" tabindex="-1"></a>Maps made with a tiled background can appear cluttered with unnecessary information. </span>
<span id="cb34-324"><a href="#cb34-324" aria-hidden="true" tabindex="-1"></a>They are probably best for small areas.</span>
<span id="cb34-325"><a href="#cb34-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-326"><a href="#cb34-326" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb34-327"><a href="#cb34-327" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb34-328"><a href="#cb34-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-329"><a href="#cb34-329" aria-hidden="true" tabindex="-1"></a>Make a tiled map that shows your favourite holiday destination.</span>
<span id="cb34-330"><a href="#cb34-330" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-331"><a href="#cb34-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-332"><a href="#cb34-332" aria-hidden="true" tabindex="-1"></a><span class="fu">## Raster basemaps</span></span>
<span id="cb34-333"><a href="#cb34-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-334"><a href="#cb34-334" aria-hidden="true" tabindex="-1"></a>Rasters can be used to show maps of continuous data, for example, elevation or sea surface temperature.</span>
<span id="cb34-335"><a href="#cb34-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-336"><a href="#cb34-336" aria-hidden="true" tabindex="-1"></a><span class="fu">### `terra`</span></span>
<span id="cb34-337"><a href="#cb34-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-338"><a href="#cb34-338" aria-hidden="true" tabindex="-1"></a>The <span class="in">`terra`</span> package can import raster images in several formats, including GeoTIFF.</span>
<span id="cb34-339"><a href="#cb34-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-340"><a href="#cb34-340" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb34-341"><a href="#cb34-341" aria-hidden="true" tabindex="-1"></a><span class="fu">## `terra` vs `raster` vs `stars` packages</span></span>
<span id="cb34-342"><a href="#cb34-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-343"><a href="#cb34-343" aria-hidden="true" tabindex="-1"></a>The <span class="in">`terra`</span> package is an update to the widely-used <span class="in">`raster`</span> package.</span>
<span id="cb34-344"><a href="#cb34-344" aria-hidden="true" tabindex="-1"></a>It should be faster and easier to use.</span>
<span id="cb34-345"><a href="#cb34-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-346"><a href="#cb34-346" aria-hidden="true" tabindex="-1"></a><span class="in">`stars`</span> is designed for spatio-temporal arrays.</span>
<span id="cb34-347"><a href="#cb34-347" aria-hidden="true" tabindex="-1"></a>There are some things it cannot do that <span class="in">`terra`</span> can (and vice versa) but has better integration with <span class="in">`sf`</span> and <span class="in">`ggplot2`</span>.</span>
<span id="cb34-348"><a href="#cb34-348" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-349"><a href="#cb34-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-350"><a href="#cb34-350" aria-hidden="true" tabindex="-1"></a>Rasters imported with <span class="in">`terra`</span> are easy to plot with the base R <span class="in">`plot()`</span> function, but if we want to use <span class="in">`ggplot()`</span>, we have to first convert to an <span class="in">`sf`</span> object.</span>
<span id="cb34-351"><a href="#cb34-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-354"><a href="#cb34-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-355"><a href="#cb34-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: terra</span></span>
<span id="cb34-356"><a href="#cb34-356" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-357"><a href="#cb34-357" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb34-358"><a href="#cb34-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-359"><a href="#cb34-359" aria-hidden="true" tabindex="-1"></a><span class="co"># import digital elevation model</span></span>
<span id="cb34-360"><a href="#cb34-360" aria-hidden="true" tabindex="-1"></a><span class="co"># data from https://topotools.cr.usgs.gov/gmted_viewer/viewer.htm</span></span>
<span id="cb34-361"><a href="#cb34-361" aria-hidden="true" tabindex="-1"></a>norway_dem <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data/50N000E_20101117_gmted_med300.tif"</span>)</span>
<span id="cb34-362"><a href="#cb34-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-363"><a href="#cb34-363" aria-hidden="true" tabindex="-1"></a><span class="co"># crop to vestland and convert to sf object</span></span>
<span id="cb34-364"><a href="#cb34-364" aria-hidden="true" tabindex="-1"></a>vestland_extent <span class="ot">&lt;-</span> <span class="fu">ext</span>(<span class="fl">4.5</span>, <span class="dv">9</span>, <span class="dv">59</span>, <span class="dv">62</span>)</span>
<span id="cb34-365"><a href="#cb34-365" aria-hidden="true" tabindex="-1"></a>vestland_dem <span class="ot">&lt;-</span> <span class="fu">crop</span>(norway_dem, vestland_extent) <span class="sc">|&gt;</span> </span>
<span id="cb34-366"><a href="#cb34-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.points</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-367"><a href="#cb34-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() </span>
<span id="cb34-368"><a href="#cb34-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-369"><a href="#cb34-369" aria-hidden="true" tabindex="-1"></a><span class="co">#rename the data layer</span></span>
<span id="cb34-370"><a href="#cb34-370" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vestland_dem)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"Elevation"</span></span>
<span id="cb34-371"><a href="#cb34-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-372"><a href="#cb34-372" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb34-373"><a href="#cb34-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-374"><a href="#cb34-374" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(vestland_dem) <span class="sc">+</span></span>
<span id="cb34-375"><a href="#cb34-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">colour =</span> Elevation))</span>
<span id="cb34-376"><a href="#cb34-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-377"><a href="#cb34-377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-378"><a href="#cb34-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-379"><a href="#cb34-379" aria-hidden="true" tabindex="-1"></a>If the raster is in UTM coordinates, it is possible to convert to a data.frame and then plot with <span class="in">`geom_raster()`</span>.</span>
<span id="cb34-380"><a href="#cb34-380" aria-hidden="true" tabindex="-1"></a>Then <span class="in">`ggplot()`</span> just treats it as regular plot and does not know that it is a map.</span>
<span id="cb34-381"><a href="#cb34-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-382"><a href="#cb34-382" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ```{r} --&gt;</span></span>
<span id="cb34-383"><a href="#cb34-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-384"><a href="#cb34-384" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- library(stars) --&gt;</span></span>
<span id="cb34-385"><a href="#cb34-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-386"><a href="#cb34-386" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- dem &lt;- read_stars("data/50N000E_20101117_gmted_med300.tif") --&gt;</span></span>
<span id="cb34-387"><a href="#cb34-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-388"><a href="#cb34-388" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- #crop dem --&gt;</span></span>
<span id="cb34-389"><a href="#cb34-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-390"><a href="#cb34-390" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- bbox &lt;- st_bbox(c(xmin = 4.5, xmax = 9, ymax = 62, ymin = 59), crs = st_crs(4326)) --&gt;</span></span>
<span id="cb34-391"><a href="#cb34-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-392"><a href="#cb34-392" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- dem_cropped &lt;- st_crop(x = dem, y = bbox) --&gt;</span></span>
<span id="cb34-393"><a href="#cb34-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-394"><a href="#cb34-394" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ggplot() + --&gt;</span></span>
<span id="cb34-395"><a href="#cb34-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-396"><a href="#cb34-396" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   geom_stars(data = dem_cropped) + --&gt;</span></span>
<span id="cb34-397"><a href="#cb34-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-398"><a href="#cb34-398" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   # geom_sf(data = st_crop(norway, bbox), fill = NA, colour = "white") + --&gt;</span></span>
<span id="cb34-399"><a href="#cb34-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-400"><a href="#cb34-400" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   labs(fill = "Elevation m")  --&gt;</span></span>
<span id="cb34-401"><a href="#cb34-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-402"><a href="#cb34-402" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb34-403"><a href="#cb34-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-404"><a href="#cb34-404" aria-hidden="true" tabindex="-1"></a><span class="fu">## Adding data to the basemap</span></span>
<span id="cb34-405"><a href="#cb34-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-406"><a href="#cb34-406" aria-hidden="true" tabindex="-1"></a>After deciding what type of base map to draw, we can add the data we want to show with the map.</span>
<span id="cb34-407"><a href="#cb34-407" aria-hidden="true" tabindex="-1"></a>This can be</span>
<span id="cb34-408"><a href="#cb34-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-409"><a href="#cb34-409" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>points, line, and polygons</span>
<span id="cb34-410"><a href="#cb34-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-411"><a href="#cb34-411" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Shaded political units (a cloropleth map)</span>
<span id="cb34-412"><a href="#cb34-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-413"><a href="#cb34-413" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A grid of values (raster)</span>
<span id="cb34-414"><a href="#cb34-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-415"><a href="#cb34-415" aria-hidden="true" tabindex="-1"></a><span class="fu">### points/lines/polygons</span></span>
<span id="cb34-416"><a href="#cb34-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-417"><a href="#cb34-417" aria-hidden="true" tabindex="-1"></a>Points lines and polygons can be added to the base map.</span>
<span id="cb34-418"><a href="#cb34-418" aria-hidden="true" tabindex="-1"></a>If the data are already a <span class="in">`sf`</span> object they can be plotted with <span class="in">`geom_sf()`</span>.</span>
<span id="cb34-419"><a href="#cb34-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-422"><a href="#cb34-422" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-423"><a href="#cb34-423" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: second-sf</span></span>
<span id="cb34-424"><a href="#cb34-424" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-425"><a href="#cb34-425" aria-hidden="true" tabindex="-1"></a><span class="co"># aquaculture sites downloaded from Barentswatch.no/fiskinfo</span></span>
<span id="cb34-426"><a href="#cb34-426" aria-hidden="true" tabindex="-1"></a>aquaculture <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/flate-ihht-akvakulturregisteret20220928.geojson"</span>)</span>
<span id="cb34-427"><a href="#cb34-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-428"><a href="#cb34-428" aria-hidden="true" tabindex="-1"></a><span class="co"># with rnaturalearth</span></span>
<span id="cb34-429"><a href="#cb34-429" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-430"><a href="#cb34-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> europe) <span class="sc">+</span></span>
<span id="cb34-431"><a href="#cb34-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> aquaculture, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb34-432"><a href="#cb34-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">30</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">71</span>))  </span>
<span id="cb34-433"><a href="#cb34-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-434"><a href="#cb34-434" aria-hidden="true" tabindex="-1"></a><span class="co"># with ggOceanMaps</span></span>
<span id="cb34-435"><a href="#cb34-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-436"><a href="#cb34-436" aria-hidden="true" tabindex="-1"></a><span class="fu">basemap</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">30</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">80</span>)) <span class="sc">+</span></span>
<span id="cb34-437"><a href="#cb34-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> aquaculture, <span class="at">colour =</span> <span class="st">"red"</span>)</span>
<span id="cb34-438"><a href="#cb34-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-439"><a href="#cb34-439" aria-hidden="true" tabindex="-1"></a><span class="co"># with ggmap</span></span>
<span id="cb34-440"><a href="#cb34-440" aria-hidden="true" tabindex="-1"></a>vestland <span class="ot">&lt;-</span> <span class="fu">get_map</span>(</span>
<span id="cb34-441"><a href="#cb34-441" aria-hidden="true" tabindex="-1"></a>  <span class="at">location =</span> <span class="fu">c</span>(<span class="dv">4</span>,  <span class="dv">59</span>, <span class="dv">8</span>, <span class="dv">62</span>),</span>
<span id="cb34-442"><a href="#cb34-442" aria-hidden="true" tabindex="-1"></a>  <span class="at">source =</span> <span class="st">"stamen"</span>           </span>
<span id="cb34-443"><a href="#cb34-443" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-444"><a href="#cb34-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-445"><a href="#cb34-445" aria-hidden="true" tabindex="-1"></a><span class="co"># needs inherit.aes = FALSE</span></span>
<span id="cb34-446"><a href="#cb34-446" aria-hidden="true" tabindex="-1"></a><span class="fu">ggmap</span>(vestland) <span class="sc">+</span> </span>
<span id="cb34-447"><a href="#cb34-447" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_sf</span>(<span class="at">data =</span> aquaculture, <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-448"><a href="#cb34-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-449"><a href="#cb34-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-450"><a href="#cb34-450" aria-hidden="true" tabindex="-1"></a>Alternatively, you can make/import a tibble with the geographic data and add them to the basemap with the relevant spatially aware geom.</span>
<span id="cb34-451"><a href="#cb34-451" aria-hidden="true" tabindex="-1"></a>So <span class="in">`geom_spatial_point()`</span> rather than <span class="in">`geom_point()`</span> and <span class="in">`geom_spatial_path()`</span> rather than <span class="in">`geom_path()`</span></span>
<span id="cb34-452"><a href="#cb34-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-455"><a href="#cb34-455" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-456"><a href="#cb34-456" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: geom-spatial-points</span></span>
<span id="cb34-457"><a href="#cb34-457" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-458"><a href="#cb34-458" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb34-459"><a href="#cb34-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-460"><a href="#cb34-460" aria-hidden="true" tabindex="-1"></a><span class="co"># GPS tracking data of osprey. Data from https://datadryad.org/stash/dataset/doi:10.5061%2Fdryad.w6m905qt2</span></span>
<span id="cb34-461"><a href="#cb34-461" aria-hidden="true" tabindex="-1"></a>osprey <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"maps/osprey/06982.txt"</span>, </span>
<span id="cb34-462"><a href="#cb34-462" aria-hidden="true" tabindex="-1"></a>                     <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">decimal_mark =</span> <span class="st">","</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb34-463"><a href="#cb34-463" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb34-464"><a href="#cb34-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-465"><a href="#cb34-465" aria-hidden="true" tabindex="-1"></a><span class="co"># ggOceanMaps</span></span>
<span id="cb34-466"><a href="#cb34-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-467"><a href="#cb34-467" aria-hidden="true" tabindex="-1"></a><span class="fu">basemap</span>(<span class="at">data =</span> osprey) <span class="sc">+</span></span>
<span id="cb34-468"><a href="#cb34-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatial_path</span>(<span class="fu">aes</span>(<span class="at">x =</span> longitude_e, <span class="at">y =</span> latitude_n, <span class="at">colour =</span> speed),</span>
<span id="cb34-469"><a href="#cb34-469" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> osprey, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-470"><a href="#cb34-470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="fu">expression</span>(Speed<span class="sc">~</span>km<span class="sc">~</span>h<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}))</span>
<span id="cb34-471"><a href="#cb34-471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-472"><a href="#cb34-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-473"><a href="#cb34-473" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_spatial_point()`</span> assumes that the data are latitude-longitude coordinates.</span>
<span id="cb34-474"><a href="#cb34-474" aria-hidden="true" tabindex="-1"></a>It they are UTM, you will need to use the <span class="in">`crs`</span> argument with the correct <span class="co">[</span><span class="ot">EPSG code</span><span class="co">](https://epsg.io/?q=UTM)</span>.</span>
<span id="cb34-475"><a href="#cb34-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-476"><a href="#cb34-476" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb34-477"><a href="#cb34-477" aria-hidden="true" tabindex="-1"></a><span class="fu">## geom_path() vs geom_line()</span></span>
<span id="cb34-478"><a href="#cb34-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-479"><a href="#cb34-479" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_path()`</span> draws a line from the first point in the dataset to the second and so on.</span>
<span id="cb34-480"><a href="#cb34-480" aria-hidden="true" tabindex="-1"></a>This is useful for plotting on maps with <span class="in">`geom_spatial_path()`</span> (and ordinations).</span>
<span id="cb34-481"><a href="#cb34-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-482"><a href="#cb34-482" aria-hidden="true" tabindex="-1"></a><span class="in">`geom_line()`</span> draws a line from the left-most point to the next left-most point in the dataset.</span>
<span id="cb34-483"><a href="#cb34-483" aria-hidden="true" tabindex="-1"></a>This is useful for plotting timeseries.</span>
<span id="cb34-484"><a href="#cb34-484" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-485"><a href="#cb34-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-486"><a href="#cb34-486" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb34-487"><a href="#cb34-487" aria-hidden="true" tabindex="-1"></a><span class="fu">## Degrees minutes and seconds</span></span>
<span id="cb34-488"><a href="#cb34-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-489"><a href="#cb34-489" aria-hidden="true" tabindex="-1"></a>For latitude-longitude data, we recommend using decimal degrees (Bergen is at 60.3807°N, 5.3323°E).</span>
<span id="cb34-490"><a href="#cb34-490" aria-hidden="true" tabindex="-1"></a>But archived data can be in all sorts of unhelpful formats, such as degrees minutes and seconds (Bergen is at 60° 22' 50.52" N 5° 19' 56.28" E).</span>
<span id="cb34-491"><a href="#cb34-491" aria-hidden="true" tabindex="-1"></a>If you get data like this, you need to convert it to decimal degrees.</span>
<span id="cb34-492"><a href="#cb34-492" aria-hidden="true" tabindex="-1"></a>The <span class="in">`parzer`</span> package can help (it is like <span class="in">`lubridate`</span> for latitude-longitude data).</span>
<span id="cb34-493"><a href="#cb34-493" aria-hidden="true" tabindex="-1"></a>For example:</span>
<span id="cb34-494"><a href="#cb34-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-497"><a href="#cb34-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-498"><a href="#cb34-498" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: parzer</span></span>
<span id="cb34-499"><a href="#cb34-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-500"><a href="#cb34-500" aria-hidden="true" tabindex="-1"></a>parzer<span class="sc">::</span><span class="fu">parse_lat</span>(<span class="st">"60° 22' 50.52''N"</span>)</span>
<span id="cb34-501"><a href="#cb34-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-502"><a href="#cb34-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-503"><a href="#cb34-503" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-504"><a href="#cb34-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-505"><a href="#cb34-505" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb34-506"><a href="#cb34-506" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb34-507"><a href="#cb34-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-508"><a href="#cb34-508" aria-hidden="true" tabindex="-1"></a>Download and import the <span class="co">[</span><span class="ot">data</span><span class="co">](https://setac.onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1002%2Fetc.5064&amp;file=etc5064-sup-0002-Supplementary_dataset.xlsx)</span> for <span class="co">[</span><span class="ot">Andvik et al (2021)</span><span class="co">](https://doi.org/10.1002/etc.5064)</span> on contaminants in orca.</span>
<span id="cb34-509"><a href="#cb34-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-510"><a href="#cb34-510" aria-hidden="true" tabindex="-1"></a>Make a map to show the hexabromobenzene (HBB) concentrations in the blubber.</span>
<span id="cb34-511"><a href="#cb34-511" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-512"><a href="#cb34-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-513"><a href="#cb34-513" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cloropleth maps</span></span>
<span id="cb34-514"><a href="#cb34-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-515"><a href="#cb34-515" aria-hidden="true" tabindex="-1"></a>Cloropleth maps are useful for plotting data that have been aggregated to a geographic unit (kommune, fylke, country etc).</span>
<span id="cb34-516"><a href="#cb34-516" aria-hidden="true" tabindex="-1"></a>A <span class="in">`sf`</span> object is a special type of data frame that we can <span class="in">`filter()`</span>, <span class="in">`mutate()`</span> or <span class="in">`left_join()`</span> to other data frames.</span>
<span id="cb34-517"><a href="#cb34-517" aria-hidden="true" tabindex="-1"></a>We need a tibble with the data that we can join to the <span class="in">`sf`</span> object with the geographic units.</span>
<span id="cb34-518"><a href="#cb34-518" aria-hidden="true" tabindex="-1"></a>Here, I use data on 2021 phosphorous discharge in municipal wastewater from <span class="co">[</span><span class="ot">SSB</span><span class="co">](https://www.ssb.no/en/statbank/table/05280/)</span> and join it by Fylkesnummer, and plot it by setting <span class="in">`fill`</span> in the <span class="in">`aes`</span>.</span>
<span id="cb34-519"><a href="#cb34-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-522"><a href="#cb34-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-523"><a href="#cb34-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cloropleth</span></span>
<span id="cb34-524"><a href="#cb34-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-525"><a href="#cb34-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Total phosphate discharge in municipal wastewater by fylke.</span></span>
<span id="cb34-526"><a href="#cb34-526" aria-hidden="true" tabindex="-1"></a>p_discharge <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="at">path =</span> <span class="st">"data/05280_20230421-012359.xlsx"</span>,</span>
<span id="cb34-527"><a href="#cb34-527" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">skip =</span> <span class="dv">4</span>, <span class="at">n_max =</span> <span class="dv">11</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-528"><a href="#cb34-528" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb34-529"><a href="#cb34-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_regex</span>(</span>
<span id="cb34-530"><a href="#cb34-530" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> x1, <span class="co"># split fist column</span></span>
<span id="cb34-531"><a href="#cb34-531" aria-hidden="true" tabindex="-1"></a>    <span class="at">patterns =</span> <span class="fu">c</span>(<span class="at">Fylkesnummer =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">d{2}"</span>, <span class="st">" "</span>, <span class="at">Fylkesnavn =</span> <span class="st">".*"</span>))<span class="co"># using regular expressions</span></span>
<span id="cb34-532"><a href="#cb34-532" aria-hidden="true" tabindex="-1"></a><span class="co"># \\d{2} = 2 numbers, " " = space, ".*" = any number of any character, ie everything else</span></span>
<span id="cb34-533"><a href="#cb34-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-534"><a href="#cb34-534" aria-hidden="true" tabindex="-1"></a><span class="co"># join to fylker</span></span>
<span id="cb34-535"><a href="#cb34-535" aria-hidden="true" tabindex="-1"></a>fylker_discharge <span class="ot">&lt;-</span> fylker <span class="sc">|&gt;</span> <span class="fu">left_join</span>(p_discharge, <span class="at">by =</span> <span class="st">"Fylkesnummer"</span>)</span>
<span id="cb34-536"><a href="#cb34-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-537"><a href="#cb34-537" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fylker_discharge) <span class="sc">+</span></span>
<span id="cb34-538"><a href="#cb34-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> total_discharge)) <span class="sc">+</span></span>
<span id="cb34-539"><a href="#cb34-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Wastewater</span><span class="sc">\n</span><span class="st">P discharge</span><span class="sc">\n</span><span class="st">(tonnes)"</span>)</span>
<span id="cb34-540"><a href="#cb34-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-541"><a href="#cb34-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-542"><a href="#cb34-542" aria-hidden="true" tabindex="-1"></a>::: callout-tip</span>
<span id="cb34-543"><a href="#cb34-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-544"><a href="#cb34-544" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cartograms</span></span>
<span id="cb34-545"><a href="#cb34-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-546"><a href="#cb34-546" aria-hidden="true" tabindex="-1"></a>Sometimes cloropleth maps can be misleading. </span>
<span id="cb34-547"><a href="#cb34-547" aria-hidden="true" tabindex="-1"></a>An alternative is to warp space so that the area of each region is proportional to the value. </span>
<span id="cb34-548"><a href="#cb34-548" aria-hidden="true" tabindex="-1"></a>This is a cartogram, which can be made with the <span class="in">`cartogram`</span> package.</span>
<span id="cb34-551"><a href="#cb34-551" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-552"><a href="#cb34-552" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cartogram</span></span>
<span id="cb34-553"><a href="#cb34-553" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-554"><a href="#cb34-554" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Cartogram showing total phosphate discharge in municipal wastewater by fylke.</span></span>
<span id="cb34-555"><a href="#cb34-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-556"><a href="#cb34-556" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cartogram)</span>
<span id="cb34-557"><a href="#cb34-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-558"><a href="#cb34-558" aria-hidden="true" tabindex="-1"></a><span class="co"># simplify sf object for speed</span></span>
<span id="cb34-559"><a href="#cb34-559" aria-hidden="true" tabindex="-1"></a>fylker_discharge_sim <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_simplify</span>(fylker_discharge, <span class="at">dTolerance =</span> <span class="dv">1000</span>)</span>
<span id="cb34-560"><a href="#cb34-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-561"><a href="#cb34-561" aria-hidden="true" tabindex="-1"></a><span class="co"># make cartogram</span></span>
<span id="cb34-562"><a href="#cb34-562" aria-hidden="true" tabindex="-1"></a>kart <span class="ot">&lt;-</span> <span class="fu">cartogram_cont</span>(fylker_discharge_sim, <span class="at">weight =</span> <span class="st">"total_discharge"</span>, <span class="at">itermax =</span> <span class="dv">5</span>)</span>
<span id="cb34-563"><a href="#cb34-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-564"><a href="#cb34-564" aria-hidden="true" tabindex="-1"></a><span class="co"># plot cartogram</span></span>
<span id="cb34-565"><a href="#cb34-565" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(kart) <span class="sc">+</span></span>
<span id="cb34-566"><a href="#cb34-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> total_discharge)) <span class="sc">+</span></span>
<span id="cb34-567"><a href="#cb34-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Wastewater</span><span class="sc">\n</span><span class="st">P discharge</span><span class="sc">\n</span><span class="st">tonnes"</span>) <span class="sc">+</span></span>
<span id="cb34-568"><a href="#cb34-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">99</span>, .<span class="dv">01</span>), </span>
<span id="cb34-569"><a href="#cb34-569" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb34-570"><a href="#cb34-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-571"><a href="#cb34-571" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-572"><a href="#cb34-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-573"><a href="#cb34-573" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb34-574"><a href="#cb34-574" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb34-575"><a href="#cb34-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-576"><a href="#cb34-576" aria-hidden="true" tabindex="-1"></a>With <span class="in">`rnaturalearth`</span> data, make a world map that shows the population (column pop_est) of each country.</span>
<span id="cb34-577"><a href="#cb34-577" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-578"><a href="#cb34-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-579"><a href="#cb34-579" aria-hidden="true" tabindex="-1"></a><span class="fu">### raster</span></span>
<span id="cb34-580"><a href="#cb34-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-581"><a href="#cb34-581" aria-hidden="true" tabindex="-1"></a>Raster data, perhaps the output of a model, can also be added to maps, using code similar to that for plotting a raster basemap.</span>
<span id="cb34-582"><a href="#cb34-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-583"><a href="#cb34-583" aria-hidden="true" tabindex="-1"></a><span class="fu">## Scalebars, north pointer etc</span></span>
<span id="cb34-584"><a href="#cb34-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-585"><a href="#cb34-585" aria-hidden="true" tabindex="-1"></a>Scalebars and north pointers can be added with the <span class="in">`ggspatial`</span> package or the <span class="in">`ggsn`</span> package.</span>
<span id="cb34-586"><a href="#cb34-586" aria-hidden="true" tabindex="-1"></a>North points are not very useful if the map has gridlines as these already indicate north.</span>
<span id="cb34-587"><a href="#cb34-587" aria-hidden="true" tabindex="-1"></a>A scalebar can be useful, especially for large scale map.</span>
<span id="cb34-588"><a href="#cb34-588" aria-hidden="true" tabindex="-1"></a>On small scale maps, they can be inaccurate as the scale varies.</span>
<span id="cb34-589"><a href="#cb34-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-592"><a href="#cb34-592" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-593"><a href="#cb34-593" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: annotations</span></span>
<span id="cb34-594"><a href="#cb34-594" aria-hidden="true" tabindex="-1"></a><span class="co"># with rnaturalearth</span></span>
<span id="cb34-595"><a href="#cb34-595" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-596"><a href="#cb34-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> norway) <span class="sc">+</span></span>
<span id="cb34-597"><a href="#cb34-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">9</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">59</span>, <span class="dv">62</span>)) <span class="sc">+</span></span>
<span id="cb34-598"><a href="#cb34-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"br"</span>) <span class="co"># br = bottom right</span></span>
<span id="cb34-599"><a href="#cb34-599" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-600"><a href="#cb34-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-601"><a href="#cb34-601" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hints for maps</span></span>
<span id="cb34-602"><a href="#cb34-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-603"><a href="#cb34-603" aria-hidden="true" tabindex="-1"></a>Keep it simple.</span>
<span id="cb34-604"><a href="#cb34-604" aria-hidden="true" tabindex="-1"></a>Remove unnecessary features (do you really need to show the bathymetry?) and use appropriate scale data for the base map (too high resolution takes a long time to plot and can look worse).</span>
<span id="cb34-605"><a href="#cb34-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-606"><a href="#cb34-606" aria-hidden="true" tabindex="-1"></a>Use facets as necessary (different species, different years etc).</span>
<span id="cb34-607"><a href="#cb34-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-608"><a href="#cb34-608" aria-hidden="true" tabindex="-1"></a>If you need multiple colour scales, the <span class="in">`ggnewscale`</span> package can help.</span>
<span id="cb34-609"><a href="#cb34-609" aria-hidden="true" tabindex="-1"></a>Use inset maps (@sec-combining-plots) to show your location in context.</span>
<span id="cb34-610"><a href="#cb34-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-611"><a href="#cb34-611" aria-hidden="true" tabindex="-1"></a><span class="fu">### Projections</span></span>
<span id="cb34-612"><a href="#cb34-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-613"><a href="#cb34-613" aria-hidden="true" tabindex="-1"></a>The Earth is an oblate sphere and needs projecting to plot in two dimensions.</span>
<span id="cb34-614"><a href="#cb34-614" aria-hidden="true" tabindex="-1"></a>This inevitably leads to distortions, especially for maps with a large extent.</span>
<span id="cb34-615"><a href="#cb34-615" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Different projections</span><span class="co">](https://proj.org/operations/projections/index.html)</span> have different properties and may be suitable for different purposes or regions.</span>
<span id="cb34-616"><a href="#cb34-616" aria-hidden="true" tabindex="-1"></a><span class="in">`ggOceanMaps`</span> can automatically select a projection based on the location, otherwise the map projection can be set using <span class="in">`coord_sf()`</span>.</span>
<span id="cb34-617"><a href="#cb34-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-618"><a href="#cb34-618" aria-hidden="true" tabindex="-1"></a>The <span class="co">[</span><span class="ot">projection wizard</span><span class="co">](https://projectionwizard.org/#)</span> can help choose a projection for a given area (copy the PROJ string).</span>
<span id="cb34-619"><a href="#cb34-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-622"><a href="#cb34-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-623"><a href="#cb34-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: projections</span></span>
<span id="cb34-624"><a href="#cb34-624" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: hide</span></span>
<span id="cb34-625"><a href="#cb34-625" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb34-626"><a href="#cb34-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-627"><a href="#cb34-627" aria-hidden="true" tabindex="-1"></a>default <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(world) <span class="sc">+</span> <span class="fu">geom_sf</span>()</span>
<span id="cb34-628"><a href="#cb34-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-629"><a href="#cb34-629" aria-hidden="true" tabindex="-1"></a>mollweide <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(world) <span class="sc">+</span> <span class="co"># Equal-area world map projection</span></span>
<span id="cb34-630"><a href="#cb34-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span> </span>
<span id="cb34-631"><a href="#cb34-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"+proj=moll"</span>) <span class="co"># projection specified with a 'proj' string</span></span>
<span id="cb34-632"><a href="#cb34-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-633"><a href="#cb34-633" aria-hidden="true" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>) <span class="co"># might need to turn spherical geometry for some projections</span></span>
<span id="cb34-634"><a href="#cb34-634" aria-hidden="true" tabindex="-1"></a>polar_lambert <span class="ot">&lt;-</span>  world <span class="sc">|&gt;</span> </span>
<span id="cb34-635"><a href="#cb34-635" aria-hidden="true" tabindex="-1"></a>  <span class="co"># !important - don't crop to tightly or crop lines will show in plot</span></span>
<span id="cb34-636"><a href="#cb34-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_crop</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">180</span>, <span class="at">ymin =</span> <span class="dv">50</span>, <span class="at">xmax =</span> <span class="dv">180</span>, <span class="at">ymax =</span> <span class="dv">90</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb34-637"><a href="#cb34-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="co"># Transverse cylindrical equal-area</span></span>
<span id="cb34-638"><a href="#cb34-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb34-639"><a href="#cb34-639" aria-hidden="true" tabindex="-1"></a><span class="co">#   coord_sf(crs = "+proj=moll")</span></span>
<span id="cb34-640"><a href="#cb34-640" aria-hidden="true" tabindex="-1"></a>  <span class="co"># projection specified with a proj string</span></span>
<span id="cb34-641"><a href="#cb34-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">'+proj=laea +lon_0=14.4140625 +lat_0=90 +datum=WGS84 +units=m +no_defs'</span>, </span>
<span id="cb34-642"><a href="#cb34-642" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">100000</span>, <span class="sc">-</span><span class="dv">3500000</span>), <span class="co"># xlim/ylim in units of projection</span></span>
<span id="cb34-643"><a href="#cb34-643" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2000000</span>, <span class="dv">2000000</span>)) <span class="co"># here in metres</span></span>
<span id="cb34-644"><a href="#cb34-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-645"><a href="#cb34-645" aria-hidden="true" tabindex="-1"></a>default<span class="sc">/</span>mollweide<span class="sc">/</span>polar_lambert</span>
<span id="cb34-646"><a href="#cb34-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-647"><a href="#cb34-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-648"><a href="#cb34-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-649"><a href="#cb34-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-650"><a href="#cb34-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-651"><a href="#cb34-651" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb34-652"><a href="#cb34-652" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb34-653"><a href="#cb34-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-654"><a href="#cb34-654" aria-hidden="true" tabindex="-1"></a>Change the projection of one of the small-scale maps you made previously.</span>
<span id="cb34-655"><a href="#cb34-655" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-656"><a href="#cb34-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-657"><a href="#cb34-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-658"><a href="#cb34-658" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> Interactive maps --&gt;</span></span>
<span id="cb34-659"><a href="#cb34-659" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> leaflets --&gt;</span></span>
<span id="cb34-660"><a href="#cb34-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-661"><a href="#cb34-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-662"><a href="#cb34-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-663"><a href="#cb34-663" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- </span><span class="al">###</span><span class="co"> coords on projected maps --&gt;</span></span>
<span id="cb34-664"><a href="#cb34-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-665"><a href="#cb34-665" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- better geom_path map --&gt;</span></span>
<span id="cb34-666"><a href="#cb34-666" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- new example exercise --&gt;</span></span>
<span id="cb34-667"><a href="#cb34-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-668"><a href="#cb34-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-669"><a href="#cb34-669" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb34-670"><a href="#cb34-670" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further reading</span></span>
<span id="cb34-671"><a href="#cb34-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-672"><a href="#cb34-672" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Spatial Data Science</span><span class="co">](https://r-spatial.org/book/)</span></span>
<span id="cb34-673"><a href="#cb34-673" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">Visualizing geospatial data</span><span class="co">](https://clauswilke.com/dataviz/geospatial-data.html)</span></span>
<span id="cb34-674"><a href="#cb34-674" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-675"><a href="#cb34-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-676"><a href="#cb34-676" aria-hidden="true" tabindex="-1"></a>::: column-margin</span>
<span id="cb34-677"><a href="#cb34-677" aria-hidden="true" tabindex="-1"></a><span class="fu">### Contributors {.unlisted .unnumbered}</span></span>
<span id="cb34-678"><a href="#cb34-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-679"><a href="#cb34-679" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Richard Telford</span>
<span id="cb34-680"><a href="#cb34-680" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>
