<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5 Pipes | Working in R</title>
<meta name="author" content="Jonathan Soulé, Aud Halbritter and Richard J Telford">
<meta name="description" content="If we want to run several functions in turn, for example, if we wanted to find the mean bill length for each penguin species with group_by and summarise (you will find out more about these...">
<meta name="generator" content="bookdown 0.23 with bs4_book()">
<meta property="og:title" content="5 Pipes | Working in R">
<meta property="og:type" content="book">
<meta property="og:description" content="If we want to run several functions in turn, for example, if we wanted to find the mean bill length for each penguin species with group_by and summarise (you will find out more about these...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="5 Pipes | Working in R">
<meta name="twitter:description" content="If we want to run several functions in turn, for example, if we wanted to find the mean bill length for each penguin species with group_by and summarise (you will find out more about these...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.10/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet">
<script src="libs/panelset-0.2.6/panelset.js"></script><link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="css/style-chapters.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Working in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Introduction</a></li>
<li class="book-part">Setting up R and RStudio</li>
<li><a class="" href="getting-started-with-r.html"><span class="header-section-number">2</span> Getting started with R</a></li>
<li class="book-part">First steps in R</li>
<li><a class="" href="first-steps-in-r.html"><span class="header-section-number">3</span> First steps in R</a></li>
<li><a class="" href="importing-data-in-r.html"><span class="header-section-number">4</span> Importing data in R</a></li>
<li class="book-part">Data manipulation with the tidyverse</li>
<li><a class="active" href="pipes.html"><span class="header-section-number">5</span> Pipes</a></li>
<li><a class="" href="tidying-data-with-tidyr.html"><span class="header-section-number">6</span> Tidying data with tidyr</a></li>
<li><a class="" href="working-with-single-tables-in-dplyr.html"><span class="header-section-number">7</span> Working with single tables in dplyr</a></li>
<li><a class="" href="working-with-multiple-tables-in-dplyr.html"><span class="header-section-number">8</span> Working with multiple tables in dplyr</a></li>
<li class="book-part">Data visualisation</li>
<li><a class="" href="why-is-data-visualization-important.html"><span class="header-section-number">10</span> Why is data visualization important?</a></li>
<li><a class="" href="getting-started-with-ggplot.html"><span class="header-section-number">11</span> Getting started with ggplot</a></li>
<li><a class="" href="types-of-vizualization.html"><span class="header-section-number">12</span> Types of vizualization</a></li>
<li><a class="" href="themes-1.html"><span class="header-section-number">13</span> Themes</a></li>
<li><a class="" href="shapes-colours-and-linetypes.html"><span class="header-section-number">14</span> Shapes, colours and linetypes</a></li>
<li><a class="" href="combining-plots.html"><span class="header-section-number">15</span> Combining plots</a></li>
<li class="book-part">Other topics</li>
<li><a class="" href="handling-missing-values.html"><span class="header-section-number">16</span> Handling missing values</a></li>
<li><a class="" href="bestiary-of-brackets-and-other-r-notation.html"><span class="header-section-number">17</span> Bestiary of Brackets and other R notation</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="pipes" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Pipes<a class="anchor" aria-label="anchor" href="#pipes"><i class="fas fa-link"></i></a>
</h1>
<p>If we want to run several functions in turn, for example, if we wanted to find the mean bill length for each penguin species with <code>group_by</code> and <code>summarise</code> (you will find out more about these functions in Chapter <a href="working-with-single-tables-in-dplyr.html#working-with-single-tables-in-dplyr">7</a>).
You could nest one function inside the other.</p>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">summarise</span><span class="op">(</span><span class="fu">group_by</span><span class="op">(</span><span class="va">penguins</span>, <span class="va">species</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   species    mean
##   &lt;fct&gt;     &lt;dbl&gt;
## 1 Adelie     38.8
## 2 Chinstrap  48.8
## 3 Gentoo     47.5</code></pre>
<p>With more larger problems using more function, this solution becomes almost impossible to read and it is very easy to make mistakes and forget which brackets belong to which function.</p>
<p>Another strategy is to make and use intermediate objects</p>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins_grouped</span> <span class="op">&lt;-</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">penguins</span>, <span class="va">species</span><span class="op">)</span>
<span class="fu">summarise</span><span class="op">(</span><span class="va">penguins_grouped</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   species    mean
##   &lt;fct&gt;     &lt;dbl&gt;
## 1 Adelie     38.8
## 2 Chinstrap  48.8
## 3 Gentoo     47.5</code></pre>
<p>This works better, but can generate many intermediates and it can be difficult to ensure that the correct one is used.</p>
<p>A popular alternative is to use pipes.
The R code for a pipe is <code>|&gt;</code>
Pipes pass the results from one function directly into the next function.</p>
<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">penguins</span> |&gt; 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   species    mean
##   &lt;fct&gt;     &lt;dbl&gt;
## 1 Adelie     38.8
## 2 Chinstrap  48.8
## 3 Gentoo     47.5</code></pre>
<p>You never need to use pipes, but they can make code more readable.</p>
<div id="the-old-pipe" class="section level3 unnumbered facta toc-ignore">
<h3>The old pipe <code>%&gt;%</code><a class="anchor" aria-label="anchor" href="#the-old-pipe"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>|&gt;</code> pipe was introduced in R version 4.1.
Previously, the <code>magrittr</code> package pipe <code><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> was widely used, especially with tidyverse functions.
You will see the <code><a href="https://tidyr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> in a lot of code on <a href="https://stackoverflow.com/questions/tagged/r">stackoverflow</a> and other help sites.
In most cases the old and new pipes work in exactly the same way.
Advantages of the <code>|&gt;</code> pipe are that it is</p>
<ul>
<li>slightly faster</li>
<li>doesn’t need any packages loading</li>
<li>easier to debug</li>
</ul>
</div>
<div id="a-recipe-for-mashed-potato" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> A recipe for mashed potato<a class="anchor" aria-label="anchor" href="#a-recipe-for-mashed-potato"><i class="fas fa-link"></i></a>
</h2>
<p>The pipe can be read as “and then”.
This recipe for mashed potato can be read as buy 1kg potatoes, <em>and then</em> peel them, <em>and then</em> boil them, and so on.</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">buy</span><span class="op">(</span><span class="st">"potatoes"</span>, kg <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span> |&gt; 
  <span class="fu">peel</span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu">boil</span><span class="op">(</span>minutes <span class="op">=</span> <span class="st">"15"</span><span class="op">)</span> |&gt; 
  <span class="fu">drain</span><span class="op">(</span><span class="op">)</span> |&gt; 
  <span class="fu">mash</span><span class="op">(</span>add <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"salt"</span>, <span class="st">"milk"</span>, <span class="st">"butter"</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu">serve</span><span class="op">(</span>decorate <span class="op">=</span> <span class="st">"parsley"</span><span class="op">)</span></code></pre></div>
</div>
<div id="the-native-r-pipe" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> The native R pipe <code>|&gt;</code><a class="anchor" aria-label="anchor" href="#the-native-r-pipe"><i class="fas fa-link"></i></a>
</h2>
<p>The pipe passes result of code on left of pipe to the function on right, and puts it in the first available argument.</p>
<p>So</p>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f</span> <span class="op">&lt;-</span> <span class="st">"file.csv"</span>
<span class="fu">read_csv</span><span class="op">(</span>file <span class="op">=</span> <span class="va">f</span><span class="op">)</span></code></pre></div>
<p>and be rewritten as</p>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f</span> |&gt;
 <span class="fu">read_csv</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>If you want to put the object passed through the pipe into the second argument, you need to name the first, so that it is not available.
So if we want to pipe <code>penguins</code> into <code>lm</code> to fit a linear model, we need penguins to be put into the <code>data</code> argument, which is the second argument of <code>lm</code>.
We can force this by naming the <code>formula</code> argument, so that <code>data</code> is the first available argument.</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># un-named argument = fails</span>
<span class="va">penguins</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">bill_length</span> <span class="op">~</span> <span class="va">species</span><span class="op">)</span>

<span class="co"># named first argument, penguins pipes into second argument</span>
<span class="va">penguins</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">bill_length</span> <span class="op">~</span> <span class="va">species</span><span class="op">)</span></code></pre></div>
<p>More complex arrangements, for example piping the same object to two separate commands can be done by writing a function.
You probably won’t have to do this very often.</p>
</div>
<div id="making-a-pipe" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Making a pipe<a class="anchor" aria-label="anchor" href="#making-a-pipe"><i class="fas fa-link"></i></a>
</h2>
<p>You can make a pipe either by typing it directly, or by using the RStudio keyboard shortcut <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>m</kbd>
(on a Mac, <kbd>cmd</kbd> + <kbd>Shift</kbd> + <kbd>m</kbd>).
You may need to set the RStudio options.
Go to <code>Tools</code> &gt; <code>Global Options</code> &gt; <code>Code</code> and tick <code>Use native pipe operator, |&gt;</code>.
To make your code readable, put a line break after each pipe.</p>
<div id="contributors-3" class="section level3 unnumbered contributors toc-ignore">
<h3>Contributors<a class="anchor" aria-label="anchor" href="#contributors-3"><i class="fas fa-link"></i></a>
</h3>
<p>Richard J. Telford</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="importing-data-in-r.html"><span class="header-section-number">4</span> Importing data in R</a></div>
<div class="next"><a href="tidying-data-with-tidyr.html"><span class="header-section-number">6</span> Tidying data with tidyr</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li>
<a class="nav-link" href="#pipes"><span class="header-section-number">5</span> Pipes</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#the-old-pipe">The old pipe %&gt;%</a></li></ul>
</li>
<li><a class="nav-link" href="#a-recipe-for-mashed-potato"><span class="header-section-number">5.1</span> A recipe for mashed potato</a></li>
<li><a class="nav-link" href="#the-native-r-pipe"><span class="header-section-number">5.2</span> The native R pipe |&gt;</a></li>
<li>
<a class="nav-link" href="#making-a-pipe"><span class="header-section-number">5.3</span> Making a pipe</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#contributors-3">Contributors</a></li></ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Working in R</strong>" was written by Jonathan Soulé, Aud Halbritter and Richard J Telford. It was last built on 2021-08-31.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
