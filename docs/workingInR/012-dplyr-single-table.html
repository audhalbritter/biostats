<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.309">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Working in R - 14&nbsp; Working with single tables in dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./013-dplyr-multiple-tables.html" rel="next">
<link href="./011-tidyr-pivot.html" rel="prev">
<link href="./../figures/favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link rel="stylesheet" href="include/webex.css">
</head>
<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./010-pipes.html">Data manipulation with the tidyverse</a></li><li class="breadcrumb-item"><a href="./012-dplyr-single-table.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Working with single tables in `dplyr`</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Working in R</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/biostats-r/biostats" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Setting up R and RStudio</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0010_Getting_Started_with_RStudio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Installing and configuring R and RStudio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0011_projects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">RStudio projects</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0012_scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Working with a script</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0013_packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Installing packages</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">First steps in R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0021_R_calculator.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R as a calculator</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0022_help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Help!</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0023_objects_names.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Objects and names</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./002_V_is_for_vector.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">V is for vector</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0025_data_structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data structures beyond the vector</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./005_Importing_Data_in_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Importing data in R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Data manipulation with the tidyverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-pipes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Pipes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./011-tidyr-pivot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Tidying data with <code>tidyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./012-dplyr-single-table.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Working with single tables in <code>dplyr</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./013-dplyr-multiple-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Working with multiple tables in <code>dplyr</code></span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Data Visualisation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./100_why_data_visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Why is data visualization important?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./101_getting_started_with_ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Getting started with ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./103_different_types_of_vizualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Choosing your visualisation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./118_themes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Themes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./120_colour_shape_linetypes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Colours, shapes and linetypes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./125_ggplot_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Regression and ggplot</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./130_patchwork.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Combining plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./140_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Making maps in R</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Other Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./050_missing_values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Handling missing values</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./060_bestiary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Bestiary of Brackets and other R notation</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<style>
               img.site-logo {
  height: auto;
  width: 95%;
}
      </style>
<p><a  href="https://biostats.w.uib.no/" aria-label="bioST@TS | When biology adds up, at last&#8230;"><img class="site-logo" src="https://biostats.w.uib.no/files/2020/01/biostats-button-res2.png" alt="BioST@TS homepage" width="250" height="101"  data-no-retina class=" attachment-11864" title = "BioST@TS homepage"/></a>  
<br><a  href="../index.html" aria-label="bioST@TS | When biology adds up, at last&#8230;"><img class="site-logo" src="../figures/icons_all.png" alt= "BioST@TS books" width="250" height="101"  data-no-retina class=" attachment-11864", title = "BioST@TS books"/></a>   </p>
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#load-the-package" id="toc-load-the-package" class="nav-link active" data-scroll-target="#load-the-package"><span class="header-section-number">14.0.1</span> Load the package</a></li>
  <li><a href="#more-feedback-tidylog" id="toc-more-feedback-tidylog" class="nav-link" data-scroll-target="#more-feedback-tidylog"><span class="header-section-number">14.0.2</span> More feedback <code>tidylog</code></a></li>
  <li><a href="#the-penguins-dataset" id="toc-the-penguins-dataset" class="nav-link" data-scroll-target="#the-penguins-dataset"><span class="header-section-number">14.1</span> The <code>penguins</code> dataset</a></li>
  <li>
<a href="#selecting-columns-with-select" id="toc-selecting-columns-with-select" class="nav-link" data-scroll-target="#selecting-columns-with-select"><span class="header-section-number">14.2</span> Selecting columns with <code>select()</code></a>
  <ul class="collapse">
<li><a href="#sec-select-helpers" id="toc-sec-select-helpers" class="nav-link" data-scroll-target="#sec-select-helpers"><span class="header-section-number">14.2.1</span> <code>select()</code> helpers</a></li>
  </ul>
</li>
  <li><a href="#renaming-columns-with-rename" id="toc-renaming-columns-with-rename" class="nav-link" data-scroll-target="#renaming-columns-with-rename"><span class="header-section-number">14.3</span> Renaming columns with <code>rename</code></a></li>
  <li><a href="#moving-columns-with-relocate" id="toc-moving-columns-with-relocate" class="nav-link" data-scroll-target="#moving-columns-with-relocate"><span class="header-section-number">14.4</span> Moving columns with <code>relocate()</code></a></li>
  <li>
<a href="#filtering-rows-with-filter" id="toc-filtering-rows-with-filter" class="nav-link" data-scroll-target="#filtering-rows-with-filter"><span class="header-section-number">14.5</span> Filtering rows with <code>filter()</code></a>
  <ul class="collapse">
<li><a href="#filtering-on-multiple-criteria" id="toc-filtering-on-multiple-criteria" class="nav-link" data-scroll-target="#filtering-on-multiple-criteria"><span class="header-section-number">14.5.1</span> Filtering on multiple criteria</a></li>
  <li><a href="#common-errors" id="toc-common-errors" class="nav-link" data-scroll-target="#common-errors"><span class="header-section-number">14.5.2</span> Common errors</a></li>
  </ul>
</li>
  <li><a href="#slicing-the-data-with-slice" id="toc-slicing-the-data-with-slice" class="nav-link" data-scroll-target="#slicing-the-data-with-slice"><span class="header-section-number">14.6</span> Slicing the data with <code>slice()</code></a></li>
  <li><a href="#distinct-rows-with-distinct" id="toc-distinct-rows-with-distinct" class="nav-link" data-scroll-target="#distinct-rows-with-distinct"><span class="header-section-number">14.7</span> Distinct rows with <code>distinct()</code></a></li>
  <li><a href="#random-rows" id="toc-random-rows" class="nav-link" data-scroll-target="#random-rows"><span class="header-section-number">14.8</span> Random rows</a></li>
  <li><a href="#mutating-and-adding-columns-with-mutate" id="toc-mutating-and-adding-columns-with-mutate" class="nav-link" data-scroll-target="#mutating-and-adding-columns-with-mutate"><span class="header-section-number">14.9</span> Mutating and adding columns with <code>mutate</code></a></li>
  <li>
<a href="#summarising-data-with-summarise" id="toc-summarising-data-with-summarise" class="nav-link" data-scroll-target="#summarising-data-with-summarise"><span class="header-section-number">14.10</span> Summarising data with <code>summarise()</code></a>
  <ul class="collapse">
<li><a href="#summarising-multiple-columns" id="toc-summarising-multiple-columns" class="nav-link" data-scroll-target="#summarising-multiple-columns"><span class="header-section-number">14.10.1</span> Summarising multiple columns</a></li>
  </ul>
</li>
  <li><a href="#grouping-data-with-group_by" id="toc-grouping-data-with-group_by" class="nav-link" data-scroll-target="#grouping-data-with-group_by"><span class="header-section-number">14.11</span> Grouping data with <code>group_by</code></a></li>
  <li><a href="#sorting-with-arrange" id="toc-sorting-with-arrange" class="nav-link" data-scroll-target="#sorting-with-arrange"><span class="header-section-number">14.12</span> Sorting with <code>arrange()</code></a></li>
  <li><a href="#counting-rows-with-count-and-n" id="toc-counting-rows-with-count-and-n" class="nav-link" data-scroll-target="#counting-rows-with-count-and-n"><span class="header-section-number">14.13</span> Counting rows with <code>count()</code> and <code>n()</code></a></li>
  <li>
<a href="#common-problems" id="toc-common-problems" class="nav-link" data-scroll-target="#common-problems"><span class="header-section-number">14.14</span> Common problems</a>
  <ul class="collapse">
<li><a href="#non-standard-names" id="toc-non-standard-names" class="nav-link" data-scroll-target="#non-standard-names"><span class="header-section-number">14.14.1</span> Non standard names</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./010-pipes.html">Data manipulation with the tidyverse</a></li><li class="breadcrumb-item"><a href="./012-dplyr-single-table.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Working with single tables in `dplyr`</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-working-with-single-tables-in-dplyr" class="quarto-section-identifier"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Working with single tables in <code>dplyr</code></span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Data frames are usually the most convenient objects for storing, plotting or analysing data in R. We also need to be able to manipulate data in data frames.</p>
<p>This tutorial will show you how to manipulate data frames using the <code>dplyr</code> package, part of <code>tidyverse</code>.</p>
<p>Everything that can be done with <code>dplyr</code> can be done with base R. The <code>dplyr</code> solution is usually easier to write and understand, and can be faster.</p>
<p>There are many function in <code>dplyr</code>, this tutorial focuses on the functions I find most useful.</p>
<section id="load-the-package" class="level3" data-number="14.0.1"><h3 data-number="14.0.1" class="anchored" data-anchor-id="load-the-package">
<span class="header-section-number">14.0.1</span> Load the package</h3>
<p>You can load <code>dplyr</code> with</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But is is usually more convenient to load <code>tidyverse</code> so that you get <code>ggplot2</code>, <code>dplyr</code>, <code>readr</code> and other useful packages with one command.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyverse.tidyverse.org">"tidyverse"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="more-feedback-tidylog" class="level3" data-number="14.0.2"><h3 data-number="14.0.2" class="anchored" data-anchor-id="more-feedback-tidylog">
<span class="header-section-number">14.0.2</span> More feedback <code>tidylog</code>
</h3>
<p>We can get more feedback on what <code>dplyr</code> functions have done to the data by loading the <code>tidylog</code> package.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/elbersb/tidylog/">"tidylog"</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>More than once, <code>tidylog</code> has helped identified bugs in my code.</p>
</section><section id="the-penguins-dataset" class="level2" data-number="14.1"><h2 data-number="14.1" class="anchored" data-anchor-id="the-penguins-dataset">
<span class="header-section-number">14.1</span> The <code>penguins</code> dataset</h2>
<p>This tutorial will use the <code>penguins</code> dataset from the <a href="https://github.com/allisonhorst/palmerpenguins"><code>palmerpenguins</code> package</a>. This dataset includes measurements of three species of penguin.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"penguins"</span>, package <span class="op">=</span> <span class="st">"palmerpenguins"</span><span class="op">)</span></span>
<span><span class="co"># Show the data</span></span>
<span><span class="va">penguins</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           39.5          17.4               186        3800
3 Adelie  Torgersen           40.3          18                 195        3250
# ℹ 341 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</section><section id="selecting-columns-with-select" class="level2" data-number="14.2"><h2 data-number="14.2" class="anchored" data-anchor-id="selecting-columns-with-select">
<span class="header-section-number">14.2</span> Selecting columns with <code>select()</code>
</h2>
<p>You can choose which columns of the data frame you want with <code>select()</code>.</p>
<p>The first argument is the data, which is supplied by the pipe <code>|&gt;</code>, the next arguments are the names of the columns you want. The names do not need quote marks.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#select species, bill_length_mm &amp; bill_depth_mm</span></span>
<span><span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">species</span>, <span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 5 variables (island, flipper_length_mm, body_mass_g, sex, year)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 3
  species bill_length_mm bill_depth_mm
  &lt;fct&gt;            &lt;dbl&gt;         &lt;dbl&gt;
1 Adelie            39.1          18.7
2 Adelie            39.5          17.4
3 Adelie            40.3          18  
# ℹ 341 more rows</code></pre>
</div>
</div>
<p>This is equivalent to the base R code</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#select species, bill_length_mm &amp; bill_depth_mm</span></span>
<span><span class="va">penguins</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"bill_length_mm"</span>, <span class="st">"bill_depth_mm"</span><span class="op">)</span><span class="op">]</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 3
  species bill_length_mm bill_depth_mm
  &lt;fct&gt;            &lt;dbl&gt;         &lt;dbl&gt;
1 Adelie            39.1          18.7
2 Adelie            39.5          17.4
3 Adelie            40.3          18  
# ℹ 341 more rows</code></pre>
</div>
</div>
<p>Remember that if you want to use the output of this code in a further analysis, you need to assign it to an object name with <code>&lt;-</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>From the <code>penguins</code> data, select</p>
<ul>
<li><code>species</code></li>
<li>
<code>species</code> and <code>bill_length_mm</code>
</li>
<li>all columns except year</li>
</ul>
<details><summary>
Hint
</summary><div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(___, ___)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
<section id="sec-select-helpers" class="level3" data-number="14.2.1"><h3 data-number="14.2.1" class="anchored" data-anchor-id="sec-select-helpers">
<span class="header-section-number">14.2.1</span> <code>select()</code> helpers</h3>
<p>Sometimes we don’t want to write out the names of all the columns we want to select. We might not even know them all in advance. Fortunately there are some helper functions.</p>
<p>If you want to <code>select()</code> adjacent columns, you can use the notation <code>first:last</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#select species to bill_depth_mm</span></span>
<span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="va">species</span><span class="op">:</span><span class="va">bill_depth_mm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 4 variables (flipper_length_mm, body_mass_g, sex, year)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 4
  species island    bill_length_mm bill_depth_mm
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;
1 Adelie  Torgersen           39.1          18.7
2 Adelie  Torgersen           39.5          17.4
3 Adelie  Torgersen           40.3          18  
# ℹ 341 more rows</code></pre>
</div>
</div>
<p>Sometimes it is easier to remove the columns you don’t want. You can do this by putting a <code>-</code> in front of the column name.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#select everything but year and sex</span></span>
<span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">year</span>, <span class="op">-</span><span class="va">sex</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 2 variables (sex, year)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 6
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           39.5          17.4               186        3800
3 Adelie  Torgersen           40.3          18                 195        3250
# ℹ 341 more rows</code></pre>
</div>
</div>
<p>If there is a pattern to the column names that we want to select (or remove), there are some helper functions. For example, to select columns that start with “bill”, we can use <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#select bill_length_mm &amp; bill_depth_mm" </span></span>
<span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"bill"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 6 variables (species, island, flipper_length_mm, body_mass_g, sex, …)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 2
  bill_length_mm bill_depth_mm
           &lt;dbl&gt;         &lt;dbl&gt;
1           39.1          18.7
2           39.5          17.4
3           40.3          18  
# ℹ 341 more rows</code></pre>
</div>
</div>
<p>Conversely, if we want to select all columns that end with “mm”, we can use <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with()</a></code>. <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains()</a></code> is more flexible and <code><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches()</a></code> is the most powerful of the helper functions, using regular expressions to identify the columns (see the regular expression tutorial).</p>
<p>Sometimes, you might want to select all the columns of a certain type. For example, to select all the numeric columns we can use the <code>is.numeric</code> function inside <code>select()</code> with the helper <code><a href="https://tidyselect.r-lib.org/reference/where.html">where()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/where.html">where</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span> <span class="co"># No brackets on the function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: dropped 3 variables (species, island, sex)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 5
  bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  year
           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;int&gt;
1           39.1          18.7               181        3750  2007
2           39.5          17.4               186        3800  2007
3           40.3          18                 195        3250  2007
# ℹ 341 more rows</code></pre>
</div>
</div>
<p>Other <code>is.*</code> functions exist, for example, <code>is.character</code> for text.</p>
<p>You can also select columns by number (1 being the first column), but this is generally a bad idea because it makes the code difficult to understand and if a new column is added, or the column order is changed, the code will break.</p>
<p>Which of these strategies works best is context dependent.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>From the <code>penguins</code> data, select</p>
<ul>
<li>all columns except year</li>
<li>all non-numeric columns</li>
<li>
<code>species</code> and columns ending in “mm”</li>
</ul>
<details><summary>
Hint
</summary><div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hint 1</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>___)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># hint 2</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>?where</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># hint 3</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>?ends_with</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</section></section><section id="renaming-columns-with-rename" class="level2" data-number="14.3"><h2 data-number="14.3" class="anchored" data-anchor-id="renaming-columns-with-rename">
<span class="header-section-number">14.3</span> Renaming columns with <code>rename</code>
</h2>
<p>You can use <code>rename()</code> to rename columns</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">rename</span><span class="op">(</span>Species <span class="op">=</span> <span class="va">species</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>rename: renamed one variable (Species)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
  Species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           39.5          17.4               186        3800
3 Adelie  Torgersen           40.3          18                 195        3250
# ℹ 341 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>The syntax is <code>new_name = current_name</code>.</p>
<p>You can also rename a column when selecting. This is convenient if you are using <code>select()</code> anyway.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span>Species <span class="op">=</span> <span class="va">species</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>select: renamed one variable (Species) and dropped 7 variables</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 1
  Species
  &lt;fct&gt;  
1 Adelie 
2 Adelie 
3 Adelie 
# ℹ 341 more rows</code></pre>
</div>
</div>
</section><section id="moving-columns-with-relocate" class="level2" data-number="14.4"><h2 data-number="14.4" class="anchored" data-anchor-id="moving-columns-with-relocate">
<span class="header-section-number">14.4</span> Moving columns with <code>relocate()</code>
</h2>
<p>Sometimes it is useful to reorder the columns. This is never necessary for data analysis or plotting, but can be needed when making a table for presentation.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">relocate</span><span class="op">(</span><span class="va">island</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>relocate: columns reordered (island, species, bill_length_mm, bill_depth_mm, flipper_length_mm, …)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
  island    species bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;     &lt;fct&gt;            &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Torgersen Adelie            39.1          18.7               181        3750
2 Torgersen Adelie            39.5          17.4               186        3800
3 Torgersen Adelie            40.3          18                 195        3250
# ℹ 341 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>The default is to move the named column first, the <code>.before</code> and <code>.after</code> arguments let you move the column into any position.</p>
</section><section id="filtering-rows-with-filter" class="level2" data-number="14.5"><h2 data-number="14.5" class="anchored" data-anchor-id="filtering-rows-with-filter">
<span class="header-section-number">14.5</span> Filtering rows with <code>filter()</code>
</h2>
<p>Filtering rows that meet some condition is a very common task.</p>
<p>For example, to filter rows of <code>penguins</code> that have a bill length greater than 40 mm, we can use</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">filter</span><span class="op">(</span><span class="va">bill_length_mm</span> <span class="op">&gt;</span> <span class="fl">40</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 102 rows (30%), 242 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 242 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           40.3          18                 195        3250
2 Adelie  Torgersen           42            20.2               190        4250
3 Adelie  Torgersen           41.1          17.6               182        3200
# ℹ 239 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>This will filter out each row where the condition is <code>TRUE</code>.</p>
<p>The base R equivalent of this is</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span><span class="op">[</span><span class="va">penguins</span><span class="op">$</span><span class="va">bill_length_mm</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 244 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           40.3          18                 195        3250
2 &lt;NA&gt;    &lt;NA&gt;                NA            NA                  NA          NA
3 Adelie  Torgersen           42            20.2               190        4250
# ℹ 241 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>Generally, <code>filter</code> makes it easier to understand, especially with more complex criteria.</p>
<p>Other tests include</p>
<ul>
<li>
<code>==</code> exactly equals. Often a bad idea to use with numeric data</li>
<li>
<code>near</code> safe function for testing equality of numeric data as it has a tolerance for rounding errors.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">==</span> <span class="fl">2</span> <span class="co"># should be true, but rounding errors </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">-</span> <span class="fl">2</span> <span class="co"># the difference</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.440892e-16</code></pre>
</div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html">near</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># safe alternative</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<ul>
<li>
<code>!=</code> not equal to</li>
<li>
<code>&lt;</code> less than</li>
<li>
<code>&lt;=</code> less than or equal to</li>
<li>
<code>&gt;</code> greater than</li>
<li>
<code>&gt;=</code> greater than or equal to</li>
<li>
<code><a href="https://rdrr.io/r/base/NA.html">is.na()</a></code> for filtering by missing values.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/between.html">between()</a></code> for filtering values with a range</li>
<li>
<code>%in%</code> is used when you want to test if a value is in a vector</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">species</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Adelie"</span>, <span class="st">"Chinstrap"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 124 rows (36%), 220 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 220 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           39.5          17.4               186        3800
3 Adelie  Torgersen           40.3          18                 195        3250
# ℹ 217 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#equivalent to </span></span>
<span><span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Adelie"</span> <span class="op">|</span> <span class="va">species</span> <span class="op">==</span> <span class="st">"Chinstrap"</span><span class="op">)</span> <span class="co"># with many alternatives, this gets long</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 124 rows (36%), 220 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 220 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           39.5          17.4               186        3800
3 Adelie  Torgersen           40.3          18                 195        3250
# ℹ 217 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<section id="filtering-on-multiple-criteria" class="level3" data-number="14.5.1"><h3 data-number="14.5.1" class="anchored" data-anchor-id="filtering-on-multiple-criteria">
<span class="header-section-number">14.5.1</span> Filtering on multiple criteria</h3>
<p>If we want to filter on multiple criteria, we need to decide whether we want all criteria to be <code>TRUE</code> (AND in Boolean logic), or for one or more to be <code>TRUE</code> (OR in Boolean logic).</p>
<p>If we want all criteria to be <code>TRUE</code>, we can separate them by a comma (or by an <code>&amp;</code> if you want to be explicit).</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">bill_length_mm</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="va">bill_depth_mm</span> <span class="op">&gt;</span> <span class="fl">18</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 263 rows (76%), 81 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 81 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           42            20.2               190        4250
2 Adelie  Torgersen           42.5          20.7               197        4500
3 Adelie  Torgersen           46            21.5               194        4200
# ℹ 78 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>If we want rows where any of the criteria is <code>TRUE</code>, we can separate them by a <code>|</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">bill_length_mm</span> <span class="op">&gt;</span> <span class="fl">40</span> <span class="op">|</span> <span class="va">bill_depth_mm</span> <span class="op">&gt;</span> <span class="fl">18</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 53 rows (15%), 291 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 291 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           40.3          18                 195        3250
3 Adelie  Torgersen           36.7          19.3               193        3450
# ℹ 288 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>We can negate a criterion by putting <code>!</code> in front of it. So to filter rows that do not have bills longer than 40 mm we can use</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">filter</span><span class="op">(</span><span class="op">!</span><span class="va">bill_length_mm</span> <span class="op">&gt;</span> <span class="fl">40</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>filter: removed 244 rows (71%), 100 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           39.5          17.4               186        3800
3 Adelie  Torgersen           36.7          19.3               193        3450
# ℹ 97 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>Of course, in this example, we could also use <code>&lt;=</code> as the test.</p>
</section><section id="common-errors" class="level3" data-number="14.5.2"><h3 data-number="14.5.2" class="anchored" data-anchor-id="common-errors">
<span class="header-section-number">14.5.2</span> Common errors</h3>
<p>The commonest error is to use a single <code>=</code> rather than <code>==</code>. Only the latter is a test of equality. If you do this, the error message is quite helpful.</p>
<div class="cell">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">filter</span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Chinstrap"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `.fun()`:
! We detected a named input.
ℹ This usually means that you've used `=` instead of `==`.
ℹ Did you mean `species == "Chinstrap"`?</code></pre>
</div>
</div>
<p>Another common error is to forget to quote any strings.</p>
<div class="cell">
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">filter</span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="va">Chinstrap</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `.fun()`:
ℹ In argument: `species == Chinstrap`.
Caused by error:
! object 'Chinstrap' not found</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>From the <code>penguins</code> data, filter</p>
<ul>
<li>Gentoo penguins</li>
<li>Gentoo or Adelie penguins</li>
<li>penguins with a mass greater than or equal to 5000g</li>
<li>penguins with a bill length between 45 and 50 mm</li>
<li>Gentoo penguins not from from Dream Island</li>
</ul>
<details><summary>
Hint
</summary><div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#hint 1</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="at">___ =</span> ___)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co">#hint 2</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>?<span class="st">`</span><span class="at">%in%</span><span class="st">`</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co">#hint 3</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> <span class="fu">filter</span>(___ <span class="sc">&gt;=</span> ___)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="co">#hint 4</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>?between</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="co">#hint 5</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>?<span class="st">`</span><span class="at">!</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</section></section><section id="slicing-the-data-with-slice" class="level2" data-number="14.6"><h2 data-number="14.6" class="anchored" data-anchor-id="slicing-the-data-with-slice">
<span class="header-section-number">14.6</span> Slicing the data with <code>slice()</code>
</h2>
<p>Sometimes it is useful to extract rows by row number.</p>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">slice</span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>slice: removed 339 rows (99%), 5 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           40.3          18                 195        3250
2 Adelie  Torgersen           NA            NA                  NA          NA
3 Adelie  Torgersen           36.7          19.3               193        3450
4 Adelie  Torgersen           39.3          20.6               190        3650
5 Adelie  Torgersen           38.9          17.8               181        3625
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>You can use negative numbers to remove rows. Be careful using <code>slice()</code> as if the data change, different rows may be returned.</p>
</section><section id="distinct-rows-with-distinct" class="level2" data-number="14.7"><h2 data-number="14.7" class="anchored" data-anchor-id="distinct-rows-with-distinct">
<span class="header-section-number">14.7</span> Distinct rows with <code>distinct()</code>
</h2>
<p>If there are duplicates in the data, we can remove these with <code>distinct()</code>. <code>distinct()</code> with no extra arguments will remove duplicate rows.</p>
<div class="cell">
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">distinct</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>distinct: no rows removed</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           39.5          17.4               186        3800
3 Adelie  Torgersen           40.3          18                 195        3250
# ℹ 341 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>If we are only interested in some of the columns, we can supply the names of these columns.</p>
<div class="cell">
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">distinct</span><span class="op">(</span><span class="va">island</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>distinct: removed 341 rows (99%), 3 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 1
  island   
  &lt;fct&gt;    
1 Torgersen
2 Biscoe   
3 Dream    </code></pre>
</div>
</div>
<p>Other columns will be removed unless the argument <code>.keep_all = TRUE</code> is used.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>From the <code>penguins</code> data, find distinct values of</p>
<ul>
<li>species</li>
<li>species, island and sex</li>
</ul>
<details><summary>
Hint
</summary><div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> <span class="fu">distinct</span>(___, ___)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</section><section id="random-rows" class="level2" data-number="14.8"><h2 data-number="14.8" class="anchored" data-anchor-id="random-rows">
<span class="header-section-number">14.8</span> Random rows</h2>
<p>Sometimes you want to sample rows at random from a data.frame. This can be done with <code>slice_sample()</code>. This can either sample a constant <em>n</em> rows or constant fraction of the rows depending on whether the <code>n</code> or <code>prop</code> argument is used.</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>slice_sample: removed 334 rows (97%), 10 rows remaining</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 8
   species   island   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;     &lt;fct&gt;             &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Gentoo    Biscoe             45            15.4               220        5050
 2 Gentoo    Biscoe             51.3          14.2               218        5300
 3 Chinstrap Dream              45.6          19.4               194        3525
 4 Gentoo    Biscoe             53.4          15.8               219        5500
 5 Adelie    Biscoe             37.9          18.6               172        3150
 6 Adelie    Biscoe             41.6          18                 192        3950
 7 Chinstrap Dream              50.5          18.4               200        3400
 8 Gentoo    Biscoe             50            15.3               220        5550
 9 Gentoo    Biscoe             48.4          16.3               220        5400
10 Adelie    Torgers…           41.4          18.5               202        3875
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</section><section id="mutating-and-adding-columns-with-mutate" class="level2" data-number="14.9"><h2 data-number="14.9" class="anchored" data-anchor-id="mutating-and-adding-columns-with-mutate">
<span class="header-section-number">14.9</span> Mutating and adding columns with <code>mutate</code>
</h2>
<p>The function <code>mutate()</code> can add an new column or replace an existing one.</p>
<p>To make a new column called <code>body_mass_kg</code> we can use</p>
<div class="cell">
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>body_mass_kg <span class="op">=</span> <span class="va">body_mass_g</span> <span class="op">/</span> <span class="fl">1000</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>mutate: new variable 'body_mass_kg' (double) with 95 unique values and 1% NA</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 9
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Torgersen           39.1          18.7               181        3750
2 Adelie  Torgersen           39.5          17.4               186        3800
3 Adelie  Torgersen           40.3          18                 195        3250
# ℹ 341 more rows
# ℹ 3 more variables: sex &lt;fct&gt;, year &lt;int&gt;, body_mass_kg &lt;dbl&gt;</code></pre>
</div>
</div>
<p>There are lots of functions that are useful to use with mutate. Any function that returns either a single value or as many values as are in the data can be used.</p>
<p><code>mutate()</code> is very useful when cleaning data.</p>
<ul>
<li>See text manipulation tutorial for cleaning text with the <code>stringr</code> package.</li>
<li>See date and time tutorial for cleaning dates and times with the <code>lubridate</code> package.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>With the <code>penguins</code> data,</p>
<ul>
<li>convert flipper length to cm</li>
<li>add a column with the ratio of bill width to length</li>
</ul>
<details><summary>
Hint
</summary><div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hint 1</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">___ =</span> ___)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</section><section id="summarising-data-with-summarise" class="level2" data-number="14.10"><h2 data-number="14.10" class="anchored" data-anchor-id="summarising-data-with-summarise">
<span class="header-section-number">14.10</span> Summarising data with <code>summarise()</code>
</h2>
<p><code>summarise()</code> lets us summarise data. We can use it if we want to calculate a summary statistic of the data. Remember to separate arguments with a comma.</p>
<div class="cell">
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu">summarise</span><span class="op">(</span></span>
<span>  flipper_len_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>  flipper_len_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>summarise: now one row and 2 columns, ungrouped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  flipper_len_mean flipper_len_sd
             &lt;dbl&gt;          &lt;dbl&gt;
1             201.           14.1</code></pre>
</div>
</div>
<p>Only the columns created in the <code>summarise()</code> and any grouping columns (see below) will be kept.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>With the <code>penguins</code> data, find</p>
<ul>
<li>the maximum and minimum bill length</li>
</ul>
<details><summary>
Hint
</summary><div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">___ =</span> <span class="fu">___</span>(___))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
<section id="summarising-multiple-columns" class="level3" data-number="14.10.1"><h3 data-number="14.10.1" class="anchored" data-anchor-id="summarising-multiple-columns">
<span class="header-section-number">14.10.1</span> Summarising multiple columns</h3>
<p>Sometimes you want to summarise multiple columns at the same time. This can be done with the <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> helper function. <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> needs to be told which columns to process and what function or functions to use.</p>
<div class="cell">
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">summarise</span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `.fun()`.
ℹ In argument: `across(c(bill_length_mm, bill_depth_mm), .fns = mean, na.rm =
  TRUE)`.
Caused by warning:
! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
Supply arguments directly to `.fns` through an anonymous function instead.

  # Previously
  across(a:b, mean, na.rm = TRUE)

  # Now
  across(a:b, \(x) mean(x, na.rm = TRUE))</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>summarise: now one row and 2 columns, ungrouped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  bill_length_mm bill_depth_mm
           &lt;dbl&gt;         &lt;dbl&gt;
1           43.9          17.2</code></pre>
</div>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#using a list of functions</span></span>
<span><span class="va">penguins</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"bill"</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sd <span class="op">=</span> <span class="va">sd</span>, mean <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>summarise: now one row and 4 columns, ungrouped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  bill_length_mm_sd bill_length_mm_mean bill_depth_mm_sd bill_depth_mm_mean
              &lt;dbl&gt;               &lt;dbl&gt;            &lt;dbl&gt;              &lt;dbl&gt;
1              5.46                43.9             1.97               17.2</code></pre>
</div>
</div>
<p>You can also use <code><a href="https://dplyr.tidyverse.org/reference/across.html">across()</a></code> with <code>mutate()</code> to mutate several columns at the same time.</p>
</section></section><section id="grouping-data-with-group_by" class="level2" data-number="14.11"><h2 data-number="14.11" class="anchored" data-anchor-id="grouping-data-with-group_by">
<span class="header-section-number">14.11</span> Grouping data with <code>group_by</code>
</h2>
<p><code>group_by()</code> changes the way that many of the <code>dplyr</code> functions work. Instead of working on the entire dataset, they now work on each group in the data</p>
<p>To find the mean flipper length for each species, we need to <code>group_by()</code> species and then <code>summarise()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>mean_flipper_length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">flipper_length_mm</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: one grouping variable (species)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>summarise: now 3 rows and 2 columns, ungrouped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  species   mean_flipper_length
  &lt;fct&gt;                   &lt;dbl&gt;
1 Adelie                    NA 
2 Chinstrap                196.
3 Gentoo                    NA </code></pre>
</div>
</div>
<p>Grouped data can be ungrouped with <code>ungroup()</code>. This can help prevent surprises!</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>With the <code>penguins</code> data, find</p>
<ul>
<li>the maximum and minimum bill depth of each species</li>
</ul>
<details><summary>
Hint
</summary><div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(___)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">___ =</span>  <span class="fu">___</span>(___))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</section><section id="sorting-with-arrange" class="level2" data-number="14.12"><h2 data-number="14.12" class="anchored" data-anchor-id="sorting-with-arrange">
<span class="header-section-number">14.12</span> Sorting with <code>arrange()</code>
</h2>
<p>To sort the data frame by one or more of the variables we can use <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, <span class="va">bill_depth_mm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
  species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Adelie  Dream               32.1          15.5               188        3050
2 Adelie  Dream               33.1          16.1               178        2900
3 Adelie  Torgersen           33.5          19                 190        3600
# ℹ 341 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<p>This will sort smallest first. To reverse the sort order, use <code><a href="https://dplyr.tidyverse.org/reference/desc.html">desc()</a></code></p>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">bill_length_mm</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">bill_depth_mm</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 344 × 8
  species   island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
  &lt;fct&gt;     &lt;fct&gt;           &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
1 Gentoo    Biscoe           59.6          17                 230        6050
2 Chinstrap Dream            58            17.8               181        3700
3 Gentoo    Biscoe           55.9          17                 228        5600
# ℹ 341 more rows
# ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sort the <code>penguins</code> data by</p>
<ul>
<li>body mass</li>
<li>island and body mass, with the largest birds first</li>
</ul>
<details><summary>
Hint
</summary><div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hint 1</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(___, ___)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co"># hint 2</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>?desc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</section><section id="counting-rows-with-count-and-n" class="level2" data-number="14.13"><h2 data-number="14.13" class="anchored" data-anchor-id="counting-rows-with-count-and-n">
<span class="header-section-number">14.13</span> Counting rows with <code>count()</code> and <code>n()</code>
</h2>
<p>The function <code>n</code> can count how many rows there are in the each group (or the entire data frame if it is not grouped). It can be used with either <code>mutate()</code> or <code>summarise()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>group_by: one grouping variable (species)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>summarise: now 3 rows and 2 columns, ungrouped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  species       n
  &lt;fct&gt;     &lt;int&gt;
1 Adelie      152
2 Chinstrap    68
3 Gentoo      124</code></pre>
</div>
</div>
<p>Or with <code>count()</code></p>
<div class="cell">
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">species</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>count: now 3 rows and 2 columns, ungrouped</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  species       n
  &lt;fct&gt;     &lt;int&gt;
1 Adelie      152
2 Chinstrap    68
3 Gentoo      124</code></pre>
</div>
</div>
<p><code>count()</code> is more concise, but <code>group_by()</code> and <code>summarise()</code> is useful when you need to calculate more variables (for example mean and standard deviation).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>From the <code>penguins</code> data, find</p>
<ul>
<li>how many penguins are there of each species</li>
<li>how many penguins are there of each species in each island</li>
</ul>
<details><summary>
Hint
</summary><div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(___, ___)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(___) <span class="sc">|&gt;</span> </span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">___ =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</section><section id="common-problems" class="level2 page-columns page-full" data-number="14.14"><h2 data-number="14.14" class="anchored" data-anchor-id="common-problems">
<span class="header-section-number">14.14</span> Common problems</h2>
<section id="non-standard-names" class="level3" data-number="14.14.1"><h3 data-number="14.14.1" class="anchored" data-anchor-id="non-standard-names">
<span class="header-section-number">14.14.1</span> Non standard names</h3>
<p>Ideally column names should follow the standard rules for naming objects in R - UPPER and lower case letters, numbers, “.” and “_” with the first character being a letter (or a dot if you want an invisible object). Sometimes when you import data, it has non-standard names with spaces or extra characters. If you need to refer to a column name that doesn’t follow the rules, you need to enclose it with back-ticks.</p>
<div class="cell">
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>`Region/Country` <span class="op">=</span> <span class="st">"Norway"</span>, value <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">df</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  `Region/Country` value
  &lt;chr&gt;            &lt;dbl&gt;
1 Norway              42</code></pre>
</div>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">|&gt;</span> <span class="fu">rename</span><span class="op">(</span>region_country <span class="op">=</span> <span class="va">`Region/Country`</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>rename: renamed one variable (region_country)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  region_country value
  &lt;chr&gt;          &lt;dbl&gt;
1 Norway            42</code></pre>
</div>
</div>
<p>It is sometimes best to rename these columns to make them easier to refer to. <code><a href="https://sfirke.github.io/janitor/reference/clean_names.html">janitor::clean_names()</a></code> is very efficient for making easy-to-use names.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Further reading
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://stat545.com/dplyr-intro.html">stat545</a></li>
<li><a href="https://r4ds.hadley.nz/">R for data science</a></li>
<li><a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf"><code>dplyr</code> cheatsheet</a></li>
</ul>
</div>
</div>
</section>

<!-- -->

<div class="no-row-height column-margin column-container"><section id="contributors" class="level3 unlisted unnumbered"><h3 class="unlisted unnumbered anchored" data-anchor-id="contributors">Contributors</h3>
<ul>
<li>Richard Telford</li>
</ul></section></div></section></main><!-- /main --><script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        console.log("RESIZE");
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./011-tidyr-pivot.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Tidying data with <code>tidyr</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./013-dplyr-multiple-tables.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Working with multiple tables in <code>dplyr</code></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb116" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="in">source("R/setup.R")</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># Working with single tables in `dplyr` {#sec-working-with-single-tables-in-dplyr}</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>Data frames are usually the most convenient objects for storing, plotting or analysing data in R.</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>We also need to be able to manipulate data in data frames.</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>This tutorial will show you how to manipulate data frames using the <span class="in">`dplyr`</span> package, part of <span class="in">`tidyverse`</span>.</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>Everything that can be done with <span class="in">`dplyr`</span> can be done with base R.</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>The <span class="in">`dplyr`</span> solution is usually easier to write and understand, and can be faster.</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>There are many function in <span class="in">`dplyr`</span>, this tutorial focuses on the functions I find most useful.</span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load the package</span></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a>You can load <span class="in">`dplyr`</span> with</span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-dplyr}</span></span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a><span class="in">library("dplyr")</span></span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a>But is is usually more convenient to load <span class="in">`tidyverse`</span> so that you get <span class="in">`ggplot2`</span>, <span class="in">`dplyr`</span>, <span class="in">`readr`</span> and other useful packages with one command.</span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load-packages, eval = FALSE}</span></span>
<span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a><span class="in">library("tidyverse")</span></span>
<span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-31"><a href="#cb116-31" aria-hidden="true" tabindex="-1"></a><span class="fu">### More feedback `tidylog`</span></span>
<span id="cb116-32"><a href="#cb116-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-33"><a href="#cb116-33" aria-hidden="true" tabindex="-1"></a>We can get more feedback on what <span class="in">`dplyr`</span> functions have done to the data by loading the <span class="in">`tidylog`</span> package.</span>
<span id="cb116-34"><a href="#cb116-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-35"><a href="#cb116-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tidylog, echo = TRUE, message = FALSE}</span></span>
<span id="cb116-36"><a href="#cb116-36" aria-hidden="true" tabindex="-1"></a><span class="in">library("tidylog")</span></span>
<span id="cb116-37"><a href="#cb116-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-38"><a href="#cb116-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-39"><a href="#cb116-39" aria-hidden="true" tabindex="-1"></a>More than once, <span class="in">`tidylog`</span> has helped identified bugs in my code.</span>
<span id="cb116-40"><a href="#cb116-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-41"><a href="#cb116-41" aria-hidden="true" tabindex="-1"></a><span class="fu">## The `penguins` dataset</span></span>
<span id="cb116-42"><a href="#cb116-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-43"><a href="#cb116-43" aria-hidden="true" tabindex="-1"></a>This tutorial will use the <span class="in">`penguins`</span> dataset from the <span class="co">[</span><span class="ot">`palmerpenguins` package</span><span class="co">](https://github.com/allisonhorst/palmerpenguins)</span>.</span>
<span id="cb116-44"><a href="#cb116-44" aria-hidden="true" tabindex="-1"></a>This dataset includes measurements of three species of penguin.</span>
<span id="cb116-45"><a href="#cb116-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-46"><a href="#cb116-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r penguins}</span></span>
<span id="cb116-47"><a href="#cb116-47" aria-hidden="true" tabindex="-1"></a><span class="in"># Load the data</span></span>
<span id="cb116-48"><a href="#cb116-48" aria-hidden="true" tabindex="-1"></a><span class="in">data("penguins", package = "palmerpenguins")</span></span>
<span id="cb116-49"><a href="#cb116-49" aria-hidden="true" tabindex="-1"></a><span class="in"># Show the data</span></span>
<span id="cb116-50"><a href="#cb116-50" aria-hidden="true" tabindex="-1"></a><span class="in">penguins</span></span>
<span id="cb116-51"><a href="#cb116-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-52"><a href="#cb116-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-53"><a href="#cb116-53" aria-hidden="true" tabindex="-1"></a><span class="fu">## Selecting columns with `select()`</span></span>
<span id="cb116-54"><a href="#cb116-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-55"><a href="#cb116-55" aria-hidden="true" tabindex="-1"></a>You can choose which columns of the data frame you want with <span class="in">`select()`</span>.</span>
<span id="cb116-56"><a href="#cb116-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-57"><a href="#cb116-57" aria-hidden="true" tabindex="-1"></a>The first argument is the data, which is supplied by the pipe <span class="in">`|&gt;`</span>, the next arguments are the names of the columns you want.</span>
<span id="cb116-58"><a href="#cb116-58" aria-hidden="true" tabindex="-1"></a>The names do not need quote marks.</span>
<span id="cb116-59"><a href="#cb116-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-60"><a href="#cb116-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{r select1}</span></span>
<span id="cb116-61"><a href="#cb116-61" aria-hidden="true" tabindex="-1"></a><span class="in">#select species, bill_length_mm &amp; bill_depth_mm</span></span>
<span id="cb116-62"><a href="#cb116-62" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-63"><a href="#cb116-63" aria-hidden="true" tabindex="-1"></a><span class="in">  select(species, bill_length_mm, bill_depth_mm)</span></span>
<span id="cb116-64"><a href="#cb116-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-65"><a href="#cb116-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-66"><a href="#cb116-66" aria-hidden="true" tabindex="-1"></a>This is equivalent to the base R code</span>
<span id="cb116-67"><a href="#cb116-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-68"><a href="#cb116-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r select1.5}</span></span>
<span id="cb116-69"><a href="#cb116-69" aria-hidden="true" tabindex="-1"></a><span class="in">#select species, bill_length_mm &amp; bill_depth_mm</span></span>
<span id="cb116-70"><a href="#cb116-70" aria-hidden="true" tabindex="-1"></a><span class="in">penguins[, c("species", "bill_length_mm", "bill_depth_mm")] </span></span>
<span id="cb116-71"><a href="#cb116-71" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-72"><a href="#cb116-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-73"><a href="#cb116-73" aria-hidden="true" tabindex="-1"></a>Remember that if you want to use the output of this code in a further analysis, you need to assign it to an object name with <span class="in">`&lt;-`</span>.</span>
<span id="cb116-74"><a href="#cb116-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-75"><a href="#cb116-75" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb116-76"><a href="#cb116-76" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb116-77"><a href="#cb116-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-78"><a href="#cb116-78" aria-hidden="true" tabindex="-1"></a>From the <span class="in">`penguins`</span> data, select</span>
<span id="cb116-79"><a href="#cb116-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-80"><a href="#cb116-80" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`species`</span></span>
<span id="cb116-81"><a href="#cb116-81" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`species`</span> and <span class="in">`bill_length_mm`</span></span>
<span id="cb116-82"><a href="#cb116-82" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>all columns except year</span>
<span id="cb116-83"><a href="#cb116-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-84"><a href="#cb116-84" aria-hidden="true" tabindex="-1"></a>&lt;details&gt;</span>
<span id="cb116-85"><a href="#cb116-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-86"><a href="#cb116-86" aria-hidden="true" tabindex="-1"></a>&lt;summary&gt;Hint&lt;/summary&gt;</span>
<span id="cb116-87"><a href="#cb116-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-88"><a href="#cb116-88" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb116-89"><a href="#cb116-89" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-90"><a href="#cb116-90" aria-hidden="true" tabindex="-1"></a><span class="in">  select(___, ___)</span></span>
<span id="cb116-91"><a href="#cb116-91" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-92"><a href="#cb116-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-93"><a href="#cb116-93" aria-hidden="true" tabindex="-1"></a>&lt;/details&gt;</span>
<span id="cb116-94"><a href="#cb116-94" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb116-95"><a href="#cb116-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-96"><a href="#cb116-96" aria-hidden="true" tabindex="-1"></a><span class="fu">### `select()` helpers {#sec-select-helpers}</span></span>
<span id="cb116-97"><a href="#cb116-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-98"><a href="#cb116-98" aria-hidden="true" tabindex="-1"></a>Sometimes we don't want to write out the names of all the columns we want to select.</span>
<span id="cb116-99"><a href="#cb116-99" aria-hidden="true" tabindex="-1"></a>We might not even know them all in advance.</span>
<span id="cb116-100"><a href="#cb116-100" aria-hidden="true" tabindex="-1"></a>Fortunately there are some helper functions.</span>
<span id="cb116-101"><a href="#cb116-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-102"><a href="#cb116-102" aria-hidden="true" tabindex="-1"></a>If you want to <span class="in">`select()`</span> adjacent columns, you can use the notation <span class="in">`first:last`</span>.</span>
<span id="cb116-103"><a href="#cb116-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-104"><a href="#cb116-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r select2}</span></span>
<span id="cb116-105"><a href="#cb116-105" aria-hidden="true" tabindex="-1"></a><span class="in">#select species to bill_depth_mm</span></span>
<span id="cb116-106"><a href="#cb116-106" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; select(species:bill_depth_mm)</span></span>
<span id="cb116-107"><a href="#cb116-107" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-108"><a href="#cb116-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-109"><a href="#cb116-109" aria-hidden="true" tabindex="-1"></a>Sometimes it is easier to remove the columns you don't want.</span>
<span id="cb116-110"><a href="#cb116-110" aria-hidden="true" tabindex="-1"></a>You can do this by putting a <span class="in">`-`</span> in front of the column name.</span>
<span id="cb116-111"><a href="#cb116-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-112"><a href="#cb116-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r select3}</span></span>
<span id="cb116-113"><a href="#cb116-113" aria-hidden="true" tabindex="-1"></a><span class="in">#select everything but year and sex</span></span>
<span id="cb116-114"><a href="#cb116-114" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; select(-year, -sex)</span></span>
<span id="cb116-115"><a href="#cb116-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-116"><a href="#cb116-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-117"><a href="#cb116-117" aria-hidden="true" tabindex="-1"></a>If there is a pattern to the column names that we want to select (or remove), there are some helper functions.</span>
<span id="cb116-118"><a href="#cb116-118" aria-hidden="true" tabindex="-1"></a>For example, to select columns that start with "bill", we can use <span class="in">`starts_with()`</span>.</span>
<span id="cb116-119"><a href="#cb116-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-120"><a href="#cb116-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r select4}</span></span>
<span id="cb116-121"><a href="#cb116-121" aria-hidden="true" tabindex="-1"></a><span class="in">#select bill_length_mm &amp; bill_depth_mm" </span></span>
<span id="cb116-122"><a href="#cb116-122" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; select(starts_with("bill"))</span></span>
<span id="cb116-123"><a href="#cb116-123" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-124"><a href="#cb116-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-125"><a href="#cb116-125" aria-hidden="true" tabindex="-1"></a>Conversely, if we want to select all columns that end with "mm", we can use <span class="in">`ends_with()`</span>.</span>
<span id="cb116-126"><a href="#cb116-126" aria-hidden="true" tabindex="-1"></a><span class="in">`contains()`</span> is more flexible and <span class="in">`matches()`</span> is the most powerful of the helper functions, using regular expressions to identify the columns (see the regular expression tutorial).</span>
<span id="cb116-127"><a href="#cb116-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-128"><a href="#cb116-128" aria-hidden="true" tabindex="-1"></a>Sometimes, you might want to select all the columns of a certain type.</span>
<span id="cb116-129"><a href="#cb116-129" aria-hidden="true" tabindex="-1"></a>For example, to select all the numeric columns we can use the <span class="in">`is.numeric`</span> function inside <span class="in">`select()`</span> with the helper <span class="in">`where()`</span>.</span>
<span id="cb116-130"><a href="#cb116-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-131"><a href="#cb116-131" aria-hidden="true" tabindex="-1"></a><span class="in">```{r select5}</span></span>
<span id="cb116-132"><a href="#cb116-132" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; select(where(is.numeric)) # No brackets on the function</span></span>
<span id="cb116-133"><a href="#cb116-133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-134"><a href="#cb116-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-135"><a href="#cb116-135" aria-hidden="true" tabindex="-1"></a>Other <span class="in">`is.*`</span> functions exist, for example, <span class="in">`is.character`</span> for text.</span>
<span id="cb116-136"><a href="#cb116-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-137"><a href="#cb116-137" aria-hidden="true" tabindex="-1"></a>You can also select columns by number (1 being the first column), but this is generally a bad idea because it makes the code difficult to understand and if a new column is added, or the column order is changed, the code will break.</span>
<span id="cb116-138"><a href="#cb116-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-139"><a href="#cb116-139" aria-hidden="true" tabindex="-1"></a>Which of these strategies works best is context dependent.</span>
<span id="cb116-140"><a href="#cb116-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-141"><a href="#cb116-141" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb116-142"><a href="#cb116-142" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb116-143"><a href="#cb116-143" aria-hidden="true" tabindex="-1"></a>From the <span class="in">`penguins`</span> data, select</span>
<span id="cb116-144"><a href="#cb116-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-145"><a href="#cb116-145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>all columns except year</span>
<span id="cb116-146"><a href="#cb116-146" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>all non-numeric columns</span>
<span id="cb116-147"><a href="#cb116-147" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`species`</span> and columns ending in "mm"</span>
<span id="cb116-148"><a href="#cb116-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-149"><a href="#cb116-149" aria-hidden="true" tabindex="-1"></a>&lt;details&gt;</span>
<span id="cb116-150"><a href="#cb116-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-151"><a href="#cb116-151" aria-hidden="true" tabindex="-1"></a>&lt;summary&gt;Hint&lt;/summary&gt;</span>
<span id="cb116-152"><a href="#cb116-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-153"><a href="#cb116-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb116-154"><a href="#cb116-154" aria-hidden="true" tabindex="-1"></a><span class="in"># hint 1</span></span>
<span id="cb116-155"><a href="#cb116-155" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-156"><a href="#cb116-156" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-___)</span></span>
<span id="cb116-157"><a href="#cb116-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-158"><a href="#cb116-158" aria-hidden="true" tabindex="-1"></a><span class="in"># hint 2</span></span>
<span id="cb116-159"><a href="#cb116-159" aria-hidden="true" tabindex="-1"></a><span class="in">?where</span></span>
<span id="cb116-160"><a href="#cb116-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-161"><a href="#cb116-161" aria-hidden="true" tabindex="-1"></a><span class="in"># hint 3</span></span>
<span id="cb116-162"><a href="#cb116-162" aria-hidden="true" tabindex="-1"></a><span class="in">?ends_with</span></span>
<span id="cb116-163"><a href="#cb116-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-164"><a href="#cb116-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-165"><a href="#cb116-165" aria-hidden="true" tabindex="-1"></a>&lt;/details&gt;</span>
<span id="cb116-166"><a href="#cb116-166" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb116-167"><a href="#cb116-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-168"><a href="#cb116-168" aria-hidden="true" tabindex="-1"></a><span class="fu">## Renaming columns with `rename`</span></span>
<span id="cb116-169"><a href="#cb116-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-170"><a href="#cb116-170" aria-hidden="true" tabindex="-1"></a>You can use <span class="in">`rename()`</span> to rename columns</span>
<span id="cb116-171"><a href="#cb116-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-172"><a href="#cb116-172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rename1}</span></span>
<span id="cb116-173"><a href="#cb116-173" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; rename(Species = species)</span></span>
<span id="cb116-174"><a href="#cb116-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-175"><a href="#cb116-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-176"><a href="#cb116-176" aria-hidden="true" tabindex="-1"></a>The syntax is <span class="in">`new_name = current_name`</span>.</span>
<span id="cb116-177"><a href="#cb116-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-178"><a href="#cb116-178" aria-hidden="true" tabindex="-1"></a>You can also rename a column when selecting.</span>
<span id="cb116-179"><a href="#cb116-179" aria-hidden="true" tabindex="-1"></a>This is convenient if you are using <span class="in">`select()`</span> anyway.</span>
<span id="cb116-180"><a href="#cb116-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-181"><a href="#cb116-181" aria-hidden="true" tabindex="-1"></a><span class="in">```{r rename2}</span></span>
<span id="cb116-182"><a href="#cb116-182" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; select(Species = species)</span></span>
<span id="cb116-183"><a href="#cb116-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-184"><a href="#cb116-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-185"><a href="#cb116-185" aria-hidden="true" tabindex="-1"></a><span class="fu">## Moving columns with `relocate()`</span></span>
<span id="cb116-186"><a href="#cb116-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-187"><a href="#cb116-187" aria-hidden="true" tabindex="-1"></a>Sometimes it is useful to reorder the columns.</span>
<span id="cb116-188"><a href="#cb116-188" aria-hidden="true" tabindex="-1"></a>This is never necessary for data analysis or plotting, but can be needed when making a table for presentation.</span>
<span id="cb116-189"><a href="#cb116-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-190"><a href="#cb116-190" aria-hidden="true" tabindex="-1"></a><span class="in">```{r relocate}</span></span>
<span id="cb116-191"><a href="#cb116-191" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; relocate(island)</span></span>
<span id="cb116-192"><a href="#cb116-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-193"><a href="#cb116-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-194"><a href="#cb116-194" aria-hidden="true" tabindex="-1"></a>The default is to move the named column first, the <span class="in">`.before`</span> and <span class="in">`.after`</span> arguments let you move the column into any position.</span>
<span id="cb116-195"><a href="#cb116-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-196"><a href="#cb116-196" aria-hidden="true" tabindex="-1"></a><span class="fu">## Filtering rows with `filter()`</span></span>
<span id="cb116-197"><a href="#cb116-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-198"><a href="#cb116-198" aria-hidden="true" tabindex="-1"></a>Filtering rows that meet some condition is a very common task.</span>
<span id="cb116-199"><a href="#cb116-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-200"><a href="#cb116-200" aria-hidden="true" tabindex="-1"></a>For example, to filter rows of <span class="in">`penguins`</span> that have a bill length greater than 40 mm, we can use</span>
<span id="cb116-201"><a href="#cb116-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-202"><a href="#cb116-202" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter1}</span></span>
<span id="cb116-203"><a href="#cb116-203" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; filter(bill_length_mm &gt; 40)</span></span>
<span id="cb116-204"><a href="#cb116-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-205"><a href="#cb116-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-206"><a href="#cb116-206" aria-hidden="true" tabindex="-1"></a>This will filter out each row where the condition is <span class="in">`TRUE`</span>.</span>
<span id="cb116-207"><a href="#cb116-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-208"><a href="#cb116-208" aria-hidden="true" tabindex="-1"></a>The base R equivalent of this is</span>
<span id="cb116-209"><a href="#cb116-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-210"><a href="#cb116-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter_base}</span></span>
<span id="cb116-211"><a href="#cb116-211" aria-hidden="true" tabindex="-1"></a><span class="in">penguins[penguins$bill_length_mm &gt; 40, ]</span></span>
<span id="cb116-212"><a href="#cb116-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-213"><a href="#cb116-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-214"><a href="#cb116-214" aria-hidden="true" tabindex="-1"></a>Generally, <span class="in">`filter`</span> makes it easier to understand, especially with more complex criteria.</span>
<span id="cb116-215"><a href="#cb116-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-216"><a href="#cb116-216" aria-hidden="true" tabindex="-1"></a>Other tests include</span>
<span id="cb116-217"><a href="#cb116-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-218"><a href="#cb116-218" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`==`</span> exactly equals. Often a bad idea to use with numeric data</span>
<span id="cb116-219"><a href="#cb116-219" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`near`</span> safe function for testing equality of numeric data as it has a tolerance for rounding errors.</span>
<span id="cb116-220"><a href="#cb116-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-221"><a href="#cb116-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter-near}</span></span>
<span id="cb116-222"><a href="#cb116-222" aria-hidden="true" tabindex="-1"></a><span class="in">sqrt(2) ^ 2 == 2 # should be true, but rounding errors </span></span>
<span id="cb116-223"><a href="#cb116-223" aria-hidden="true" tabindex="-1"></a><span class="in">sqrt(2) ^ 2 - 2 # the difference</span></span>
<span id="cb116-224"><a href="#cb116-224" aria-hidden="true" tabindex="-1"></a><span class="in">near(sqrt(2) ^ 2, 2) # safe alternative</span></span>
<span id="cb116-225"><a href="#cb116-225" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-226"><a href="#cb116-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-227"><a href="#cb116-227" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`!=`</span> not equal to</span>
<span id="cb116-228"><a href="#cb116-228" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`&lt;`</span> less than</span>
<span id="cb116-229"><a href="#cb116-229" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`&lt;=`</span> less than or equal to</span>
<span id="cb116-230"><a href="#cb116-230" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`&gt;`</span> greater than</span>
<span id="cb116-231"><a href="#cb116-231" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`&gt;=`</span> greater than or equal to</span>
<span id="cb116-232"><a href="#cb116-232" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`is.na()`</span> for filtering by missing values.</span>
<span id="cb116-233"><a href="#cb116-233" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`between()`</span> for filtering values with a range</span>
<span id="cb116-234"><a href="#cb116-234" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`%in%`</span> is used when you want to test if a value is in a vector</span>
<span id="cb116-235"><a href="#cb116-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-236"><a href="#cb116-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter-in}</span></span>
<span id="cb116-237"><a href="#cb116-237" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-238"><a href="#cb116-238" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(species %in% c("Adelie", "Chinstrap"))</span></span>
<span id="cb116-239"><a href="#cb116-239" aria-hidden="true" tabindex="-1"></a><span class="in">#equivalent to </span></span>
<span id="cb116-240"><a href="#cb116-240" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-241"><a href="#cb116-241" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(species == "Adelie" | species == "Chinstrap") # with many alternatives, this gets long</span></span>
<span id="cb116-242"><a href="#cb116-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-243"><a href="#cb116-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-244"><a href="#cb116-244" aria-hidden="true" tabindex="-1"></a><span class="fu">### Filtering on multiple criteria</span></span>
<span id="cb116-245"><a href="#cb116-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-246"><a href="#cb116-246" aria-hidden="true" tabindex="-1"></a>If we want to filter on multiple criteria, we need to decide whether we want all criteria to be <span class="in">`TRUE`</span> (AND in Boolean logic), or for one or more to be <span class="in">`TRUE`</span> (OR in Boolean logic).</span>
<span id="cb116-247"><a href="#cb116-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-248"><a href="#cb116-248" aria-hidden="true" tabindex="-1"></a>If we want all criteria to be <span class="in">`TRUE`</span>, we can separate them by a comma (or by an <span class="in">`&amp;`</span> if you want to be explicit).</span>
<span id="cb116-249"><a href="#cb116-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-250"><a href="#cb116-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter-AND}</span></span>
<span id="cb116-251"><a href="#cb116-251" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-252"><a href="#cb116-252" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(bill_length_mm &gt; 40, bill_depth_mm &gt; 18)</span></span>
<span id="cb116-253"><a href="#cb116-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-254"><a href="#cb116-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-255"><a href="#cb116-255" aria-hidden="true" tabindex="-1"></a>If we want rows where any of the criteria is <span class="in">`TRUE`</span>, we can separate them by a <span class="in">`|`</span>.</span>
<span id="cb116-256"><a href="#cb116-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-257"><a href="#cb116-257" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter-OR}</span></span>
<span id="cb116-258"><a href="#cb116-258" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-259"><a href="#cb116-259" aria-hidden="true" tabindex="-1"></a><span class="in">  filter(bill_length_mm &gt; 40 | bill_depth_mm &gt; 18)</span></span>
<span id="cb116-260"><a href="#cb116-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-261"><a href="#cb116-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-262"><a href="#cb116-262" aria-hidden="true" tabindex="-1"></a>We can negate a criterion by putting <span class="in">`!`</span> in front of it.</span>
<span id="cb116-263"><a href="#cb116-263" aria-hidden="true" tabindex="-1"></a>So to filter rows that do not have bills longer than 40 mm we can use</span>
<span id="cb116-264"><a href="#cb116-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-265"><a href="#cb116-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter-NOT}</span></span>
<span id="cb116-266"><a href="#cb116-266" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; filter(!bill_length_mm &gt; 40)</span></span>
<span id="cb116-267"><a href="#cb116-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-268"><a href="#cb116-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-269"><a href="#cb116-269" aria-hidden="true" tabindex="-1"></a>Of course, in this example, we could also use <span class="in">`&lt;=`</span> as the test.</span>
<span id="cb116-270"><a href="#cb116-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-271"><a href="#cb116-271" aria-hidden="true" tabindex="-1"></a><span class="fu">### Common errors</span></span>
<span id="cb116-272"><a href="#cb116-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-273"><a href="#cb116-273" aria-hidden="true" tabindex="-1"></a>The commonest error is to use a single <span class="in">`=`</span> rather than <span class="in">`==`</span>.</span>
<span id="cb116-274"><a href="#cb116-274" aria-hidden="true" tabindex="-1"></a>Only the latter is a test of equality.</span>
<span id="cb116-275"><a href="#cb116-275" aria-hidden="true" tabindex="-1"></a>If you do this, the error message is quite helpful.</span>
<span id="cb116-276"><a href="#cb116-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-277"><a href="#cb116-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter-error, error=TRUE}</span></span>
<span id="cb116-278"><a href="#cb116-278" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; filter(species = "Chinstrap")</span></span>
<span id="cb116-279"><a href="#cb116-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-280"><a href="#cb116-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-281"><a href="#cb116-281" aria-hidden="true" tabindex="-1"></a>Another common error is to forget to quote any strings.</span>
<span id="cb116-282"><a href="#cb116-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-283"><a href="#cb116-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r filter-error2, error=TRUE}</span></span>
<span id="cb116-284"><a href="#cb116-284" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; filter(species == Chinstrap)</span></span>
<span id="cb116-285"><a href="#cb116-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-286"><a href="#cb116-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-287"><a href="#cb116-287" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb116-288"><a href="#cb116-288" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb116-289"><a href="#cb116-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-290"><a href="#cb116-290" aria-hidden="true" tabindex="-1"></a>From the <span class="in">`penguins`</span> data, filter</span>
<span id="cb116-291"><a href="#cb116-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-292"><a href="#cb116-292" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Gentoo penguins</span>
<span id="cb116-293"><a href="#cb116-293" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Gentoo or Adelie penguins</span>
<span id="cb116-294"><a href="#cb116-294" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>penguins with a mass greater than or equal to 5000g</span>
<span id="cb116-295"><a href="#cb116-295" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>penguins with a bill length between 45 and 50 mm</span>
<span id="cb116-296"><a href="#cb116-296" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Gentoo penguins not from from Dream Island</span>
<span id="cb116-297"><a href="#cb116-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-298"><a href="#cb116-298" aria-hidden="true" tabindex="-1"></a>&lt;details&gt;</span>
<span id="cb116-299"><a href="#cb116-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-300"><a href="#cb116-300" aria-hidden="true" tabindex="-1"></a>&lt;summary&gt;Hint&lt;/summary&gt;</span>
<span id="cb116-301"><a href="#cb116-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-302"><a href="#cb116-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb116-303"><a href="#cb116-303" aria-hidden="true" tabindex="-1"></a><span class="in">#hint 1</span></span>
<span id="cb116-304"><a href="#cb116-304" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; filter(___ = ___)</span></span>
<span id="cb116-305"><a href="#cb116-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-306"><a href="#cb116-306" aria-hidden="true" tabindex="-1"></a><span class="in">#hint 2</span></span>
<span id="cb116-307"><a href="#cb116-307" aria-hidden="true" tabindex="-1"></a><span class="in">?`%in%`</span></span>
<span id="cb116-308"><a href="#cb116-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-309"><a href="#cb116-309" aria-hidden="true" tabindex="-1"></a><span class="in">#hint 3</span></span>
<span id="cb116-310"><a href="#cb116-310" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; filter(___ &gt;= ___)</span></span>
<span id="cb116-311"><a href="#cb116-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-312"><a href="#cb116-312" aria-hidden="true" tabindex="-1"></a><span class="in">#hint 4</span></span>
<span id="cb116-313"><a href="#cb116-313" aria-hidden="true" tabindex="-1"></a><span class="in">?between</span></span>
<span id="cb116-314"><a href="#cb116-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-315"><a href="#cb116-315" aria-hidden="true" tabindex="-1"></a><span class="in">#hint 5</span></span>
<span id="cb116-316"><a href="#cb116-316" aria-hidden="true" tabindex="-1"></a><span class="in">?`!`</span></span>
<span id="cb116-317"><a href="#cb116-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-318"><a href="#cb116-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-319"><a href="#cb116-319" aria-hidden="true" tabindex="-1"></a>&lt;/details&gt;</span>
<span id="cb116-320"><a href="#cb116-320" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb116-321"><a href="#cb116-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-322"><a href="#cb116-322" aria-hidden="true" tabindex="-1"></a><span class="fu">## Slicing the data with `slice()`</span></span>
<span id="cb116-323"><a href="#cb116-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-324"><a href="#cb116-324" aria-hidden="true" tabindex="-1"></a>Sometimes it is useful to extract rows by row number.</span>
<span id="cb116-325"><a href="#cb116-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-326"><a href="#cb116-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r slice}</span></span>
<span id="cb116-327"><a href="#cb116-327" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; slice(3:7)</span></span>
<span id="cb116-328"><a href="#cb116-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-329"><a href="#cb116-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-330"><a href="#cb116-330" aria-hidden="true" tabindex="-1"></a>You can use negative numbers to remove rows.</span>
<span id="cb116-331"><a href="#cb116-331" aria-hidden="true" tabindex="-1"></a>Be careful using <span class="in">`slice()`</span> as if the data change, different rows may be returned.</span>
<span id="cb116-332"><a href="#cb116-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-333"><a href="#cb116-333" aria-hidden="true" tabindex="-1"></a><span class="fu">## Distinct rows with `distinct()`</span></span>
<span id="cb116-334"><a href="#cb116-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-335"><a href="#cb116-335" aria-hidden="true" tabindex="-1"></a>If there are duplicates in the data, we can remove these with <span class="in">`distinct()`</span>.</span>
<span id="cb116-336"><a href="#cb116-336" aria-hidden="true" tabindex="-1"></a><span class="in">`distinct()`</span> with no extra arguments will remove duplicate rows.</span>
<span id="cb116-337"><a href="#cb116-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-340"><a href="#cb116-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb116-341"><a href="#cb116-341" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> <span class="fu">distinct</span>()</span>
<span id="cb116-342"><a href="#cb116-342" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-343"><a href="#cb116-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-344"><a href="#cb116-344" aria-hidden="true" tabindex="-1"></a>If we are only interested in some of the columns, we can supply the names of these columns.</span>
<span id="cb116-345"><a href="#cb116-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-348"><a href="#cb116-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb116-349"><a href="#cb116-349" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> <span class="fu">distinct</span>(island)</span>
<span id="cb116-350"><a href="#cb116-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-351"><a href="#cb116-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-352"><a href="#cb116-352" aria-hidden="true" tabindex="-1"></a>Other columns will be removed unless the argument <span class="in">`.keep_all = TRUE`</span> is used.</span>
<span id="cb116-353"><a href="#cb116-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-354"><a href="#cb116-354" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb116-355"><a href="#cb116-355" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise {.unnumbered .facta .toc-ignore}</span></span>
<span id="cb116-356"><a href="#cb116-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-357"><a href="#cb116-357" aria-hidden="true" tabindex="-1"></a>From the <span class="in">`penguins`</span> data, find distinct values of</span>
<span id="cb116-358"><a href="#cb116-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-359"><a href="#cb116-359" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>species</span>
<span id="cb116-360"><a href="#cb116-360" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>species, island and sex</span>
<span id="cb116-361"><a href="#cb116-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-362"><a href="#cb116-362" aria-hidden="true" tabindex="-1"></a>&lt;details&gt;</span>
<span id="cb116-363"><a href="#cb116-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-364"><a href="#cb116-364" aria-hidden="true" tabindex="-1"></a>&lt;summary&gt;Hint&lt;/summary&gt;</span>
<span id="cb116-365"><a href="#cb116-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-366"><a href="#cb116-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb116-367"><a href="#cb116-367" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; distinct(___, ___)</span></span>
<span id="cb116-368"><a href="#cb116-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-369"><a href="#cb116-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-370"><a href="#cb116-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-371"><a href="#cb116-371" aria-hidden="true" tabindex="-1"></a>&lt;/details&gt;</span>
<span id="cb116-372"><a href="#cb116-372" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb116-373"><a href="#cb116-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-374"><a href="#cb116-374" aria-hidden="true" tabindex="-1"></a><span class="fu">## Random rows</span></span>
<span id="cb116-375"><a href="#cb116-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-376"><a href="#cb116-376" aria-hidden="true" tabindex="-1"></a>Sometimes you want to sample rows at random from a data.frame.</span>
<span id="cb116-377"><a href="#cb116-377" aria-hidden="true" tabindex="-1"></a>This can be done with <span class="in">`slice_sample()`</span>.</span>
<span id="cb116-378"><a href="#cb116-378" aria-hidden="true" tabindex="-1"></a>This can either sample a constant *n* rows or constant fraction of the rows depending on whether the <span class="in">`n`</span> or <span class="in">`prop`</span> argument is used.</span>
<span id="cb116-379"><a href="#cb116-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-380"><a href="#cb116-380" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sample-n}</span></span>
<span id="cb116-381"><a href="#cb116-381" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; slice_sample(n = 10)</span></span>
<span id="cb116-382"><a href="#cb116-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-383"><a href="#cb116-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-384"><a href="#cb116-384" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mutating and adding columns with `mutate`</span></span>
<span id="cb116-385"><a href="#cb116-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-386"><a href="#cb116-386" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`mutate()`</span> can add an new column or replace an existing one.</span>
<span id="cb116-387"><a href="#cb116-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-388"><a href="#cb116-388" aria-hidden="true" tabindex="-1"></a>To make a new column called <span class="in">`body_mass_kg`</span> we can use</span>
<span id="cb116-389"><a href="#cb116-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-392"><a href="#cb116-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb116-393"><a href="#cb116-393" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> </span>
<span id="cb116-394"><a href="#cb116-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">body_mass_kg =</span> body_mass_g <span class="sc">/</span> <span class="dv">1000</span>)</span>
<span id="cb116-395"><a href="#cb116-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-396"><a href="#cb116-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-397"><a href="#cb116-397" aria-hidden="true" tabindex="-1"></a>There are lots of functions that are useful to use with mutate.</span>
<span id="cb116-398"><a href="#cb116-398" aria-hidden="true" tabindex="-1"></a>Any function that returns either a single value or as many values as are in the data can be used.</span>
<span id="cb116-399"><a href="#cb116-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-400"><a href="#cb116-400" aria-hidden="true" tabindex="-1"></a><span class="in">`mutate()`</span> is very useful when cleaning data.</span>
<span id="cb116-401"><a href="#cb116-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-402"><a href="#cb116-402" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>See text manipulation tutorial for cleaning text with the <span class="in">`stringr`</span> package.</span>
<span id="cb116-403"><a href="#cb116-403" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>See date and time tutorial for cleaning dates and times with the <span class="in">`lubridate`</span> package.</span>
<span id="cb116-404"><a href="#cb116-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-405"><a href="#cb116-405" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb116-406"><a href="#cb116-406" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise </span></span>
<span id="cb116-407"><a href="#cb116-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-408"><a href="#cb116-408" aria-hidden="true" tabindex="-1"></a>With the <span class="in">`penguins`</span> data,</span>
<span id="cb116-409"><a href="#cb116-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-410"><a href="#cb116-410" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>convert flipper length to cm</span>
<span id="cb116-411"><a href="#cb116-411" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>add a column with the ratio of bill width to length</span>
<span id="cb116-412"><a href="#cb116-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-413"><a href="#cb116-413" aria-hidden="true" tabindex="-1"></a>&lt;details&gt;</span>
<span id="cb116-414"><a href="#cb116-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-415"><a href="#cb116-415" aria-hidden="true" tabindex="-1"></a>&lt;summary&gt;Hint&lt;/summary&gt;</span>
<span id="cb116-416"><a href="#cb116-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-417"><a href="#cb116-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb116-418"><a href="#cb116-418" aria-hidden="true" tabindex="-1"></a><span class="in"># hint 1</span></span>
<span id="cb116-419"><a href="#cb116-419" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-420"><a href="#cb116-420" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(___ = ___)</span></span>
<span id="cb116-421"><a href="#cb116-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-422"><a href="#cb116-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-423"><a href="#cb116-423" aria-hidden="true" tabindex="-1"></a>&lt;/details&gt;</span>
<span id="cb116-424"><a href="#cb116-424" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb116-425"><a href="#cb116-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-426"><a href="#cb116-426" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summarising data with `summarise()`</span></span>
<span id="cb116-427"><a href="#cb116-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-428"><a href="#cb116-428" aria-hidden="true" tabindex="-1"></a><span class="in">`summarise()`</span> lets us summarise data.</span>
<span id="cb116-429"><a href="#cb116-429" aria-hidden="true" tabindex="-1"></a>We can use it if we want to calculate a summary statistic of the data.</span>
<span id="cb116-430"><a href="#cb116-430" aria-hidden="true" tabindex="-1"></a>Remember to separate arguments with a comma.</span>
<span id="cb116-431"><a href="#cb116-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-432"><a href="#cb116-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summarise1}</span></span>
<span id="cb116-433"><a href="#cb116-433" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; summarise(</span></span>
<span id="cb116-434"><a href="#cb116-434" aria-hidden="true" tabindex="-1"></a><span class="in">  flipper_len_mean = mean(flipper_length_mm, na.rm = TRUE), </span></span>
<span id="cb116-435"><a href="#cb116-435" aria-hidden="true" tabindex="-1"></a><span class="in">  flipper_len_sd = sd(flipper_length_mm, na.rm = TRUE)</span></span>
<span id="cb116-436"><a href="#cb116-436" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb116-437"><a href="#cb116-437" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-438"><a href="#cb116-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-439"><a href="#cb116-439" aria-hidden="true" tabindex="-1"></a>Only the columns created in the <span class="in">`summarise()`</span> and any grouping columns (see below) will be kept.</span>
<span id="cb116-440"><a href="#cb116-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-441"><a href="#cb116-441" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb116-442"><a href="#cb116-442" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb116-443"><a href="#cb116-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-444"><a href="#cb116-444" aria-hidden="true" tabindex="-1"></a>With the <span class="in">`penguins`</span> data, find</span>
<span id="cb116-445"><a href="#cb116-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-446"><a href="#cb116-446" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the maximum and minimum bill length</span>
<span id="cb116-447"><a href="#cb116-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-448"><a href="#cb116-448" aria-hidden="true" tabindex="-1"></a>&lt;details&gt;</span>
<span id="cb116-449"><a href="#cb116-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-450"><a href="#cb116-450" aria-hidden="true" tabindex="-1"></a>&lt;summary&gt;Hint&lt;/summary&gt;</span>
<span id="cb116-451"><a href="#cb116-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-452"><a href="#cb116-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb116-453"><a href="#cb116-453" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-454"><a href="#cb116-454" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(___ = ___(___))</span></span>
<span id="cb116-455"><a href="#cb116-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-456"><a href="#cb116-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-457"><a href="#cb116-457" aria-hidden="true" tabindex="-1"></a>&lt;/details&gt;</span>
<span id="cb116-458"><a href="#cb116-458" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb116-459"><a href="#cb116-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-460"><a href="#cb116-460" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summarising multiple columns</span></span>
<span id="cb116-461"><a href="#cb116-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-462"><a href="#cb116-462" aria-hidden="true" tabindex="-1"></a>Sometimes you want to summarise multiple columns at the same time.</span>
<span id="cb116-463"><a href="#cb116-463" aria-hidden="true" tabindex="-1"></a>This can be done with the <span class="in">`across()`</span> helper function.</span>
<span id="cb116-464"><a href="#cb116-464" aria-hidden="true" tabindex="-1"></a><span class="in">`across()`</span> needs to be told which columns to process and what function or functions to use.</span>
<span id="cb116-465"><a href="#cb116-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-466"><a href="#cb116-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r across}</span></span>
<span id="cb116-467"><a href="#cb116-467" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt;</span></span>
<span id="cb116-468"><a href="#cb116-468" aria-hidden="true" tabindex="-1"></a><span class="in">   summarise(across(c(bill_length_mm, bill_depth_mm), .fns = mean, na.rm = TRUE))</span></span>
<span id="cb116-469"><a href="#cb116-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-470"><a href="#cb116-470" aria-hidden="true" tabindex="-1"></a><span class="in">#using a list of functions</span></span>
<span id="cb116-471"><a href="#cb116-471" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt;</span></span>
<span id="cb116-472"><a href="#cb116-472" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(across(.cols = starts_with("bill"), .fns = list(sd = sd, mean = mean), na.rm = TRUE))</span></span>
<span id="cb116-473"><a href="#cb116-473" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-474"><a href="#cb116-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-475"><a href="#cb116-475" aria-hidden="true" tabindex="-1"></a>You can also use <span class="in">`across()`</span> with <span class="in">`mutate()`</span> to mutate several columns at the same time.</span>
<span id="cb116-476"><a href="#cb116-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-477"><a href="#cb116-477" aria-hidden="true" tabindex="-1"></a><span class="fu">## Grouping data with `group_by`</span></span>
<span id="cb116-478"><a href="#cb116-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-479"><a href="#cb116-479" aria-hidden="true" tabindex="-1"></a><span class="in">`group_by()`</span> changes the way that many of the <span class="in">`dplyr`</span> functions work.</span>
<span id="cb116-480"><a href="#cb116-480" aria-hidden="true" tabindex="-1"></a>Instead of working on the entire dataset, they now work on each group in the data</span>
<span id="cb116-481"><a href="#cb116-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-482"><a href="#cb116-482" aria-hidden="true" tabindex="-1"></a>To find the mean flipper length for each species, we need to <span class="in">`group_by()`</span> species and then <span class="in">`summarise()`</span>.</span>
<span id="cb116-483"><a href="#cb116-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-484"><a href="#cb116-484" aria-hidden="true" tabindex="-1"></a><span class="in">```{r group-by}</span></span>
<span id="cb116-485"><a href="#cb116-485" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-486"><a href="#cb116-486" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(species) |&gt; </span></span>
<span id="cb116-487"><a href="#cb116-487" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(mean_flipper_length = mean(flipper_length_mm))</span></span>
<span id="cb116-488"><a href="#cb116-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-489"><a href="#cb116-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-490"><a href="#cb116-490" aria-hidden="true" tabindex="-1"></a>Grouped data can be ungrouped with <span class="in">`ungroup()`</span>.</span>
<span id="cb116-491"><a href="#cb116-491" aria-hidden="true" tabindex="-1"></a>This can help prevent surprises!</span>
<span id="cb116-492"><a href="#cb116-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-493"><a href="#cb116-493" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb116-494"><a href="#cb116-494" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise </span></span>
<span id="cb116-495"><a href="#cb116-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-496"><a href="#cb116-496" aria-hidden="true" tabindex="-1"></a>With the <span class="in">`penguins`</span> data, find</span>
<span id="cb116-497"><a href="#cb116-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-498"><a href="#cb116-498" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>the maximum and minimum bill depth of each species</span>
<span id="cb116-499"><a href="#cb116-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-500"><a href="#cb116-500" aria-hidden="true" tabindex="-1"></a>&lt;details&gt;</span>
<span id="cb116-501"><a href="#cb116-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-502"><a href="#cb116-502" aria-hidden="true" tabindex="-1"></a>&lt;summary&gt;Hint&lt;/summary&gt;</span>
<span id="cb116-503"><a href="#cb116-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-504"><a href="#cb116-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb116-505"><a href="#cb116-505" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-506"><a href="#cb116-506" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(___)</span></span>
<span id="cb116-507"><a href="#cb116-507" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(___ =  ___(___))</span></span>
<span id="cb116-508"><a href="#cb116-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-509"><a href="#cb116-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-510"><a href="#cb116-510" aria-hidden="true" tabindex="-1"></a>&lt;/details&gt;</span>
<span id="cb116-511"><a href="#cb116-511" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb116-512"><a href="#cb116-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-513"><a href="#cb116-513" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sorting with `arrange()`</span></span>
<span id="cb116-514"><a href="#cb116-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-515"><a href="#cb116-515" aria-hidden="true" tabindex="-1"></a>To sort the data frame by one or more of the variables we can use <span class="in">`arrange()`</span>.</span>
<span id="cb116-516"><a href="#cb116-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-517"><a href="#cb116-517" aria-hidden="true" tabindex="-1"></a><span class="in">```{r arrange1}</span></span>
<span id="cb116-518"><a href="#cb116-518" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; arrange(bill_length_mm, bill_depth_mm)</span></span>
<span id="cb116-519"><a href="#cb116-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-520"><a href="#cb116-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-521"><a href="#cb116-521" aria-hidden="true" tabindex="-1"></a>This will sort smallest first.</span>
<span id="cb116-522"><a href="#cb116-522" aria-hidden="true" tabindex="-1"></a>To reverse the sort order, use <span class="in">`desc()`</span></span>
<span id="cb116-523"><a href="#cb116-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-524"><a href="#cb116-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r arrange2}</span></span>
<span id="cb116-525"><a href="#cb116-525" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; arrange(desc(bill_length_mm), desc(bill_depth_mm))</span></span>
<span id="cb116-526"><a href="#cb116-526" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-527"><a href="#cb116-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-528"><a href="#cb116-528" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb116-529"><a href="#cb116-529" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise</span></span>
<span id="cb116-530"><a href="#cb116-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-531"><a href="#cb116-531" aria-hidden="true" tabindex="-1"></a>Sort the <span class="in">`penguins`</span> data by</span>
<span id="cb116-532"><a href="#cb116-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-533"><a href="#cb116-533" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>body mass</span>
<span id="cb116-534"><a href="#cb116-534" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>island and body mass, with the largest birds first</span>
<span id="cb116-535"><a href="#cb116-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-536"><a href="#cb116-536" aria-hidden="true" tabindex="-1"></a>&lt;details&gt;</span>
<span id="cb116-537"><a href="#cb116-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-538"><a href="#cb116-538" aria-hidden="true" tabindex="-1"></a>&lt;summary&gt;Hint&lt;/summary&gt;</span>
<span id="cb116-539"><a href="#cb116-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-540"><a href="#cb116-540" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb116-541"><a href="#cb116-541" aria-hidden="true" tabindex="-1"></a><span class="in"># hint 1</span></span>
<span id="cb116-542"><a href="#cb116-542" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-543"><a href="#cb116-543" aria-hidden="true" tabindex="-1"></a><span class="in">  arrange(___, ___)</span></span>
<span id="cb116-544"><a href="#cb116-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-545"><a href="#cb116-545" aria-hidden="true" tabindex="-1"></a><span class="in"># hint 2</span></span>
<span id="cb116-546"><a href="#cb116-546" aria-hidden="true" tabindex="-1"></a><span class="in">?desc</span></span>
<span id="cb116-547"><a href="#cb116-547" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-548"><a href="#cb116-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-549"><a href="#cb116-549" aria-hidden="true" tabindex="-1"></a>&lt;/details&gt;</span>
<span id="cb116-550"><a href="#cb116-550" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb116-551"><a href="#cb116-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-552"><a href="#cb116-552" aria-hidden="true" tabindex="-1"></a><span class="fu">## Counting rows with `count()` and `n()`</span></span>
<span id="cb116-553"><a href="#cb116-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-554"><a href="#cb116-554" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`n`</span> can count how many rows there are in the each group (or the entire data frame if it is not grouped).</span>
<span id="cb116-555"><a href="#cb116-555" aria-hidden="true" tabindex="-1"></a>It can be used with either <span class="in">`mutate()`</span> or <span class="in">`summarise()`</span>.</span>
<span id="cb116-556"><a href="#cb116-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-557"><a href="#cb116-557" aria-hidden="true" tabindex="-1"></a><span class="in">```{r n}</span></span>
<span id="cb116-558"><a href="#cb116-558" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-559"><a href="#cb116-559" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(species) |&gt; </span></span>
<span id="cb116-560"><a href="#cb116-560" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(n = n())</span></span>
<span id="cb116-561"><a href="#cb116-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-562"><a href="#cb116-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-563"><a href="#cb116-563" aria-hidden="true" tabindex="-1"></a>Or with <span class="in">`count()`</span></span>
<span id="cb116-564"><a href="#cb116-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-565"><a href="#cb116-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r count}</span></span>
<span id="cb116-566"><a href="#cb116-566" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-567"><a href="#cb116-567" aria-hidden="true" tabindex="-1"></a><span class="in">  count(species)</span></span>
<span id="cb116-568"><a href="#cb116-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-569"><a href="#cb116-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-570"><a href="#cb116-570" aria-hidden="true" tabindex="-1"></a><span class="in">`count()`</span> is more concise, but <span class="in">`group_by()`</span> and <span class="in">`summarise()`</span> is useful when you need to calculate more variables (for example mean and standard deviation).</span>
<span id="cb116-571"><a href="#cb116-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-572"><a href="#cb116-572" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb116-573"><a href="#cb116-573" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise </span></span>
<span id="cb116-574"><a href="#cb116-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-575"><a href="#cb116-575" aria-hidden="true" tabindex="-1"></a>From the <span class="in">`penguins`</span> data, find</span>
<span id="cb116-576"><a href="#cb116-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-577"><a href="#cb116-577" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>how many penguins are there of each species</span>
<span id="cb116-578"><a href="#cb116-578" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>how many penguins are there of each species in each island</span>
<span id="cb116-579"><a href="#cb116-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-580"><a href="#cb116-580" aria-hidden="true" tabindex="-1"></a>&lt;details&gt;</span>
<span id="cb116-581"><a href="#cb116-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-582"><a href="#cb116-582" aria-hidden="true" tabindex="-1"></a>&lt;summary&gt;Hint&lt;/summary&gt;</span>
<span id="cb116-583"><a href="#cb116-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-584"><a href="#cb116-584" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb116-585"><a href="#cb116-585" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-586"><a href="#cb116-586" aria-hidden="true" tabindex="-1"></a><span class="in">  count(___, ___)</span></span>
<span id="cb116-587"><a href="#cb116-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-588"><a href="#cb116-588" aria-hidden="true" tabindex="-1"></a><span class="in"># or</span></span>
<span id="cb116-589"><a href="#cb116-589" aria-hidden="true" tabindex="-1"></a><span class="in">penguins |&gt; </span></span>
<span id="cb116-590"><a href="#cb116-590" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(___) |&gt; </span></span>
<span id="cb116-591"><a href="#cb116-591" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(___ = n())</span></span>
<span id="cb116-592"><a href="#cb116-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-593"><a href="#cb116-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-594"><a href="#cb116-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-595"><a href="#cb116-595" aria-hidden="true" tabindex="-1"></a>&lt;/details&gt;</span>
<span id="cb116-596"><a href="#cb116-596" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb116-597"><a href="#cb116-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-598"><a href="#cb116-598" aria-hidden="true" tabindex="-1"></a><span class="fu">## Common problems</span></span>
<span id="cb116-599"><a href="#cb116-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-600"><a href="#cb116-600" aria-hidden="true" tabindex="-1"></a><span class="fu">### Non standard names</span></span>
<span id="cb116-601"><a href="#cb116-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-602"><a href="#cb116-602" aria-hidden="true" tabindex="-1"></a>Ideally column names should follow the standard rules for naming objects in R - UPPER and lower case letters, numbers, "." and "<span class="sc">\_</span>" with the first character being a letter (or a dot if you want an invisible object).</span>
<span id="cb116-603"><a href="#cb116-603" aria-hidden="true" tabindex="-1"></a>Sometimes when you import data, it has non-standard names with spaces or extra characters.</span>
<span id="cb116-604"><a href="#cb116-604" aria-hidden="true" tabindex="-1"></a>If you need to refer to a column name that doesn't follow the rules, you need to enclose it with back-ticks.</span>
<span id="cb116-605"><a href="#cb116-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-606"><a href="#cb116-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r non-standard-names}</span></span>
<span id="cb116-607"><a href="#cb116-607" aria-hidden="true" tabindex="-1"></a><span class="in">df &lt;- tibble(`Region/Country` = "Norway", value = 42)</span></span>
<span id="cb116-608"><a href="#cb116-608" aria-hidden="true" tabindex="-1"></a><span class="in">df</span></span>
<span id="cb116-609"><a href="#cb116-609" aria-hidden="true" tabindex="-1"></a><span class="in">df |&gt; rename(region_country = `Region/Country`)</span></span>
<span id="cb116-610"><a href="#cb116-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb116-611"><a href="#cb116-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-612"><a href="#cb116-612" aria-hidden="true" tabindex="-1"></a>It is sometimes best to rename these columns to make them easier to refer to.</span>
<span id="cb116-613"><a href="#cb116-613" aria-hidden="true" tabindex="-1"></a><span class="in">`janitor::clean_names()`</span> is very efficient for making easy-to-use names.</span>
<span id="cb116-614"><a href="#cb116-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-615"><a href="#cb116-615" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb116-616"><a href="#cb116-616" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further reading</span></span>
<span id="cb116-617"><a href="#cb116-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-618"><a href="#cb116-618" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">stat545</span><span class="co">](https://stat545.com/dplyr-intro.html)</span></span>
<span id="cb116-619"><a href="#cb116-619" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">R for data science</span><span class="co">](https://r4ds.hadley.nz/)</span></span>
<span id="cb116-620"><a href="#cb116-620" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">`dplyr` cheatsheet</span><span class="co">](https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf)</span></span>
<span id="cb116-621"><a href="#cb116-621" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb116-622"><a href="#cb116-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-623"><a href="#cb116-623" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb116-624"><a href="#cb116-624" aria-hidden="true" tabindex="-1"></a><span class="fu">### Contributors {.unlisted .unnumbered}</span></span>
<span id="cb116-625"><a href="#cb116-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-626"><a href="#cb116-626" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Richard Telford</span>
<span id="cb116-627"><a href="#cb116-627" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>
